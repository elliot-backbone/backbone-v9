{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/qa/forbidden.js"],"sourcesContent":["/**\n * forbidden.js ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â Forbidden Derived Field Enforcement\n * \n * INVARIANT: Derived values must NEVER be stored in raw data.\n * This module enforces that invariant through:\n * - Deep scanning for forbidden keys\n * - Validation gates that hard-fail on violations\n * - Export firewalls to prevent re-contamination\n * \n * @module forbidden\n */\n\n/**\n * B1: CANONICAL FORBIDDEN DERIVED FIELDS\n * \n * If a value can be calculated, it must NEVER be persisted.\n * This list is exhaustive and authoritative.\n */\nexport const FORBIDDEN_DERIVED_FIELDS = [\n  // Core derivations\n  'runway',\n  'health',\n  'priority',\n  \n  // Scoring/ranking\n  'impact',\n  'urgency',\n  'risk',\n  'score',\n  \n  // Classification bands\n  'tier',\n  'band',\n  'label',\n  \n  // Progress metrics\n  'progressPct',\n  'coverage',\n  \n  // Probabilistic computations\n  'expectedValue',\n  'conversionProb',\n  \n  // Trajectory outputs (Phase 3.1 addition)\n  'onTrack',\n  'projectedDate',\n  'velocity',\n  \n  // Issue/priority outputs\n  'issues',\n  'priorities',\n  'actions',\n  \n  // Health components\n  'healthBand',\n  'healthSignals',\n  'runwayMonths',\n  \n  // Ripple effect outputs\n  'rippleScore',\n  'rippleEffect',\n  \n  // Phase 3.2: Action impact model fields\n  'actionId',\n  'expectedNetImpact',\n  'upsideMagnitude',\n  'probabilityOfSuccess',\n  'executionProbability',\n  'downsideMagnitude',\n  'timeToImpactDays',\n  'effortCost',\n  'secondOrderLeverage',\n  'impactModel',\n  'explain',\n  \n  // Phase 3.2: Predictive outputs\n  'goalTrajectory',\n  'probabilityOfHit',\n  'preissues',\n  'preIssues',\n  'likelihood',\n  'timeToBreachDays',\n  \n  // Phase 3.2: Action artifacts\n  'actionCandidates',\n  'rankedActions',\n  'rank',\n  'timing',\n  'timingRationale',\n  'timingConfidence',\n  'timingScore',\n  'escalation',\n  'escalationDate',\n  'daysUntilEscalation',\n  'isImminent',\n  'costOfDelay',\n  'costMultiplier',\n  'costCurve',\n  'conversionLift',\n  'isSecondOrder',\n  'secondOrder',\n  \n  // Phase 4.5: Ranking surface (single scalar)\n  'rankScore',\n  'rankComponents',\n  'trustPenalty',\n  'executionFrictionPenalty',\n  'timeCriticalityBoost',\n  \n  // Phase 4.5: Calibration outputs\n  'calibratedProbability',\n  'introducerPrior',\n  'pathTypePrior',\n  'targetTypePrior',\n  'successRate',\n  \n  // Phase 4.5: Followup tracking\n  'followupFor',\n  'daysSinceSent'\n];\n\n/**\n * Alias for backward compatibility\n */\nexport const FORBIDDEN_FIELDS = FORBIDDEN_DERIVED_FIELDS;\n\n/**\n * Create a Set for O(1) lookup\n */\nconst FORBIDDEN_SET = new Set(FORBIDDEN_DERIVED_FIELDS);\n\n/**\n * B2: DEEP SCAN\n * \n * Recursively scan raw input for forbidden keys at any depth.\n * Returns JSON paths to all violations.\n * \n * @param {any} obj - Object to scan\n * @param {string} [path=''] - Current JSON path\n * @returns {string[]} - Array of JSON paths where forbidden keys were found\n */\nexport function deepScanForbidden(obj, path = '') {\n  const violations = [];\n\n  if (obj === null || obj === undefined) {\n    return violations;\n  }\n\n  if (Array.isArray(obj)) {\n    obj.forEach((item, index) => {\n      violations.push(...deepScanForbidden(item, `${path}[${index}]`));\n    });\n    return violations;\n  }\n\n  if (typeof obj === 'object') {\n    for (const key of Object.keys(obj)) {\n      const currentPath = path ? `${path}.${key}` : key;\n      \n      // Check if this key is forbidden\n      if (FORBIDDEN_SET.has(key)) {\n        violations.push(currentPath);\n      }\n      \n      // Recurse into value\n      violations.push(...deepScanForbidden(obj[key], currentPath));\n    }\n  }\n\n  return violations;\n}\n\n/**\n * B3: VALIDATION GATE\n * \n * Hard-fail validation if ANY forbidden key is found.\n * This is the enforcement mechanism - no exceptions.\n * \n * @param {any} raw - Raw input data to validate\n * @returns {{ valid: boolean, violations: string[], message: string }}\n */\nexport function validateNoForbiddenFields(raw) {\n  const violations = deepScanForbidden(raw);\n  \n  if (violations.length === 0) {\n    return {\n      valid: true,\n      violations: [],\n      message: 'No forbidden derived fields found'\n    };\n  }\n\n  return {\n    valid: false,\n    violations,\n    message: `FORBIDDEN DERIVED FIELDS DETECTED:\\n${violations.map(v => `  - ${v}`).join('\\n')}\\n\\nDerived values must NEVER be stored. Remove these fields.`\n  };\n}\n\n/**\n * Throw on forbidden fields (hard gate)\n * \n * @param {any} raw - Raw input data\n * @throws {Error} if forbidden fields found\n */\nexport function assertNoForbiddenFields(raw) {\n  const result = validateNoForbiddenFields(raw);\n  if (!result.valid) {\n    throw new Error(result.message);\n  }\n}\n\n/**\n * B4: EXPORT FIREWALL - exportRaw\n * \n * Strip all derived fields from raw data before storage.\n * Returns a clean copy safe for persistence.\n * \n * @param {any} obj - Object to clean\n * @returns {any} - Deep copy with forbidden fields removed\n */\nexport function exportRaw(obj) {\n  if (obj === null || obj === undefined) {\n    return obj;\n  }\n\n  if (Array.isArray(obj)) {\n    return obj.map(item => exportRaw(item));\n  }\n\n  if (typeof obj === 'object') {\n    const cleaned = {};\n    for (const key of Object.keys(obj)) {\n      // Skip forbidden keys\n      if (FORBIDDEN_SET.has(key)) {\n        continue;\n      }\n      // Recurse into value\n      cleaned[key] = exportRaw(obj[key]);\n    }\n    return cleaned;\n  }\n\n  // Primitives pass through\n  return obj;\n}\n\n/**\n * B4: EXPORT FIREWALL - exportComputed\n * \n * Extract ONLY derived fields from computed output.\n * Used to separate concerns: raw storage vs computed view.\n * \n * @param {Object} computed - Computed output with derived fields\n * @param {string[]} [fields] - Specific fields to extract (defaults to all forbidden)\n * @returns {Object} - Object containing only derived values\n */\nexport function exportComputed(computed, fields = null) {\n  const extractFields = fields || FORBIDDEN_DERIVED_FIELDS;\n  const result = {};\n\n  if (!computed || typeof computed !== 'object') {\n    return result;\n  }\n\n  // Extract top-level derived fields\n  for (const field of extractFields) {\n    if (computed[field] !== undefined) {\n      result[field] = computed[field];\n    }\n  }\n\n  // Also check for 'derived' namespace (engine output pattern)\n  if (computed.derived && typeof computed.derived === 'object') {\n    result.derived = {};\n    for (const field of extractFields) {\n      if (computed.derived[field] !== undefined) {\n        result.derived[field] = computed.derived[field];\n      }\n    }\n  }\n\n  return result;\n}\n\n/**\n * Check if a single key is forbidden\n * \n * @param {string} key - Field name to check\n * @returns {boolean}\n */\nexport function isForbidden(key) {\n  return FORBIDDEN_SET.has(key);\n}\n\n/**\n * Get list of forbidden fields (for documentation/tooling)\n * \n * @returns {string[]}\n */\nexport function getForbiddenList() {\n  return [...FORBIDDEN_DERIVED_FIELDS];\n}\n\nexport default {\n  FORBIDDEN_DERIVED_FIELDS,\n  deepScanForbidden,\n  validateNoForbiddenFields,\n  assertNoForbiddenFields,\n  exportRaw,\n  exportComputed,\n  isForbidden,\n  getForbiddenList\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 257, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/runtime/index.js"],"sourcesContent":["/**\n * BACKBONE V9 - SCHEMA DEFINITION\n * \n * INVARIANT: Schema stores FACTS only, never derivations.\n * \n * Forbidden to store: See forbidden.js for canonical list.\n * Every raw datum must have: value + asOf + provenance\n * \n * Phase C Contract:\n * - Raw input is the sole source of truth\n * - Derived output is ephemeral  \n * - Freshness/provenance missing -> Issue, not Health penalty\n */\n\nimport { validateNoForbiddenFields, FORBIDDEN_DERIVED_FIELDS } from '../qa/forbidden.js';\n\n// =============================================================================\n// ENUMS (Factual classifications only)\n// =============================================================================\n\nexport const Stage = {\n  PRE_SEED: 'Pre-Seed',\n  SEED: 'Seed',\n  SERIES_A: 'Series A',\n  SERIES_B: 'Series B',\n  SERIES_C: 'Series C'\n};\n\nexport const GoalType = {\n  REVENUE: 'revenue',\n  PRODUCT: 'product',\n  FUNDRAISE: 'fundraise',\n  HIRING: 'hiring',\n  PARTNERSHIP: 'partnership',\n  OPERATIONAL: 'operational'\n};\n\nexport const GoalStatus = {\n  ACTIVE: 'active',\n  COMPLETED: 'completed',\n  ABANDONED: 'abandoned',\n  PAUSED: 'paused'\n};\n\nexport const DealStatus = {\n  OUTREACH: 'outreach',\n  MEETING: 'meeting',\n  DD: 'dd',\n  TERMSHEET: 'termsheet',\n  CLOSED: 'closed',\n  PASSED: 'passed'\n};\n\nexport const Provenance = {\n  MANUAL: 'manual',\n  AGENT: 'agent',\n  INTEGRATION: 'integration',\n  SYSTEM: 'system'\n};\n\n// =============================================================================\n// RAW INPUT SHAPES (What gets stored)\n// =============================================================================\n\n/**\n * @typedef {Object} RawValue\n * @property {*} value - The actual value\n * @property {string} asOf - ISO timestamp when value was recorded\n * @property {string} provenance - Source: manual|agent|integration|system\n */\n\n/**\n * @typedef {Object} Founder\n * @property {string} name\n * @property {string} role\n * @property {string} bio\n */\n\n/**\n * @typedef {Object} Goal\n * @property {string} id - Unique goal identifier\n * @property {string} type - GoalType enum\n * @property {string} name - Human-readable name\n * @property {number} current - Current value\n * @property {number} target - Target value\n * @property {string} due - ISO date string\n * @property {string} status - GoalStatus enum\n * @property {string} asOf - When this goal was last updated\n * @property {string} provenance - Source of this data\n */\n\n/**\n * @typedef {Object} Deal\n * @property {string} id - Unique deal identifier\n * @property {string} investorId - FK to investor\n * @property {string} investor - Investor name (denormalized for display)\n * @property {string} status - DealStatus enum\n * @property {number} probability - 0-100 (factual estimate, not derived)\n * @property {number} amount - Deal amount in USD\n * @property {string} asOf - When this deal was last updated\n * @property {string} provenance - Source of this data\n */\n\n/**\n * @typedef {Object} Company\n * @property {string} id - Unique identifier\n * @property {string} name - Company name\n * @property {string} tagline - One-line description\n * @property {string} stage - Stage enum\n * @property {number} burn - Monthly burn rate in USD\n * @property {number} cash - Current cash position in USD\n * @property {number} employees - Headcount\n * @property {string} hq - Headquarters location\n * @property {string} sector - Industry sector\n * @property {string} color - UI color gradient\n * @property {boolean} raising - Currently fundraising?\n * @property {number} roundTarget - Target raise amount (0 if not raising)\n * @property {Founder[]} founders - Founding team\n * @property {Goal[]} goals - Company goals\n * @property {Deal[]} deals - Active deals\n * @property {string} asOf - When company data was last updated\n * @property {string} provenance - Source of this data\n * \n * NOTE: NO health field. Health is DERIVED from cash/burn/goals.\n * NOTE: NO runway field. Runway is DERIVED as cash/burn.\n */\n\n/**\n * @typedef {Object} TeamMember\n * @property {string} id\n * @property {string} name\n * @property {string} role\n * @property {string} bio\n * @property {string} avatar - Initials\n * @property {string} color - UI color gradient\n * @property {string} asOf\n * @property {string} provenance\n */\n\n/**\n * @typedef {Object} Investor\n * @property {string} id\n * @property {string} name\n * @property {string} aum - Assets under management\n * @property {string} stageFocus\n * @property {string} sectorFocus\n * @property {string[]} deals - Company IDs with active deals\n * @property {string} asOf\n * @property {string} provenance\n */\n\n// =============================================================================\n// SCHEMA VALIDATOR\n// =============================================================================\n\n/**\n * Validates a company object against schema rules\n * @param {Company} company \n * @returns {{ valid: boolean, errors: string[] }}\n */\nexport function validateCompany(company) {\n  const errors = [];\n  \n  // Required fields\n  const required = ['id', 'name', 'stage', 'burn', 'cash', 'asOf', 'provenance'];\n  for (const field of required) {\n    if (company[field] === undefined || company[field] === null) {\n      errors.push(`Missing required field: ${field}`);\n    }\n  }\n  \n  // CRITICAL: Deep scan for forbidden derived fields (uses canonical list)\n  const forbiddenResult = validateNoForbiddenFields(company);\n  if (!forbiddenResult.valid) {\n    for (const violation of forbiddenResult.violations) {\n      errors.push(`FORBIDDEN: Cannot store derived field at '${violation}'. Remove it.`);\n    }\n  }\n  \n  // Enum validation\n  if (company.stage && !Object.values(Stage).includes(company.stage)) {\n    errors.push(`Invalid stage: ${company.stage}`);\n  }\n  \n  // Type validation\n  if (typeof company.burn !== 'number' || company.burn < 0) {\n    errors.push(`Invalid burn: must be non-negative number`);\n  }\n  if (typeof company.cash !== 'number' || company.cash < 0) {\n    errors.push(`Invalid cash: must be non-negative number`);\n  }\n  \n  // Goals validation\n  if (company.goals) {\n    for (const goal of company.goals) {\n      if (!goal.id || !goal.type || !goal.target) {\n        errors.push(`Invalid goal: missing id, type, or target`);\n      }\n      if (!Object.values(GoalType).includes(goal.type)) {\n        errors.push(`Invalid goal type: ${goal.type}`);\n      }\n    }\n  }\n  \n  return { valid: errors.length === 0, errors };\n}\n\n/**\n * Validates entire dataset with deep forbidden field scan\n * @param {{ companies: Company[], team: TeamMember[], investors: Investor[] }} data\n * @returns {{ valid: boolean, errors: string[] }}\n */\nexport function validateDataset(data) {\n  const errors = [];\n  \n  // Phase B3: Deep scan entire dataset for forbidden fields FIRST\n  const forbiddenResult = validateNoForbiddenFields(data);\n  if (!forbiddenResult.valid) {\n    errors.push(...forbiddenResult.violations.map(v => \n      `FORBIDDEN DERIVED FIELD: ${v}`\n    ));\n  }\n  \n  // Validate companies\n  for (const company of data.companies || []) {\n    const result = validateCompany(company);\n    if (!result.valid) {\n      // Filter out duplicate forbidden errors (already caught above)\n      const nonForbiddenErrors = result.errors.filter(e => !e.startsWith('FORBIDDEN'));\n      errors.push(...nonForbiddenErrors.map(e => `[${company.id || 'unknown'}] ${e}`));\n    }\n  }\n  \n  // Validate referential integrity: deals reference valid investors\n  const investorIds = new Set((data.investors || []).map(i => i.id));\n  for (const company of data.companies || []) {\n    for (const deal of company.deals || []) {\n      if (deal.investorId && !investorIds.has(deal.investorId)) {\n        errors.push(`[${company.id}] Deal references unknown investor: ${deal.investorId}`);\n      }\n    }\n  }\n  \n  return { valid: errors.length === 0, errors };\n}\n\n// =============================================================================\n// RE-EXPORTS\n// =============================================================================\n\nexport { FORBIDDEN_DERIVED_FIELDS } from '../qa/forbidden.js';\n\n// =============================================================================\n// SCHEMA VERSION\n// =============================================================================\n\nexport const SCHEMA_VERSION = '9.1.0';\nexport const SCHEMA_DATE = '2026-01-24';\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 414, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/runtime/graph.js"],"sourcesContent":["/**\n * graph.js – Explicit DAG Definition (Phase 4.5.2)\n * \n * Execution order is enforced by explicit dependency graph, not convention.\n * \n * INVARIANT: No circular dependencies. Architecture enforces doctrine.\n * \n * @module graph\n */\n\n// =============================================================================\n// COMPUTATION GRAPH (Phase 4.5.2)\n// =============================================================================\n\n/**\n * Dependency graph for Phase 4.5.2 pipeline.\n * Each node lists its dependencies.\n * \n * Phase 4.5.2: Kill list compliance\n * - REMOVED: valueVector (shadow value surface)\n * - REMOVED: weeklyValue (shadow value surface)\n * - SINGLE RANKING SURFACE: actionRanker (via rankScore only)\n * \n * DAG Order:\n * runway → metrics → trajectory → goalTrajectory → health → issues → \n * preissues → ripple → actionCandidates → actionImpact → actionRanker\n */\nexport const GRAPH = {\n  // L1: Base derivations (no deps)\n  runway: [],\n  metrics: [],\n  \n  // L2: Trajectory (can use metrics)\n  trajectory: ['metrics'],\n  \n  // L3: Goal trajectory (goals + metrics + trajectory)\n  goalTrajectory: ['metrics', 'trajectory'],\n  \n  // L4: Health (internal state only, depends on runway)\n  health: ['runway'],\n  \n  // L5: Issues (gaps - depends on runway, trajectory, goalTrajectory)\n  issues: ['runway', 'trajectory', 'goalTrajectory'],\n  \n  // L6: Pre-issues (forecasted - depends on runway, goalTrajectory, trajectory)\n  preissues: ['runway', 'goalTrajectory', 'trajectory', 'metrics'],\n  \n  // L7: Ripple (downstream effects - depends on issues)\n  ripple: ['issues'],\n  \n  // L8: Intro opportunities (network actions - depends on goalTrajectory for blocked goals)\n  introOpportunity: ['goalTrajectory', 'issues'],\n  \n  // L9: Action candidates (from issues, preissues, goals, AND intros)\n  actionCandidates: ['issues', 'preissues', 'goalTrajectory', 'introOpportunity'],\n  \n  // L10: Action impact (attach impact model, use ripple for leverage)\n  actionImpact: ['actionCandidates', 'ripple'],\n  \n  // L11: Action ranker (rank by rankScore - single surface)\n  actionRanker: ['actionImpact'],\n  \n  // L12: Priority view (compatibility layer over ranked actions)\n  priority: ['actionRanker']\n};\n\n// =============================================================================\n// TOPOLOGICAL SORT\n// =============================================================================\n\n/**\n * Perform topological sort on the dependency graph.\n * Detects cycles and throws on circular dependencies.\n * Produces stable ordering.\n * \n * @param {Object} graph - Dependency graph (node -> dependencies[])\n * @returns {string[]} - Nodes in topological order\n * @throws {Error} - If cycle detected\n */\nexport function topoSort(graph) {\n  const nodes = Object.keys(graph);\n  const visited = new Set();\n  const visiting = new Set();\n  const order = [];\n  \n  function visit(node) {\n    if (visited.has(node)) {\n      return;\n    }\n    \n    if (visiting.has(node)) {\n      throw new Error(`DAG CYCLE DETECTED: ${node} is part of a circular dependency`);\n    }\n    \n    visiting.add(node);\n    \n    const deps = graph[node] || [];\n    for (const dep of deps) {\n      if (!graph.hasOwnProperty(dep)) {\n        throw new Error(`DAG ERROR: Unknown dependency '${dep}' in node '${node}'`);\n      }\n      visit(dep);\n    }\n    \n    visiting.delete(node);\n    visited.add(node);\n    order.push(node);\n  }\n  \n  // Visit all nodes (sorted for determinism)\n  for (const node of nodes.sort()) {\n    visit(node);\n  }\n  \n  return order;\n}\n\n/**\n * Validate graph structure\n * @param {Object} graph \n * @returns {{valid: boolean, errors: string[]}}\n */\nexport function validateGraph(graph) {\n  const errors = [];\n  const nodes = new Set(Object.keys(graph));\n  \n  // Check all dependencies exist\n  for (const [node, deps] of Object.entries(graph)) {\n    for (const dep of deps) {\n      if (!nodes.has(dep)) {\n        errors.push(`Node '${node}' depends on unknown node '${dep}'`);\n      }\n    }\n  }\n  \n  // Check for cycles\n  try {\n    topoSort(graph);\n  } catch (e) {\n    errors.push(e.message);\n  }\n  \n  return { valid: errors.length === 0, errors };\n}\n\n/**\n * Get the execution order for the standard graph\n * @returns {string[]}\n */\nexport function getExecutionOrder() {\n  return topoSort(GRAPH);\n}\n\n/**\n * Get dependencies for a node\n * @param {string} node \n * @returns {string[]}\n */\nexport function getDependencies(node) {\n  return GRAPH[node] || [];\n}\n\n/**\n * Check if node A depends on node B (directly or transitively)\n * @param {string} nodeA \n * @param {string} nodeB \n * @returns {boolean}\n */\nexport function dependsOn(nodeA, nodeB) {\n  const visited = new Set();\n  \n  function check(current) {\n    if (current === nodeB) return true;\n    if (visited.has(current)) return false;\n    visited.add(current);\n    \n    const deps = GRAPH[current] || [];\n    for (const dep of deps) {\n      if (check(dep)) return true;\n    }\n    return false;\n  }\n  \n  return check(nodeA);\n}\n\nexport default {\n  GRAPH,\n  topoSort,\n  validateGraph,\n  getExecutionOrder,\n  getDependencies,\n  dependsOn\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 597, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/derive/runway.js"],"sourcesContent":["/**\n * BACKBONE V9 Ã¢â‚¬â€ RUNWAY DERIVATION\n * \n * Pure function: (cash, burn, now) Ã¢â€ â€™ RunwayResult\n * \n * INVARIANT: This is a runtime derivation. Never store the result.\n */\n\n/**\n * @typedef {Object} RunwayResult\n * @property {number} value - Runway in months\n * @property {number} confidence - 0-1 confidence score\n * @property {string[]} inputs_used - Fields used in calculation\n * @property {string[]} inputs_missing - Fields that were missing\n * @property {number} staleness_penalty - 0-1 penalty for stale data\n * @property {string} provenance_summary - Source description\n * @property {string} explain - Human-readable explanation\n */\n\n/**\n * Compute runway in months\n * \n * @param {number} cash - Current cash position\n * @param {number} burn - Monthly burn rate\n * @param {string} cashAsOf - ISO timestamp of cash data\n * @param {string} burnAsOf - ISO timestamp of burn data\n * @param {Date} now - Current time (passed explicitly for determinism)\n * @returns {RunwayResult}\n */\nexport function deriveRunway(cash, burn, cashAsOf, burnAsOf, now = new Date()) {\n  const inputs_used = [];\n  const inputs_missing = [];\n  let confidence = 1.0;\n  let staleness_penalty = 0;\n  \n  // Check for missing inputs\n  if (cash === undefined || cash === null) {\n    inputs_missing.push('cash');\n  } else {\n    inputs_used.push('cash');\n  }\n  \n  if (burn === undefined || burn === null) {\n    inputs_missing.push('burn');\n  } else {\n    inputs_used.push('burn');\n  }\n  \n  // Calculate staleness penalty\n  const maxStaleDays = 30;\n  if (cashAsOf) {\n    const cashDate = cashAsOf instanceof Date ? cashAsOf : new Date(cashAsOf);\n    const cashAge = (now.getTime() - cashDate.getTime()) / (1000 * 60 * 60 * 24);\n    staleness_penalty = Math.max(staleness_penalty, Math.min(cashAge / maxStaleDays, 1));\n  }\n  if (burnAsOf) {\n    const burnDate = burnAsOf instanceof Date ? burnAsOf : new Date(burnAsOf);\n    const burnAge = (now.getTime() - burnDate.getTime()) / (1000 * 60 * 60 * 24);\n    staleness_penalty = Math.max(staleness_penalty, Math.min(burnAge / maxStaleDays, 1));\n  }\n  \n  // Handle edge cases\n  if (inputs_missing.length > 0) {\n    return {\n      value: null,\n      confidence: 0,\n      inputs_used,\n      inputs_missing,\n      staleness_penalty,\n      provenance_summary: 'insufficient data',\n      explain: `Cannot compute runway: missing ${inputs_missing.join(', ')}`\n    };\n  }\n  \n  if (burn <= 0) {\n    return {\n      value: Infinity,\n      confidence: 0.5, // Lower confidence for zero burn (unusual)\n      inputs_used,\n      inputs_missing,\n      staleness_penalty,\n      provenance_summary: 'zero burn',\n      explain: 'Infinite runway (burn is zero or negative)'\n    };\n  }\n  \n  if (cash < 0) {\n    return {\n      value: 0,\n      confidence: 0.9,\n      inputs_used,\n      inputs_missing,\n      staleness_penalty,\n      provenance_summary: 'negative cash',\n      explain: 'Zero runway (cash is negative)'\n    };\n  }\n  \n  // Normal calculation\n  const runway = cash / burn;\n  confidence = Math.max(0, 1 - staleness_penalty * 0.5); // Staleness reduces confidence\n  \n  return {\n    value: Math.round(runway * 10) / 10, // Round to 1 decimal\n    confidence,\n    inputs_used,\n    inputs_missing,\n    staleness_penalty,\n    provenance_summary: `cash=${cash}, burn=${burn}`,\n    explain: `${Math.round(runway)} months runway at current burn rate`\n  };\n}\n\nexport default deriveRunway;\n"],"names":[],"mappings":"AAAA;;;;;;CAMC,GAED;;;;;;;;;CASC,GAED;;;;;;;;;CASC;;;;;;AACM,SAAS,aAAa,IAAI,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,IAAI,MAAM;IAC3E,MAAM,cAAc,EAAE;IACtB,MAAM,iBAAiB,EAAE;IACzB,IAAI,aAAa;IACjB,IAAI,oBAAoB;IAExB,2BAA2B;IAC3B,IAAI,SAAS,aAAa,SAAS,MAAM;QACvC,eAAe,IAAI,CAAC;IACtB,OAAO;QACL,YAAY,IAAI,CAAC;IACnB;IAEA,IAAI,SAAS,aAAa,SAAS,MAAM;QACvC,eAAe,IAAI,CAAC;IACtB,OAAO;QACL,YAAY,IAAI,CAAC;IACnB;IAEA,8BAA8B;IAC9B,MAAM,eAAe;IACrB,IAAI,UAAU;QACZ,MAAM,WAAW,oBAAoB,OAAO,WAAW,IAAI,KAAK;QAChE,MAAM,UAAU,CAAC,IAAI,OAAO,KAAK,SAAS,OAAO,EAAE,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;QAC3E,oBAAoB,KAAK,GAAG,CAAC,mBAAmB,KAAK,GAAG,CAAC,UAAU,cAAc;IACnF;IACA,IAAI,UAAU;QACZ,MAAM,WAAW,oBAAoB,OAAO,WAAW,IAAI,KAAK;QAChE,MAAM,UAAU,CAAC,IAAI,OAAO,KAAK,SAAS,OAAO,EAAE,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;QAC3E,oBAAoB,KAAK,GAAG,CAAC,mBAAmB,KAAK,GAAG,CAAC,UAAU,cAAc;IACnF;IAEA,oBAAoB;IACpB,IAAI,eAAe,MAAM,GAAG,GAAG;QAC7B,OAAO;YACL,OAAO;YACP,YAAY;YACZ;YACA;YACA;YACA,oBAAoB;YACpB,SAAS,CAAC,+BAA+B,EAAE,eAAe,IAAI,CAAC,OAAO;QACxE;IACF;IAEA,IAAI,QAAQ,GAAG;QACb,OAAO;YACL,OAAO;YACP,YAAY;YACZ;YACA;YACA;YACA,oBAAoB;YACpB,SAAS;QACX;IACF;IAEA,IAAI,OAAO,GAAG;QACZ,OAAO;YACL,OAAO;YACP,YAAY;YACZ;YACA;YACA;YACA,oBAAoB;YACpB,SAAS;QACX;IACF;IAEA,qBAAqB;IACrB,MAAM,SAAS,OAAO;IACtB,aAAa,KAAK,GAAG,CAAC,GAAG,IAAI,oBAAoB,MAAM,+BAA+B;IAEtF,OAAO;QACL,OAAO,KAAK,KAAK,CAAC,SAAS,MAAM;QACjC;QACA;QACA;QACA;QACA,oBAAoB,CAAC,KAAK,EAAE,KAAK,OAAO,EAAE,MAAM;QAChD,SAAS,GAAG,KAAK,KAAK,CAAC,QAAQ,mCAAmC,CAAC;IACrE;AACF;uCAEe"}},
    {"offset": {"line": 707, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/runtime/health.js"],"sourcesContent":["/**\n * health.js - HEALTH DERIVATION (Phase D Rewrite)\n * \n * CRITICAL DOCTRINE:\n * - Health = Internal State ONLY\n * - Health reflects what EXISTS and is COHERENT\n * - Health does NOT reflect what is MISSING or LATE (that's Issues)\n * - Health does NOT predict outcomes (that's Trajectory)\n * \n * D1: Health must NOT:\n * - Penalize missing data\n * - Penalize missing goals  \n * - Predict outcomes\n * \n * D2: Health MAY reflect:\n * - Presence of internal state\n * - Internal coherence\n * - Optional data-integrity signals\n * \n * D3: Health Output Shape:\n * {\n *   healthBand: \"GREEN\" | \"YELLOW\" | \"RED\",\n *   healthSignals: string[],\n *   confidence: number\n * }\n * \n * INVARIANT: This is a runtime derivation. Never store the result.\n * \n * @module health\n */\n\nimport { deriveRunway } from '../derive/runway.js';\n\n/**\n * @typedef {'GREEN' | 'YELLOW' | 'RED'} HealthBand\n */\n\n/**\n * @typedef {Object} HealthResult\n * @property {HealthBand} value - Health band (alias: healthBand)\n * @property {HealthBand} healthBand - Health band\n * @property {string[]} healthSignals - Signals that contributed to health\n * @property {number} confidence - 0-1 confidence score\n * @property {string} explain - Human-readable explanation\n */\n\n/**\n * Health thresholds (in months of runway)\n * \n * NOTE: These reflect CURRENT STATE, not predictions.\n * A company with 3 months runway IS in a critical state.\n * This is a fact about now, not a prediction about failure.\n */\nconst THRESHOLDS = {\n  CRITICAL_RUNWAY: 6,   // RED: Company currently has < 6 months runway\n  WARNING_RUNWAY: 12    // YELLOW: Company currently has < 12 months runway\n};\n\n/**\n * Compute health band for a company\n * \n * Health reflects INTERNAL STATE only:\n * - Current runway (cash/burn ratio) \n * - Data coherence (required fields present)\n * \n * Health does NOT consider:\n * - Missing goals (Issue: NO_GOALS)\n * - Goal progress (Issue: GOAL_BEHIND, GOAL_STALLED)\n * - Pipeline gaps (Issue: PIPELINE_GAP)\n * - Data staleness (Issue: DATA_STALE)\n * \n * @param {Object} company - Company raw data\n * @param {Date} now - Current time (explicit for determinism)\n * @returns {HealthResult}\n */\nexport function deriveHealth(company, now = new Date()) {\n  const healthSignals = [];\n  let confidence = 1.0;\n  \n  // =========================================================================\n  // STEP 1: Derive runway (current state, not prediction)\n  // =========================================================================\n  const runwayResult = deriveRunway(\n    company.cash,\n    company.burn,\n    company.asOf,\n    company.asOf,\n    now\n  );\n  \n  // =========================================================================\n  // STEP 2: Assess runway health (what IS, not what's missing)\n  // =========================================================================\n  let healthBand = 'GREEN';\n  \n  if (runwayResult.value === null) {\n    // Cannot determine runway - but this is NOT a health penalty\n    // It becomes an Issue (DATA_MISSING), not a health downgrade\n    // Health reflects what we CAN assess, not what we can't\n    healthBand = 'GREEN';  // Default to GREEN when unknown\n    confidence = 0.3;      // Low confidence due to incomplete data\n    healthSignals.push('runway_unknown');\n  } else if (runwayResult.value === Infinity) {\n    // Zero or negative burn = infinite runway\n    healthBand = 'GREEN';\n    healthSignals.push('runway_infinite');\n  } else if (runwayResult.value < THRESHOLDS.CRITICAL_RUNWAY) {\n    // Current state: critically low runway\n    healthBand = 'RED';\n    healthSignals.push(`runway_critical_${Math.round(runwayResult.value)}mo`);\n  } else if (runwayResult.value < THRESHOLDS.WARNING_RUNWAY) {\n    // Current state: warning-level runway\n    healthBand = 'YELLOW';\n    healthSignals.push(`runway_warning_${Math.round(runwayResult.value)}mo`);\n  } else {\n    // Current state: healthy runway\n    healthBand = 'GREEN';\n    healthSignals.push(`runway_healthy_${Math.round(runwayResult.value)}mo`);\n  }\n  \n  // =========================================================================\n  // STEP 3: Data coherence signals (optional integrity checks)\n  // =========================================================================\n  \n  // Check if core financial data is present (not a penalty, just a signal)\n  if (company.cash !== undefined && company.burn !== undefined) {\n    healthSignals.push('financials_present');\n  }\n  \n  // Check if company has asOf timestamp (data integrity)\n  if (company.asOf) {\n    healthSignals.push('timestamp_present');\n  }\n  \n  // =========================================================================\n  // STEP 4: Confidence adjustment based on data quality\n  // =========================================================================\n  \n  // Reduce confidence if runway calculation had issues\n  if (runwayResult.value !== null) {\n    confidence = Math.min(confidence, runwayResult.confidence);\n  }\n  \n  // =========================================================================\n  // STEP 5: Build explanation (descriptive, not prescriptive)\n  // =========================================================================\n  let explain;\n  if (runwayResult.value === null) {\n    explain = 'Health unknown: insufficient financial data';\n  } else if (runwayResult.value === Infinity) {\n    explain = 'Healthy: no burn or positive cash flow';\n  } else {\n    explain = `${healthBand}: ${Math.round(runwayResult.value)} months runway`;\n  }\n  \n  return {\n    value: healthBand,           // Legacy compatibility\n    healthBand,                  // D3 spec\n    healthSignals,               // D3 spec\n    confidence: Math.round(confidence * 100) / 100,\n    explain\n  };\n}\n\nexport default deriveHealth;\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA6BC,GAED;;AAEA;;CAEC,GAED;;;;;;;CAOC,GAED;;;;;;CAMC,GACD,MAAM,aAAa;IACjB,iBAAiB;IACjB,gBAAgB,GAAM,mDAAmD;AAC3E;AAmBO,SAAS,aAAa,OAAO,EAAE,MAAM,IAAI,MAAM;IACpD,MAAM,gBAAgB,EAAE;IACxB,IAAI,aAAa;IAEjB,4EAA4E;IAC5E,wDAAwD;IACxD,4EAA4E;IAC5E,MAAM,eAAe,IAAA,iJAAY,EAC/B,QAAQ,IAAI,EACZ,QAAQ,IAAI,EACZ,QAAQ,IAAI,EACZ,QAAQ,IAAI,EACZ;IAGF,4EAA4E;IAC5E,6DAA6D;IAC7D,4EAA4E;IAC5E,IAAI,aAAa;IAEjB,IAAI,aAAa,KAAK,KAAK,MAAM;QAC/B,6DAA6D;QAC7D,6DAA6D;QAC7D,wDAAwD;QACxD,aAAa,SAAU,gCAAgC;QACvD,aAAa,KAAU,wCAAwC;QAC/D,cAAc,IAAI,CAAC;IACrB,OAAO,IAAI,aAAa,KAAK,KAAK,UAAU;QAC1C,0CAA0C;QAC1C,aAAa;QACb,cAAc,IAAI,CAAC;IACrB,OAAO,IAAI,aAAa,KAAK,GAAG,WAAW,eAAe,EAAE;QAC1D,uCAAuC;QACvC,aAAa;QACb,cAAc,IAAI,CAAC,CAAC,gBAAgB,EAAE,KAAK,KAAK,CAAC,aAAa,KAAK,EAAE,EAAE,CAAC;IAC1E,OAAO,IAAI,aAAa,KAAK,GAAG,WAAW,cAAc,EAAE;QACzD,sCAAsC;QACtC,aAAa;QACb,cAAc,IAAI,CAAC,CAAC,eAAe,EAAE,KAAK,KAAK,CAAC,aAAa,KAAK,EAAE,EAAE,CAAC;IACzE,OAAO;QACL,gCAAgC;QAChC,aAAa;QACb,cAAc,IAAI,CAAC,CAAC,eAAe,EAAE,KAAK,KAAK,CAAC,aAAa,KAAK,EAAE,EAAE,CAAC;IACzE;IAEA,4EAA4E;IAC5E,6DAA6D;IAC7D,4EAA4E;IAE5E,yEAAyE;IACzE,IAAI,QAAQ,IAAI,KAAK,aAAa,QAAQ,IAAI,KAAK,WAAW;QAC5D,cAAc,IAAI,CAAC;IACrB;IAEA,uDAAuD;IACvD,IAAI,QAAQ,IAAI,EAAE;QAChB,cAAc,IAAI,CAAC;IACrB;IAEA,4EAA4E;IAC5E,sDAAsD;IACtD,4EAA4E;IAE5E,qDAAqD;IACrD,IAAI,aAAa,KAAK,KAAK,MAAM;QAC/B,aAAa,KAAK,GAAG,CAAC,YAAY,aAAa,UAAU;IAC3D;IAEA,4EAA4E;IAC5E,4DAA4D;IAC5D,4EAA4E;IAC5E,IAAI;IACJ,IAAI,aAAa,KAAK,KAAK,MAAM;QAC/B,UAAU;IACZ,OAAO,IAAI,aAAa,KAAK,KAAK,UAAU;QAC1C,UAAU;IACZ,OAAO;QACL,UAAU,GAAG,WAAW,EAAE,EAAE,KAAK,KAAK,CAAC,aAAa,KAAK,EAAE,cAAc,CAAC;IAC5E;IAEA,OAAO;QACL,OAAO;QACP;QACA;QACA,YAAY,KAAK,KAAK,CAAC,aAAa,OAAO;QAC3C;IACF;AACF;uCAEe"}},
    {"offset": {"line": 840, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/derive/trajectory.js"],"sourcesContent":["/**\n * trajectory.js ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â Goal Progress & Completion Projection\n * \n * Computes goal trajectory from historical snapshots.\n * Pure derivation: no storage of computed values.\n * \n * @module trajectory\n */\n\n/**\n * Calculate velocity (rate of change) from historical data points\n * @param {Array<{value: number, asOf: string}>} history - Chronological snapshots\n * @returns {{velocity: number, dataPoints: number, spanDays: number}}\n */\nexport function calculateVelocity(history) {\n  if (!history || history.length < 2) {\n    return { velocity: 0, dataPoints: history?.length || 0, spanDays: 0 };\n  }\n\n  // Sort by date ascending - handle both Date objects and strings\n  const sorted = [...history].sort((a, b) => {\n    const dateA = a.asOf instanceof Date ? a.asOf : new Date(a.asOf);\n    const dateB = b.asOf instanceof Date ? b.asOf : new Date(b.asOf);\n    return dateA.getTime() - dateB.getTime();\n  });\n\n  const first = sorted[0];\n  const last = sorted[sorted.length - 1];\n  \n  const startDate = first.asOf instanceof Date ? first.asOf : new Date(first.asOf);\n  const endDate = last.asOf instanceof Date ? last.asOf : new Date(last.asOf);\n  const spanDays = (endDate - startDate) / (1000 * 60 * 60 * 24);\n\n  if (spanDays === 0) {\n    return { velocity: 0, dataPoints: sorted.length, spanDays: 0 };\n  }\n\n  const delta = last.value - first.value;\n  const velocity = delta / spanDays; // units per day\n\n  return {\n    velocity,\n    dataPoints: sorted.length,\n    spanDays\n  };\n}\n\n/**\n * Project completion date given current trajectory\n * @param {number} current - Current value\n * @param {number} target - Target value\n * @param {number} velocity - Units per day (can be negative for decreasing goals)\n * @param {Date} now - Reference date\n * @returns {Date|null} - Projected completion date, or null if unreachable\n */\nexport function projectCompletionDate(current, target, velocity, now) {\n  const gap = target - current;\n  \n  // Already achieved\n  if (gap <= 0) {\n    return now;\n  }\n  \n  // Moving away or stagnant - unreachable\n  if (velocity <= 0) {\n    return null;\n  }\n\n  const daysToCompletion = gap / velocity;\n  const completionDate = new Date(now);\n  completionDate.setDate(completionDate.getDate() + daysToCompletion);\n  \n  return completionDate;\n}\n\n/**\n * Calculate confidence based on data quality and trajectory consistency\n * @param {Object} params\n * @param {number} params.dataPoints - Number of historical snapshots\n * @param {number} params.spanDays - Days covered by history\n * @param {number} params.daysToDeadline - Days until due date\n * @param {number} params.velocityVariance - How consistent the velocity is (0-1, lower=better)\n * @returns {number} - Confidence score 0-1\n */\nexport function calculateConfidence({ dataPoints, spanDays, daysToDeadline, velocityVariance = 0 }) {\n  let confidence = 0.5; // Base confidence\n\n  // More data points = higher confidence (up to +0.2)\n  const dataBonus = Math.min(dataPoints / 10, 1) * 0.2;\n  confidence += dataBonus;\n\n  // Longer historical span relative to projection = higher confidence (up to +0.2)\n  if (daysToDeadline > 0 && spanDays > 0) {\n    const coverageRatio = Math.min(spanDays / daysToDeadline, 1);\n    confidence += coverageRatio * 0.2;\n  }\n\n  // Consistent velocity = higher confidence (up to +0.1)\n  confidence += (1 - velocityVariance) * 0.1;\n\n  return Math.min(Math.max(confidence, 0), 1);\n}\n\n/**\n * Derive trajectory for a goal\n * \n * @param {Object} goal - Goal object with target, due, current, history\n * @param {string} goal.metric - What we're measuring (e.g., \"ARR\", \"users\")\n * @param {number} goal.target - Target value to reach\n * @param {string} goal.due - ISO date string for deadline\n * @param {number} goal.current - Current value\n * @param {Array<{value: number, asOf: string}>} [goal.history] - Historical snapshots\n * @param {Date|string} [now] - Reference date (defaults to current time)\n * @returns {{onTrack: boolean, projectedDate: string|null, confidence: number, explain: string}}\n */\nexport function deriveTrajectory(goal, now = new Date()) {\n  const refDate = typeof now === 'string' ? new Date(now) : now;\n  \n  // Validate required fields\n  if (goal.target === undefined || goal.target === null) {\n    return {\n      onTrack: false,\n      projectedDate: null,\n      confidence: 0,\n      explain: 'Missing target value'\n    };\n  }\n\n  if (!goal.due) {\n    return {\n      onTrack: false,\n      projectedDate: null,\n      confidence: 0,\n      explain: 'Missing due date'\n    };\n  }\n\n  if (goal.current === undefined || goal.current === null) {\n    return {\n      onTrack: false,\n      projectedDate: null,\n      confidence: 0,\n      explain: 'Missing current value'\n    };\n  }\n\n  const dueDate = new Date(goal.due);\n  const daysToDeadline = (dueDate - refDate) / (1000 * 60 * 60 * 24);\n\n  // Already achieved?\n  if (goal.current >= goal.target) {\n    return {\n      onTrack: true,\n      projectedDate: refDate.toISOString().split('T')[0],\n      confidence: 1,\n      explain: `Goal achieved: ${goal.current} ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â°Ãƒâ€šÃ‚Â¥ ${goal.target}`\n    };\n  }\n\n  // Past deadline and not achieved\n  if (daysToDeadline < 0) {\n    return {\n      onTrack: false,\n      projectedDate: null,\n      confidence: 1,\n      explain: `Missed: ${goal.current}/${goal.target} by ${goal.due}`\n    };\n  }\n\n  // Calculate velocity from history\n  const history = goal.history || [];\n  const { velocity, dataPoints, spanDays } = calculateVelocity(history);\n\n  // No velocity data - use required rate\n  if (dataPoints < 2) {\n    const gap = goal.target - goal.current;\n    const requiredVelocity = gap / daysToDeadline;\n    \n    return {\n      onTrack: null, // Unknown without velocity data\n      projectedDate: null,\n      confidence: 0.2,\n      explain: `Insufficient history. Need ${requiredVelocity.toFixed(2)}/day to hit ${goal.target} by ${goal.due}`\n    };\n  }\n\n  // Project completion\n  const projectedDate = projectCompletionDate(goal.current, goal.target, velocity, refDate);\n  \n  // Calculate confidence\n  const confidence = calculateConfidence({\n    dataPoints,\n    spanDays,\n    daysToDeadline,\n    velocityVariance: 0 // TODO: implement variance calculation\n  });\n\n  // Determine if on track\n  if (projectedDate === null) {\n    return {\n      onTrack: false,\n      projectedDate: null,\n      confidence,\n      explain: `Stalled or regressing at ${velocity.toFixed(2)}/day. Current: ${goal.current}, Target: ${goal.target}`\n    };\n  }\n\n  const projectedDateStr = projectedDate.toISOString().split('T')[0];\n  const onTrack = projectedDate <= dueDate;\n\n  if (onTrack) {\n    const daysEarly = Math.floor((dueDate - projectedDate) / (1000 * 60 * 60 * 24));\n    return {\n      onTrack: true,\n      projectedDate: projectedDateStr,\n      confidence,\n      explain: `On track at ${velocity.toFixed(2)}/day. Projected ${daysEarly > 0 ? daysEarly + ' days early' : 'on deadline'}`\n    };\n  } else {\n    const daysLate = Math.floor((projectedDate - dueDate) / (1000 * 60 * 60 * 24));\n    return {\n      onTrack: false,\n      projectedDate: projectedDateStr,\n      confidence,\n      explain: `Behind at ${velocity.toFixed(2)}/day. Projected ${daysLate} days late`\n    };\n  }\n}\n\nexport default { deriveTrajectory, calculateVelocity, projectCompletionDate, calculateConfidence };\n"],"names":[],"mappings":"AAAA;;;;;;;CAOC,GAED;;;;CAIC;;;;;;;;;;;;AACM,SAAS,kBAAkB,OAAO;IACvC,IAAI,CAAC,WAAW,QAAQ,MAAM,GAAG,GAAG;QAClC,OAAO;YAAE,UAAU;YAAG,YAAY,SAAS,UAAU;YAAG,UAAU;QAAE;IACtE;IAEA,gEAAgE;IAChE,MAAM,SAAS;WAAI;KAAQ,CAAC,IAAI,CAAC,CAAC,GAAG;QACnC,MAAM,QAAQ,EAAE,IAAI,YAAY,OAAO,EAAE,IAAI,GAAG,IAAI,KAAK,EAAE,IAAI;QAC/D,MAAM,QAAQ,EAAE,IAAI,YAAY,OAAO,EAAE,IAAI,GAAG,IAAI,KAAK,EAAE,IAAI;QAC/D,OAAO,MAAM,OAAO,KAAK,MAAM,OAAO;IACxC;IAEA,MAAM,QAAQ,MAAM,CAAC,EAAE;IACvB,MAAM,OAAO,MAAM,CAAC,OAAO,MAAM,GAAG,EAAE;IAEtC,MAAM,YAAY,MAAM,IAAI,YAAY,OAAO,MAAM,IAAI,GAAG,IAAI,KAAK,MAAM,IAAI;IAC/E,MAAM,UAAU,KAAK,IAAI,YAAY,OAAO,KAAK,IAAI,GAAG,IAAI,KAAK,KAAK,IAAI;IAC1E,MAAM,WAAW,CAAC,UAAU,SAAS,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;IAE7D,IAAI,aAAa,GAAG;QAClB,OAAO;YAAE,UAAU;YAAG,YAAY,OAAO,MAAM;YAAE,UAAU;QAAE;IAC/D;IAEA,MAAM,QAAQ,KAAK,KAAK,GAAG,MAAM,KAAK;IACtC,MAAM,WAAW,QAAQ,UAAU,gBAAgB;IAEnD,OAAO;QACL;QACA,YAAY,OAAO,MAAM;QACzB;IACF;AACF;AAUO,SAAS,sBAAsB,OAAO,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG;IAClE,MAAM,MAAM,SAAS;IAErB,mBAAmB;IACnB,IAAI,OAAO,GAAG;QACZ,OAAO;IACT;IAEA,wCAAwC;IACxC,IAAI,YAAY,GAAG;QACjB,OAAO;IACT;IAEA,MAAM,mBAAmB,MAAM;IAC/B,MAAM,iBAAiB,IAAI,KAAK;IAChC,eAAe,OAAO,CAAC,eAAe,OAAO,KAAK;IAElD,OAAO;AACT;AAWO,SAAS,oBAAoB,EAAE,UAAU,EAAE,QAAQ,EAAE,cAAc,EAAE,mBAAmB,CAAC,EAAE;IAChG,IAAI,aAAa,KAAK,kBAAkB;IAExC,oDAAoD;IACpD,MAAM,YAAY,KAAK,GAAG,CAAC,aAAa,IAAI,KAAK;IACjD,cAAc;IAEd,iFAAiF;IACjF,IAAI,iBAAiB,KAAK,WAAW,GAAG;QACtC,MAAM,gBAAgB,KAAK,GAAG,CAAC,WAAW,gBAAgB;QAC1D,cAAc,gBAAgB;IAChC;IAEA,uDAAuD;IACvD,cAAc,CAAC,IAAI,gBAAgB,IAAI;IAEvC,OAAO,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,YAAY,IAAI;AAC3C;AAcO,SAAS,iBAAiB,IAAI,EAAE,MAAM,IAAI,MAAM;IACrD,MAAM,UAAU,OAAO,QAAQ,WAAW,IAAI,KAAK,OAAO;IAE1D,2BAA2B;IAC3B,IAAI,KAAK,MAAM,KAAK,aAAa,KAAK,MAAM,KAAK,MAAM;QACrD,OAAO;YACL,SAAS;YACT,eAAe;YACf,YAAY;YACZ,SAAS;QACX;IACF;IAEA,IAAI,CAAC,KAAK,GAAG,EAAE;QACb,OAAO;YACL,SAAS;YACT,eAAe;YACf,YAAY;YACZ,SAAS;QACX;IACF;IAEA,IAAI,KAAK,OAAO,KAAK,aAAa,KAAK,OAAO,KAAK,MAAM;QACvD,OAAO;YACL,SAAS;YACT,eAAe;YACf,YAAY;YACZ,SAAS;QACX;IACF;IAEA,MAAM,UAAU,IAAI,KAAK,KAAK,GAAG;IACjC,MAAM,iBAAiB,CAAC,UAAU,OAAO,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;IAEjE,oBAAoB;IACpB,IAAI,KAAK,OAAO,IAAI,KAAK,MAAM,EAAE;QAC/B,OAAO;YACL,SAAS;YACT,eAAe,QAAQ,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;YAClD,YAAY;YACZ,SAAS,CAAC,eAAe,EAAE,KAAK,OAAO,CAAC,kCAAkC,EAAE,KAAK,MAAM,EAAE;QAC3F;IACF;IAEA,iCAAiC;IACjC,IAAI,iBAAiB,GAAG;QACtB,OAAO;YACL,SAAS;YACT,eAAe;YACf,YAAY;YACZ,SAAS,CAAC,QAAQ,EAAE,KAAK,OAAO,CAAC,CAAC,EAAE,KAAK,MAAM,CAAC,IAAI,EAAE,KAAK,GAAG,EAAE;QAClE;IACF;IAEA,kCAAkC;IAClC,MAAM,UAAU,KAAK,OAAO,IAAI,EAAE;IAClC,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,QAAQ,EAAE,GAAG,kBAAkB;IAE7D,uCAAuC;IACvC,IAAI,aAAa,GAAG;QAClB,MAAM,MAAM,KAAK,MAAM,GAAG,KAAK,OAAO;QACtC,MAAM,mBAAmB,MAAM;QAE/B,OAAO;YACL,SAAS;YACT,eAAe;YACf,YAAY;YACZ,SAAS,CAAC,2BAA2B,EAAE,iBAAiB,OAAO,CAAC,GAAG,YAAY,EAAE,KAAK,MAAM,CAAC,IAAI,EAAE,KAAK,GAAG,EAAE;QAC/G;IACF;IAEA,qBAAqB;IACrB,MAAM,gBAAgB,sBAAsB,KAAK,OAAO,EAAE,KAAK,MAAM,EAAE,UAAU;IAEjF,uBAAuB;IACvB,MAAM,aAAa,oBAAoB;QACrC;QACA;QACA;QACA,kBAAkB,EAAE,uCAAuC;IAC7D;IAEA,wBAAwB;IACxB,IAAI,kBAAkB,MAAM;QAC1B,OAAO;YACL,SAAS;YACT,eAAe;YACf;YACA,SAAS,CAAC,yBAAyB,EAAE,SAAS,OAAO,CAAC,GAAG,eAAe,EAAE,KAAK,OAAO,CAAC,UAAU,EAAE,KAAK,MAAM,EAAE;QAClH;IACF;IAEA,MAAM,mBAAmB,cAAc,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;IAClE,MAAM,UAAU,iBAAiB;IAEjC,IAAI,SAAS;QACX,MAAM,YAAY,KAAK,KAAK,CAAC,CAAC,UAAU,aAAa,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;QAC7E,OAAO;YACL,SAAS;YACT,eAAe;YACf;YACA,SAAS,CAAC,YAAY,EAAE,SAAS,OAAO,CAAC,GAAG,gBAAgB,EAAE,YAAY,IAAI,YAAY,gBAAgB,eAAe;QAC3H;IACF,OAAO;QACL,MAAM,WAAW,KAAK,KAAK,CAAC,CAAC,gBAAgB,OAAO,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;QAC5E,OAAO;YACL,SAAS;YACT,eAAe;YACf;YACA,SAAS,CAAC,UAAU,EAAE,SAAS,OAAO,CAAC,GAAG,gBAAgB,EAAE,SAAS,UAAU,CAAC;QAClF;IACF;AACF;uCAEe;IAAE;IAAkB;IAAmB;IAAuB;AAAoB"}},
    {"offset": {"line": 1037, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/derive/metrics.js"],"sourcesContent":["/**\n * metrics.js ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â Metric Time Series View (Phase 3.2)\n * \n * Builds normalized metric views from raw goal/deal data.\n * Derived output - never persisted.\n * \n * @module metrics\n */\n\n// =============================================================================\n// METRIC EXTRACTION\n// =============================================================================\n\n/**\n * Extract metric time series from a goal\n * @param {Object} goal \n * @param {string} companyId \n * @returns {Object} Metric record\n */\nfunction extractGoalMetric(goal, companyId) {\n  return {\n    metricId: `${companyId}:goal:${goal.id}`,\n    entityRef: { type: 'company', id: companyId },\n    metricKey: goal.type || 'custom',\n    goalId: goal.id,\n    name: goal.name,\n    current: goal.current,\n    target: goal.target,\n    due: goal.due,\n    status: goal.status,\n    asOf: goal.asOf,\n    provenance: goal.provenance || 'manual',\n    history: goal.history || [] // If present, array of { date, value }\n  };\n}\n\n/**\n * Extract fundraise metrics from deals\n * @param {Object[]} deals \n * @param {string} companyId \n * @param {Object} company \n * @returns {Object[]} Metric records\n */\nfunction extractDealMetrics(deals, companyId, company) {\n  if (!deals || deals.length === 0) return [];\n  \n  // Aggregate deal pipeline\n  const totalPipeline = deals.reduce((sum, d) => sum + (d.amount || 0), 0);\n  const weightedPipeline = deals.reduce((sum, d) => \n    sum + ((d.amount || 0) * (d.probability || 0) / 100), 0);\n  \n  const metrics = [];\n  \n  // If company has a round target, create a fundraise metric\n  if (company.roundTarget > 0) {\n    // Find committed/closed deals\n    const committed = deals\n      .filter(d => d.status === 'termsheet' || d.status === 'closed')\n      .reduce((sum, d) => sum + (d.amount || 0), 0);\n    \n    metrics.push({\n      metricId: `${companyId}:deals:pipeline`,\n      entityRef: { type: 'company', id: companyId },\n      metricKey: 'fundraise_pipeline',\n      name: 'Fundraise Pipeline',\n      current: committed,\n      target: company.roundTarget,\n      due: null, // No fixed due date for pipeline\n      status: 'active',\n      asOf: company.asOf,\n      provenance: 'computed',\n      totalPipeline,\n      weightedPipeline,\n      dealCount: deals.length\n    });\n  }\n  \n  return metrics;\n}\n\n// =============================================================================\n// MAIN DERIVATION\n// =============================================================================\n\n/**\n * Derive all metrics for a company\n * @param {Object} company \n * @returns {Object[]} Array of metric records\n */\nexport function deriveCompanyMetrics(company) {\n  const metrics = [];\n  \n  // Extract goal metrics\n  for (const goal of company.goals || []) {\n    metrics.push(extractGoalMetric(goal, company.id));\n  }\n  \n  // Extract deal metrics\n  const dealMetrics = extractDealMetrics(company.deals, company.id, company);\n  metrics.push(...dealMetrics);\n  \n  return metrics;\n}\n\n/**\n * Derive all metrics for portfolio\n * @param {Object[]} companies \n * @returns {{ byCompany: Object, all: Object[] }}\n */\nexport function derivePortfolioMetrics(companies) {\n  const byCompany = {};\n  const all = [];\n  \n  for (const company of companies) {\n    const companyMetrics = deriveCompanyMetrics(company);\n    byCompany[company.id] = companyMetrics;\n    all.push(...companyMetrics);\n  }\n  \n  return { byCompany, all };\n}\n\n/**\n * Get metrics by metricKey\n * @param {Object[]} metrics \n * @param {string} metricKey \n * @returns {Object[]}\n */\nexport function filterByMetricKey(metrics, metricKey) {\n  return metrics.filter(m => m.metricKey === metricKey);\n}\n\n/**\n * Calculate progress for a metric\n * @param {Object} metric \n * @returns {number} Progress 0-1\n */\nexport function calculateProgress(metric) {\n  if (!metric.target || metric.target === 0) return 0;\n  return Math.min(1, Math.max(0, metric.current / metric.target));\n}\n\n/**\n * Calculate days remaining to due date\n * @param {Object} metric \n * @param {Date} now \n * @returns {number|null}\n */\nexport function daysRemaining(metric, now) {\n  if (!metric.due) return null;\n  const due = new Date(metric.due);\n  const diffMs = due - now;\n  return Math.ceil(diffMs / (1000 * 60 * 60 * 24));\n}\n\nexport default {\n  deriveCompanyMetrics,\n  derivePortfolioMetrics,\n  filterByMetricKey,\n  calculateProgress,\n  daysRemaining\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1170, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/derive/goalTrajectory.js"],"sourcesContent":["/**\n * goalTrajectory.js ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â Goal Forecast & Probability-of-Hit (Phase 3.2)\n * \n * Extends trajectory.js with probability-based forecasting.\n * Outputs feed into pre-issues and action generation.\n * Derived output - never persisted.\n * \n * @module goalTrajectory\n */\n\nimport { deriveTrajectory, calculateVelocity } from './trajectory.js';\nimport { calculateProgress, daysRemaining } from './metrics.js';\n\n// =============================================================================\n// PROBABILITY OF HIT\n// =============================================================================\n\n/**\n * Calculate probability of hitting goal by due date\n * Uses trajectory data + progress + time remaining\n * \n * @param {Object} params\n * @param {number} params.progress - Current progress 0-1\n * @param {number|null} params.daysLeft - Days until due\n * @param {boolean|null} params.onTrack - From trajectory (null if unknown)\n * @param {number} params.confidence - Trajectory confidence 0-1\n * @param {number} params.velocity - Current velocity\n * @param {number} params.requiredVelocity - Velocity needed to hit target\n * @returns {number} Probability 0-1\n */\nexport function calculateProbabilityOfHit({\n  progress,\n  daysLeft,\n  onTrack,\n  confidence,\n  velocity,\n  requiredVelocity\n}) {\n  // Already achieved\n  if (progress >= 1) return 1;\n  \n  // Past due and not achieved\n  if (daysLeft !== null && daysLeft < 0) return 0;\n  \n  // Base probability from progress\n  let prob = progress * 0.3;\n  \n  // Trajectory component\n  if (onTrack === true) {\n    prob += 0.4 * confidence;\n  } else if (onTrack === false) {\n    // Scale down based on how far behind\n    if (velocity > 0 && requiredVelocity > 0) {\n      const velocityRatio = Math.min(1, velocity / requiredVelocity);\n      prob += 0.2 * velocityRatio * confidence;\n    }\n  } else {\n    // Unknown trajectory - use time-based heuristic\n    if (daysLeft !== null && daysLeft > 0) {\n      const timeBuffer = Math.min(1, daysLeft / 30); // More time = higher prob\n      prob += 0.2 * timeBuffer;\n    }\n  }\n  \n  // Time pressure adjustment\n  if (daysLeft !== null) {\n    if (daysLeft > 60) {\n      prob += 0.2; // Plenty of time\n    } else if (daysLeft > 30) {\n      prob += 0.15;\n    } else if (daysLeft > 14) {\n      prob += 0.1;\n    } else if (daysLeft > 7) {\n      prob += 0.05;\n    }\n    // Very little time - no bonus\n  }\n  \n  return Math.min(1, Math.max(0, prob));\n}\n\n// =============================================================================\n// GOAL TRAJECTORY DERIVATION\n// =============================================================================\n\n/**\n * Derive full trajectory + probability for a goal\n * \n * @param {Object} goal - Goal object\n * @param {Date} now - Reference date\n * @returns {Object} GoalTrajectory\n */\nexport function deriveGoalTrajectory(goal, now) {\n  // Get base trajectory\n  const trajectory = deriveTrajectory(goal, now);\n  \n  // Calculate progress\n  const progress = goal.target > 0 ? Math.min(1, goal.current / goal.target) : 0;\n  \n  // Days remaining\n  const daysLeft = goal.due ? daysRemaining({ due: goal.due }, now) : null;\n  \n  // Required velocity\n  const gap = goal.target - goal.current;\n  const requiredVelocity = daysLeft && daysLeft > 0 ? gap / daysLeft : Infinity;\n  \n  // Current velocity\n  const { velocity } = calculateVelocity(goal.history || []);\n  \n  // Probability of hit\n  const probabilityOfHit = calculateProbabilityOfHit({\n    progress,\n    daysLeft,\n    onTrack: trajectory.onTrack,\n    confidence: trajectory.confidence,\n    velocity,\n    requiredVelocity\n  });\n  \n  // Build explanation\n  const explain = [trajectory.explain];\n  if (probabilityOfHit >= 0.8) {\n    explain.push(`High confidence (${(probabilityOfHit * 100).toFixed(0)}%) of hitting target`);\n  } else if (probabilityOfHit >= 0.5) {\n    explain.push(`Moderate confidence (${(probabilityOfHit * 100).toFixed(0)}%) - may need acceleration`);\n  } else if (probabilityOfHit >= 0.2) {\n    explain.push(`At risk (${(probabilityOfHit * 100).toFixed(0)}%) - intervention needed`);\n  } else {\n    explain.push(`Unlikely to hit (${(probabilityOfHit * 100).toFixed(0)}%) without major change`);\n  }\n  \n  return {\n    goalId: goal.id,\n    goalName: goal.name,\n    goalType: goal.type,\n    metricKey: goal.type || 'custom',\n    \n    // Progress\n    current: goal.current,\n    target: goal.target,\n    progress,\n    \n    // Timing\n    due: goal.due,\n    daysLeft,\n    \n    // Trajectory\n    onTrack: trajectory.onTrack,\n    projectedDate: trajectory.projectedDate,\n    velocity,\n    requiredVelocity: isFinite(requiredVelocity) ? requiredVelocity : null,\n    \n    // Probability\n    probabilityOfHit,\n    confidence: trajectory.confidence,\n    \n    // Explanation\n    explain\n  };\n}\n\n/**\n * Derive goal trajectories for a company\n * \n * @param {Object} company\n * @param {Date} now\n * @returns {Object[]} Array of GoalTrajectory\n */\nexport function deriveCompanyGoalTrajectories(company, now) {\n  const trajectories = [];\n  \n  for (const goal of company.goals || []) {\n    if (goal.status === 'active') {\n      const traj = deriveGoalTrajectory(goal, now);\n      traj.companyId = company.id;\n      traj.companyName = company.name;\n      trajectories.push(traj);\n    }\n  }\n  \n  return trajectories;\n}\n\n/**\n * Derive goal trajectories for portfolio\n * \n * @param {Object[]} companies\n * @param {Date} now\n * @returns {{ byCompany: Object, all: Object[] }}\n */\nexport function derivePortfolioGoalTrajectories(companies, now) {\n  const byCompany = {};\n  const all = [];\n  \n  for (const company of companies) {\n    const trajectories = deriveCompanyGoalTrajectories(company, now);\n    byCompany[company.id] = trajectories;\n    all.push(...trajectories);\n  }\n  \n  return { byCompany, all };\n}\n\n/**\n * Get at-risk goals (probability < threshold)\n * \n * @param {Object[]} trajectories\n * @param {number} threshold - Default 0.5\n * @returns {Object[]}\n */\nexport function getAtRiskGoals(trajectories, threshold = 0.5) {\n  return trajectories\n    .filter(t => t.probabilityOfHit < threshold)\n    .sort((a, b) => a.probabilityOfHit - b.probabilityOfHit);\n}\n\nexport default {\n  calculateProbabilityOfHit,\n  deriveGoalTrajectory,\n  deriveCompanyGoalTrajectories,\n  derivePortfolioGoalTrajectories,\n  getAtRiskGoals\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1333, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/predict/issues.js"],"sourcesContent":["/**\n * issues.js - Issue Detection Engine (Phase E Compliance)\n * \n * DOCTRINE: Issues = Gaps\n * All absence, staleness, and deviation belong to Issues, not Health.\n * \n * E1: CANONICAL ISSUE OBJECT\n * Each Issue must include:\n * - issueId\n * - issueType  \n * - entityRef\n * - severity\n * - evidence\n * - detectedAt\n * \n * E2: ALL ABSENCE LIVES HERE\n * Examples:\n * - NO_GOALS\n * - DATA_MISSING\n * - DATA_STALE\n * - GOAL_BEHIND\n * \n * Pure derivation: no storage of computed values.\n * \n * @module issues\n */\n\nimport { deriveRunway } from '../derive/runway.js';\nimport { deriveTrajectory } from '../derive/trajectory.js';\n\n// =============================================================================\n// SEVERITY LEVELS\n// =============================================================================\n\nexport const SEVERITY = {\n  CRITICAL: 3,  // Immediate action required\n  HIGH: 2,      // Action needed soon\n  MEDIUM: 1,    // Should address\n  LOW: 0        // Nice to address\n};\n\n// =============================================================================\n// CANONICAL ISSUE TYPES (E2)\n// =============================================================================\n\nexport const ISSUE_TYPES = {\n  // Runway issues\n  RUNWAY_CRITICAL: 'RUNWAY_CRITICAL',\n  RUNWAY_WARNING: 'RUNWAY_WARNING',\n  \n  // Data issues (absence/staleness)\n  DATA_MISSING: 'DATA_MISSING',\n  DATA_STALE: 'DATA_STALE',\n  DATA_NO_TIMESTAMP: 'DATA_NO_TIMESTAMP',\n  \n  // Goal issues (absence/deviation)\n  NO_GOALS: 'NO_GOALS',\n  GOAL_BEHIND: 'GOAL_BEHIND',\n  GOAL_STALLED: 'GOAL_STALLED',\n  GOAL_MISSED: 'GOAL_MISSED',\n  GOAL_NO_HISTORY: 'GOAL_NO_HISTORY',\n  \n  // Deal/Pipeline issues\n  NO_PIPELINE: 'NO_PIPELINE',\n  PIPELINE_GAP: 'PIPELINE_GAP',\n  DEAL_STALE: 'DEAL_STALE',\n  DEAL_AT_RISK: 'DEAL_AT_RISK'\n};\n\n// =============================================================================\n// THRESHOLDS\n// =============================================================================\n\nconst THRESHOLDS = {\n  RUNWAY_CRITICAL_MONTHS: 6,\n  RUNWAY_WARNING_MONTHS: 12,\n  DATA_STALE_DAYS: 14,\n  DEAL_STALE_DAYS: 7,\n  GOAL_DEADLINE_BUFFER_DAYS: 7\n};\n\n// =============================================================================\n// UTILITY FUNCTIONS\n// =============================================================================\n\nfunction daysBetween(date1, date2) {\n  const d1 = new Date(date1);\n  const d2 = new Date(date2);\n  return Math.floor((d2 - d1) / (1000 * 60 * 60 * 24));\n}\n\nlet issueCounter = 0;\nfunction generateIssueId(type, entityId) {\n  issueCounter++;\n  return `${type}-${entityId}-${issueCounter}`;\n}\n\n/**\n * E1: Create canonical issue object\n */\nfunction createIssue({ issueType, entityRef, severity, evidence, detectedAt }) {\n  return {\n    issueId: generateIssueId(issueType, entityRef.id),\n    issueType,\n    entityRef,\n    severity,\n    evidence,\n    detectedAt,\n    // Legacy compatibility fields\n    type: issueType,\n    entity: entityRef,\n    explain: evidence.explain\n  };\n}\n\n// =============================================================================\n// ISSUE DETECTION FUNCTIONS\n// =============================================================================\n\n/**\n * Detect runway issues\n */\nfunction detectRunwayIssues(company, now) {\n  const issues = [];\n  \n  const runway = deriveRunway(\n    company.cash,\n    company.burn,\n    company.asOf,\n    company.asOf,\n    now\n  );\n\n  if (runway.value === null) {\n    issues.push(createIssue({\n      issueType: ISSUE_TYPES.DATA_MISSING,\n      entityRef: { type: 'company', id: company.id },\n      severity: SEVERITY.HIGH,\n      evidence: {\n        field: 'runway',\n        reason: 'missing_inputs',\n        inputs_missing: runway.inputs_missing,\n        explain: 'Cannot calculate runway: missing cash or burn data'\n      },\n      detectedAt: now.toISOString()\n    }));\n    return issues;\n  }\n\n  if (runway.value !== Infinity) {\n    if (runway.value < THRESHOLDS.RUNWAY_CRITICAL_MONTHS) {\n      issues.push(createIssue({\n        issueType: ISSUE_TYPES.RUNWAY_CRITICAL,\n        entityRef: { type: 'company', id: company.id },\n        severity: SEVERITY.CRITICAL,\n        evidence: {\n          value: runway.value,\n          threshold: THRESHOLDS.RUNWAY_CRITICAL_MONTHS,\n          explain: `Runway ${runway.value.toFixed(1)} months < ${THRESHOLDS.RUNWAY_CRITICAL_MONTHS} month critical threshold`\n        },\n        detectedAt: now.toISOString()\n      }));\n    } else if (runway.value < THRESHOLDS.RUNWAY_WARNING_MONTHS) {\n      issues.push(createIssue({\n        issueType: ISSUE_TYPES.RUNWAY_WARNING,\n        entityRef: { type: 'company', id: company.id },\n        severity: SEVERITY.HIGH,\n        evidence: {\n          value: runway.value,\n          threshold: THRESHOLDS.RUNWAY_WARNING_MONTHS,\n          explain: `Runway ${runway.value.toFixed(1)} months < ${THRESHOLDS.RUNWAY_WARNING_MONTHS} month warning threshold`\n        },\n        detectedAt: now.toISOString()\n      }));\n    }\n  }\n\n  return issues;\n}\n\n/**\n * Detect goal issues using trajectory\n */\nfunction detectGoalIssues(company, now) {\n  const issues = [];\n  const goals = company.goals || [];\n\n  // E2: NO_GOALS is an absence issue\n  if (goals.length === 0) {\n    issues.push(createIssue({\n      issueType: ISSUE_TYPES.NO_GOALS,\n      entityRef: { type: 'company', id: company.id },\n      severity: SEVERITY.MEDIUM,\n      evidence: {\n        reason: 'no_goals_defined',\n        explain: 'No goals defined - cannot track progress'\n      },\n      detectedAt: now.toISOString()\n    }));\n    return issues;\n  }\n\n  for (const goal of goals) {\n    if (goal.status !== 'active') continue;\n\n    const trajectory = deriveTrajectory(goal, now);\n    const dueDate = new Date(goal.due);\n    const daysToDeadline = daysBetween(now, dueDate);\n\n    // Goal already missed\n    if (daysToDeadline < 0 && goal.current < goal.target) {\n      issues.push(createIssue({\n        issueType: ISSUE_TYPES.GOAL_MISSED,\n        entityRef: { type: 'goal', id: goal.id, companyId: company.id },\n        severity: SEVERITY.HIGH,\n        evidence: {\n          goalName: goal.name || goal.type,\n          current: goal.current,\n          target: goal.target,\n          due: goal.due,\n          daysOverdue: Math.abs(daysToDeadline),\n          explain: trajectory.explain\n        },\n        detectedAt: now.toISOString()\n      }));\n      continue;\n    }\n\n    // Check trajectory status\n    if (trajectory.onTrack === false) {\n      if (trajectory.projectedDate === null) {\n        // Stalled (zero/negative velocity)\n        issues.push(createIssue({\n          issueType: ISSUE_TYPES.GOAL_STALLED,\n          entityRef: { type: 'goal', id: goal.id, companyId: company.id },\n          severity: SEVERITY.HIGH,\n          evidence: {\n            goalName: goal.name || goal.type,\n            current: goal.current,\n            target: goal.target,\n            due: goal.due,\n            explain: trajectory.explain\n          },\n          detectedAt: now.toISOString()\n        }));\n      } else {\n        // Behind schedule\n        const severity = daysToDeadline < THRESHOLDS.GOAL_DEADLINE_BUFFER_DAYS \n          ? SEVERITY.CRITICAL \n          : SEVERITY.HIGH;\n        \n        issues.push(createIssue({\n          issueType: ISSUE_TYPES.GOAL_BEHIND,\n          entityRef: { type: 'goal', id: goal.id, companyId: company.id },\n          severity,\n          evidence: {\n            goalName: goal.name || goal.type,\n            current: goal.current,\n            target: goal.target,\n            due: goal.due,\n            projectedDate: trajectory.projectedDate,\n            confidence: trajectory.confidence,\n            explain: trajectory.explain\n          },\n          detectedAt: now.toISOString()\n        }));\n      }\n    }\n\n    // Unknown trajectory (insufficient data)\n    if (trajectory.onTrack === null) {\n      issues.push(createIssue({\n        issueType: ISSUE_TYPES.GOAL_NO_HISTORY,\n        entityRef: { type: 'goal', id: goal.id, companyId: company.id },\n        severity: SEVERITY.LOW,\n        evidence: {\n          goalName: goal.name || goal.type,\n          reason: 'insufficient_history',\n          explain: trajectory.explain\n        },\n        detectedAt: now.toISOString()\n      }));\n    }\n  }\n\n  return issues;\n}\n\n/**\n * Detect deal pipeline issues\n */\nfunction detectDealIssues(company, now) {\n  const issues = [];\n  const deals = company.deals || [];\n\n  // Check if raising but no/insufficient pipeline\n  if (company.raising && company.roundTarget > 0) {\n    const totalPipeline = deals.reduce((sum, d) => sum + (d.amount || 0), 0);\n    const weightedPipeline = deals.reduce((sum, d) => \n      sum + (d.amount || 0) * (d.probability || 0) / 100, 0\n    );\n\n    if (deals.length === 0) {\n      issues.push(createIssue({\n        issueType: ISSUE_TYPES.NO_PIPELINE,\n        entityRef: { type: 'company', id: company.id },\n        severity: SEVERITY.CRITICAL,\n        evidence: {\n          roundTarget: company.roundTarget,\n          reason: 'no_deals',\n          explain: `Raising $${(company.roundTarget/1000000).toFixed(1)}M but no deals in pipeline`\n        },\n        detectedAt: now.toISOString()\n      }));\n    } else if (weightedPipeline < company.roundTarget * 0.5) {\n      issues.push(createIssue({\n        issueType: ISSUE_TYPES.PIPELINE_GAP,\n        entityRef: { type: 'company', id: company.id },\n        severity: SEVERITY.HIGH,\n        evidence: {\n          roundTarget: company.roundTarget,\n          weightedPipeline,\n          coverage: weightedPipeline / company.roundTarget,\n          explain: `Weighted pipeline $${(weightedPipeline/1000000).toFixed(1)}M < 50% of $${(company.roundTarget/1000000).toFixed(1)}M target`\n        },\n        detectedAt: now.toISOString()\n      }));\n    }\n  }\n\n  // Check individual deal health\n  for (const deal of deals) {\n    const daysSinceUpdate = daysBetween(deal.asOf, now);\n\n    // Stale deal\n    if (daysSinceUpdate > THRESHOLDS.DEAL_STALE_DAYS) {\n      issues.push(createIssue({\n        issueType: ISSUE_TYPES.DEAL_STALE,\n        entityRef: { type: 'deal', id: deal.id, companyId: company.id },\n        severity: SEVERITY.MEDIUM,\n        evidence: {\n          investor: deal.investor,\n          daysSinceUpdate,\n          threshold: THRESHOLDS.DEAL_STALE_DAYS,\n          explain: `Deal with ${deal.investor} not updated in ${daysSinceUpdate} days`\n        },\n        detectedAt: now.toISOString()\n      }));\n    }\n\n    // Low probability deals in late stages\n    if (deal.status === 'dd' && deal.probability < 50) {\n      issues.push(createIssue({\n        issueType: ISSUE_TYPES.DEAL_AT_RISK,\n        entityRef: { type: 'deal', id: deal.id, companyId: company.id },\n        severity: SEVERITY.MEDIUM,\n        evidence: {\n          investor: deal.investor,\n          status: deal.status,\n          probability: deal.probability,\n          explain: `Deal with ${deal.investor} in DD but only ${deal.probability}% probability`\n        },\n        detectedAt: now.toISOString()\n      }));\n    }\n  }\n\n  return issues;\n}\n\n/**\n * Detect data staleness issues\n */\nfunction detectDataIssues(company, now) {\n  const issues = [];\n\n  if (!company.asOf) {\n    issues.push(createIssue({\n      issueType: ISSUE_TYPES.DATA_NO_TIMESTAMP,\n      entityRef: { type: 'company', id: company.id },\n      severity: SEVERITY.HIGH,\n      evidence: {\n        reason: 'no_timestamp',\n        explain: 'Company data has no timestamp - freshness unknown'\n      },\n      detectedAt: now.toISOString()\n    }));\n    return issues;\n  }\n\n  const daysSinceUpdate = daysBetween(company.asOf, now);\n  \n  if (daysSinceUpdate > THRESHOLDS.DATA_STALE_DAYS) {\n    issues.push(createIssue({\n      issueType: ISSUE_TYPES.DATA_STALE,\n      entityRef: { type: 'company', id: company.id },\n      severity: SEVERITY.MEDIUM,\n      evidence: {\n        daysSinceUpdate,\n        threshold: THRESHOLDS.DATA_STALE_DAYS,\n        explain: `Company data ${daysSinceUpdate} days old (threshold: ${THRESHOLDS.DATA_STALE_DAYS})`\n      },\n      detectedAt: now.toISOString()\n    }));\n  }\n\n  return issues;\n}\n\n// =============================================================================\n// PUBLIC API\n// =============================================================================\n\n/**\n * Detect all issues for a company\n * \n * @param {Object} company - Company with facts\n * @param {Date} [now] - Reference date\n * @returns {{issues: Array, summary: Object}}\n */\nexport function detectIssues(company, now = new Date()) {\n  const refDate = typeof now === 'string' ? new Date(now) : now;\n  \n  // Reset issue counter for deterministic IDs within a run\n  issueCounter = 0;\n\n  const allIssues = [\n    ...detectRunwayIssues(company, refDate),\n    ...detectGoalIssues(company, refDate),\n    ...detectDealIssues(company, refDate),\n    ...detectDataIssues(company, refDate)\n  ];\n\n  // Sort by severity (highest first)\n  allIssues.sort((a, b) => b.severity - a.severity);\n\n  // Generate summary\n  const summary = {\n    total: allIssues.length,\n    critical: allIssues.filter(i => i.severity === SEVERITY.CRITICAL).length,\n    high: allIssues.filter(i => i.severity === SEVERITY.HIGH).length,\n    medium: allIssues.filter(i => i.severity === SEVERITY.MEDIUM).length,\n    low: allIssues.filter(i => i.severity === SEVERITY.LOW).length,\n    types: [...new Set(allIssues.map(i => i.issueType))]\n  };\n\n  return { issues: allIssues, summary };\n}\n\n/**\n * Detect issues across entire portfolio\n * \n * @param {Array<Object>} companies \n * @param {Date} [now]\n * @returns {{byCompany: Object, portfolio: Object}}\n */\nexport function detectPortfolioIssues(companies, now = new Date()) {\n  const refDate = typeof now === 'string' ? new Date(now) : now;\n  \n  const byCompany = {};\n  let allIssues = [];\n\n  for (const company of companies) {\n    const result = detectIssues(company, refDate);\n    byCompany[company.id] = result;\n    allIssues = allIssues.concat(result.issues);\n  }\n\n  // Sort all issues by severity\n  allIssues.sort((a, b) => b.severity - a.severity);\n\n  const portfolio = {\n    total: allIssues.length,\n    critical: allIssues.filter(i => i.severity === SEVERITY.CRITICAL).length,\n    high: allIssues.filter(i => i.severity === SEVERITY.HIGH).length,\n    medium: allIssues.filter(i => i.severity === SEVERITY.MEDIUM).length,\n    low: allIssues.filter(i => i.severity === SEVERITY.LOW).length,\n    topIssues: allIssues.slice(0, 10)\n  };\n\n  return { byCompany, portfolio };\n}\n\nexport default { detectIssues, detectPortfolioIssues, SEVERITY, ISSUE_TYPES };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1802, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/predict/ripple.js"],"sourcesContent":["/**\n * ripple.js - Ripple Effect Engine (Phase H)\n * \n * DOCTRINE: Predictive > Reactive (Scaffolded)\n * Ripple and likelihood may be primitive, but the architecture must allow them.\n * \n * H1: v0 Rule-Based Ripple\n * - Runway issues -> insolvency risk\n * - Pipeline issues -> fundraise risk  \n * - Data staleness -> confidence penalty\n * \n * Output:\n * - rippleScore (0-1)\n * - rippleExplain[]\n * \n * H2: Priority Incorporates Ripple\n * - Ripple affects rank explicitly\n * \n * @module ripple\n */\n\nimport { ISSUE_TYPES } from './issues.js';\n\n// =============================================================================\n// RIPPLE RULES (v0)\n// =============================================================================\n\n/**\n * Rule-based ripple effects\n * Each rule: condition -> downstream consequence\n */\nconst RIPPLE_RULES = {\n  // Runway issues cascade to insolvency\n  RUNWAY_CRITICAL: {\n    rippleScore: 0.9,\n    consequences: [\n      'High probability of insolvency within 6 months',\n      'Unable to make new hires or investments',\n      'Fundraise becomes distressed/down round',\n      'Team morale and retention at risk'\n    ]\n  },\n  \n  RUNWAY_WARNING: {\n    rippleScore: 0.5,\n    consequences: [\n      'Fundraise pressure increases',\n      'Strategic optionality reduced',\n      'May need to cut non-critical expenses'\n    ]\n  },\n  \n  // Pipeline issues cascade to fundraise failure\n  NO_PIPELINE: {\n    rippleScore: 0.8,\n    consequences: [\n      'Fundraise timeline at severe risk',\n      'May need to extend runway via cuts',\n      'Negotiating leverage diminished'\n    ]\n  },\n  \n  PIPELINE_GAP: {\n    rippleScore: 0.5,\n    consequences: [\n      'Fundraise may miss target or timeline',\n      'May need to accept less favorable terms'\n    ]\n  },\n  \n  // Goal issues cascade to metrics/narrative\n  GOAL_MISSED: {\n    rippleScore: 0.4,\n    consequences: [\n      'Investor confidence may decrease',\n      'Narrative for fundraise weakened'\n    ]\n  },\n  \n  GOAL_BEHIND: {\n    rippleScore: 0.3,\n    consequences: [\n      'May miss key milestones',\n      'Investor updates less compelling'\n    ]\n  },\n  \n  GOAL_STALLED: {\n    rippleScore: 0.5,\n    consequences: [\n      'Underlying blocker may be systemic',\n      'Team execution capability questioned'\n    ]\n  },\n  \n  // Deal issues cascade to specific opportunities\n  DEAL_STALE: {\n    rippleScore: 0.3,\n    consequences: [\n      'Investor interest may have cooled',\n      'Momentum lost in process'\n    ]\n  },\n  \n  DEAL_AT_RISK: {\n    rippleScore: 0.4,\n    consequences: [\n      'May lose this investor entirely',\n      'Need to rebuild pipeline'\n    ]\n  },\n  \n  // Data issues cascade to decision quality\n  DATA_STALE: {\n    rippleScore: 0.2,\n    consequences: [\n      'Decisions based on outdated information',\n      'May miss emerging problems'\n    ]\n  },\n  \n  DATA_MISSING: {\n    rippleScore: 0.3,\n    consequences: [\n      'Cannot assess true state',\n      'Blind spots in portfolio view'\n    ]\n  },\n  \n  // Default for unmapped issues\n  DEFAULT: {\n    rippleScore: 0.1,\n    consequences: ['Minor downstream effects possible']\n  }\n};\n\n// =============================================================================\n// RIPPLE CALCULATION\n// =============================================================================\n\n/**\n * Calculate ripple effect for a single issue\n * \n * @param {Object} issue \n * @returns {{rippleScore: number, rippleExplain: string[]}}\n */\nexport function calculateIssueRipple(issue) {\n  const rule = RIPPLE_RULES[issue.issueType] || RIPPLE_RULES.DEFAULT;\n  \n  return {\n    rippleScore: rule.rippleScore,\n    rippleExplain: rule.consequences\n  };\n}\n\n/**\n * Calculate aggregate ripple for a set of issues\n * Uses max ripple with diminishing returns for additional issues\n * \n * @param {Array<Object>} issues \n * @returns {{rippleScore: number, rippleExplain: string[], byIssue: Object[]}}\n */\nexport function calculateAggregateRipple(issues) {\n  if (!issues || issues.length === 0) {\n    return {\n      rippleScore: 0,\n      rippleExplain: ['No issues detected'],\n      byIssue: []\n    };\n  }\n\n  const byIssue = issues.map(issue => ({\n    issueId: issue.issueId,\n    issueType: issue.issueType,\n    ...calculateIssueRipple(issue)\n  }));\n\n  // Sort by ripple score descending\n  byIssue.sort((a, b) => b.rippleScore - a.rippleScore);\n\n  // Aggregate: max + diminishing contribution from others\n  let aggregateScore = 0;\n  const allExplanations = [];\n  \n  for (let i = 0; i < byIssue.length; i++) {\n    const issue = byIssue[i];\n    // First issue contributes full score, subsequent issues contribute less\n    const contribution = issue.rippleScore * Math.pow(0.5, i);\n    aggregateScore += contribution;\n    \n    // Only include explanations from significant ripples\n    if (issue.rippleScore >= 0.3) {\n      allExplanations.push(...issue.rippleExplain);\n    }\n  }\n\n  // Cap at 1.0\n  aggregateScore = Math.min(aggregateScore, 1.0);\n  aggregateScore = Math.round(aggregateScore * 100) / 100;\n\n  return {\n    rippleScore: aggregateScore,\n    rippleExplain: [...new Set(allExplanations)], // Deduplicate\n    byIssue\n  };\n}\n\n/**\n * Calculate ripple for a company based on its issues\n * \n * @param {Object} company \n * @param {Array<Object>} issues - Pre-detected issues for this company\n * @returns {{rippleScore: number, rippleExplain: string[], riskLevel: string}}\n */\nexport function calculateCompanyRipple(company, issues) {\n  const ripple = calculateAggregateRipple(issues);\n  \n  // Determine risk level\n  let riskLevel;\n  if (ripple.rippleScore >= 0.7) {\n    riskLevel = 'HIGH';\n  } else if (ripple.rippleScore >= 0.4) {\n    riskLevel = 'MEDIUM';\n  } else {\n    riskLevel = 'LOW';\n  }\n\n  return {\n    companyId: company.id,\n    companyName: company.name,\n    rippleScore: ripple.rippleScore,\n    rippleExplain: ripple.rippleExplain,\n    riskLevel,\n    byIssue: ripple.byIssue\n  };\n}\n\n/**\n * Adjust priority score based on ripple effect\n * H2: Priority Incorporates Ripple\n * \n * @param {number} basePriority - Original priority score\n * @param {number} rippleScore - Ripple score 0-1\n * @param {number} [weight=0.2] - How much ripple affects priority\n * @returns {number}\n */\nexport function adjustPriorityForRipple(basePriority, rippleScore, weight = 0.2) {\n  // Ripple boosts priority of high-ripple issues\n  const adjustment = rippleScore * weight;\n  const adjusted = basePriority * (1 + adjustment);\n  return Math.round(adjusted * 100) / 100;\n}\n\nexport default {\n  calculateIssueRipple,\n  calculateAggregateRipple,\n  calculateCompanyRipple,\n  adjustPriorityForRipple,\n  RIPPLE_RULES\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2021, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/predict/preissues.js"],"sourcesContent":["/**\n * preissues.js - Forecasted Issues (Phase 4.0 PF2)\n * \n * Pre-issues are issues that will likely emerge if no action is taken.\n * They generate preventative actions.\n * \n * PF2 Additions:\n * - Escalation window (T + delta): when pre-issue becomes real issue\n * - Cost-of-delay curve: how cost increases over time\n * - Imminent pre-issues convert to Actions\n * \n * NO ALERTS, NO SEVERITY COLORS - just data for ranking.\n * Derived output - never persisted.\n * \n * @module preissues\n */\n\nimport { deriveRunway } from '../derive/runway.js';\n\n// =============================================================================\n// PRE-ISSUE TYPES\n// =============================================================================\n\nexport const PREISSUE_TYPES = {\n  RUNWAY_BREACH: 'RUNWAY_BREACH',\n  GOAL_MISS: 'GOAL_MISS',\n  DEAL_STALL: 'DEAL_STALL',\n  BURN_ACCELERATION: 'BURN_ACCELERATION',\n  TEAM_CAPACITY: 'TEAM_CAPACITY'\n};\n\n// =============================================================================\n// PF2: ESCALATION WINDOW COMPUTATION\n// =============================================================================\n\n/**\n * Compute escalation window: when pre-issue becomes real issue\n * Returns { escalationDate, daysUntilEscalation, isImminent }\n * \n * @param {Object} preissue\n * @param {Date} now\n * @returns {Object}\n */\nfunction computeEscalationWindow(preissue, now) {\n  const timeToBreachDays = preissue.timeToBreachDays || 30;\n  \n  // Escalation happens when:\n  // - For runway: when we hit critical threshold (not just breach)\n  // - For goals: when we can no longer catch up mathematically\n  // - For deals: when momentum is lost\n  \n  // Delta = buffer before breach where intervention is still effective\n  let deltaDays;\n  switch (preissue.preIssueType) {\n    case PREISSUE_TYPES.RUNWAY_BREACH:\n      // Need 3-6 months to raise, so escalate early\n      deltaDays = Math.max(0, timeToBreachDays - 90);\n      break;\n    case PREISSUE_TYPES.GOAL_MISS:\n      // Need time to course correct\n      deltaDays = Math.max(0, timeToBreachDays - 14);\n      break;\n    case PREISSUE_TYPES.DEAL_STALL:\n      // Deals go cold fast\n      deltaDays = Math.max(0, timeToBreachDays - 7);\n      break;\n    default:\n      deltaDays = Math.max(0, timeToBreachDays - 14);\n  }\n  \n  const escalationDate = new Date(now.getTime() + deltaDays * 24 * 60 * 60 * 1000);\n  const daysUntilEscalation = deltaDays;\n  \n  // Imminent = escalation within 7 days\n  const isImminent = daysUntilEscalation <= 7;\n  \n  return {\n    escalationDate: escalationDate.toISOString(),\n    daysUntilEscalation,\n    isImminent,\n    breachDate: new Date(now.getTime() + timeToBreachDays * 24 * 60 * 60 * 1000).toISOString()\n  };\n}\n\n// =============================================================================\n// PF2: COST-OF-DELAY CURVE\n// =============================================================================\n\n/**\n * Compute cost-of-delay curve\n * Returns multiplier showing how cost increases if action is delayed\n * \n * Formula: cost increases non-linearly as we approach escalation\n * - At T-30 days: 1.0x (baseline)\n * - At T-14 days: 1.5x\n * - At T-7 days: 2.5x\n * - At T-0 (escalation): 5.0x\n * - Post-escalation: 10x+ (damage done)\n * \n * @param {number} daysUntilEscalation\n * @param {string} preIssueType\n * @returns {{ costMultiplier: number, costCurve: Object, explain: string }}\n */\nfunction computeCostOfDelay(daysUntilEscalation, preIssueType) {\n  // Cost curve: exponential as we approach escalation\n  let costMultiplier;\n  let explain;\n  \n  if (daysUntilEscalation > 30) {\n    costMultiplier = 1.0;\n    explain = 'Baseline cost - ample time to act';\n  } else if (daysUntilEscalation > 14) {\n    costMultiplier = 1.0 + (30 - daysUntilEscalation) / 32; // 1.0 to 1.5\n    explain = 'Cost rising - action window narrowing';\n  } else if (daysUntilEscalation > 7) {\n    costMultiplier = 1.5 + (14 - daysUntilEscalation) / 7; // 1.5 to 2.5\n    explain = 'Elevated cost - limited options remaining';\n  } else if (daysUntilEscalation > 0) {\n    costMultiplier = 2.5 + (7 - daysUntilEscalation) / 2.8; // 2.5 to 5.0\n    explain = 'High cost - urgent action required';\n  } else {\n    costMultiplier = 5.0 + Math.abs(daysUntilEscalation) / 2; // 5.0+\n    explain = 'Critical cost - damage accumulating';\n  }\n  \n  // Adjust by type - some pre-issues have steeper cost curves\n  const typeMultiplier = {\n    [PREISSUE_TYPES.RUNWAY_BREACH]: 1.5, // Existential\n    [PREISSUE_TYPES.GOAL_MISS]: 1.0,\n    [PREISSUE_TYPES.DEAL_STALL]: 1.2, // Momentum matters\n    [PREISSUE_TYPES.BURN_ACCELERATION]: 1.3,\n    [PREISSUE_TYPES.TEAM_CAPACITY]: 0.9\n  };\n  \n  costMultiplier *= (typeMultiplier[preIssueType] || 1.0);\n  \n  // Build curve data points for visualization (not for alerts!)\n  const costCurve = {\n    today: costMultiplier,\n    in7Days: computeCostAtDays(daysUntilEscalation - 7, preIssueType),\n    in14Days: computeCostAtDays(daysUntilEscalation - 14, preIssueType),\n    atEscalation: computeCostAtDays(0, preIssueType)\n  };\n  \n  return {\n    costMultiplier: Math.round(costMultiplier * 100) / 100,\n    costCurve,\n    explain\n  };\n}\n\n/**\n * Helper to compute cost at specific days-until-escalation\n */\nfunction computeCostAtDays(days, preIssueType) {\n  let cost;\n  if (days > 30) cost = 1.0;\n  else if (days > 14) cost = 1.0 + (30 - days) / 32;\n  else if (days > 7) cost = 1.5 + (14 - days) / 7;\n  else if (days > 0) cost = 2.5 + (7 - days) / 2.8;\n  else cost = 5.0 + Math.abs(days) / 2;\n  \n  const typeMultiplier = {\n    [PREISSUE_TYPES.RUNWAY_BREACH]: 1.5,\n    [PREISSUE_TYPES.GOAL_MISS]: 1.0,\n    [PREISSUE_TYPES.DEAL_STALL]: 1.2,\n    [PREISSUE_TYPES.BURN_ACCELERATION]: 1.3,\n    [PREISSUE_TYPES.TEAM_CAPACITY]: 0.9\n  };\n  \n  return Math.round(cost * (typeMultiplier[preIssueType] || 1.0) * 100) / 100;\n}\n\n// =============================================================================\n// PRE-ISSUE DETECTION\n// =============================================================================\n\n/**\n * Detect runway breach pre-issue\n */\nfunction detectRunwayBreachPreIssue(company, runwayData, now) {\n  if (!runwayData || runwayData.months === null || runwayData.months === undefined) return null;\n  \n  const criticalThreshold = 6;\n  const warningThreshold = 9;\n  \n  if (runwayData.months >= warningThreshold) return null;\n  \n  const daysToBreachEstimate = runwayData.months * 30;\n  const likelihood = runwayData.months < criticalThreshold ? 0.8 : 0.5;\n  const runwayMonthsStr = typeof runwayData.months === 'number' ? runwayData.months.toFixed(1) : 'unknown';\n  \n  const preissue = {\n    preIssueId: `preissue-runway-${company.id}`,\n    preIssueType: PREISSUE_TYPES.RUNWAY_BREACH,\n    entityRef: { type: 'company', id: company.id },\n    companyId: company.id,\n    companyName: company.name,\n    title: `Runway will breach ${criticalThreshold}mo threshold`,\n    description: `Current runway: ${runwayMonthsStr} months. Without fundraise or burn reduction, will hit critical level.`,\n    likelihood,\n    timeToBreachDays: daysToBreachEstimate,\n    severity: runwayData.months < criticalThreshold ? 'high' : 'medium',\n    explain: [\n      `Runway: ${runwayMonthsStr} months`,\n      `Burn: $${(company.burn / 1000).toFixed(0)}K/mo`,\n      likelihood > 0.7 ? 'High likelihood without intervention' : 'Moderate likelihood'\n    ],\n    preventativeActions: ['REDUCE_BURN', 'ACCELERATE_FUNDRAISE', 'BRIDGE_ROUND']\n  };\n  \n  // PF2: Add escalation window and cost-of-delay\n  const escalation = computeEscalationWindow(preissue, now);\n  const costOfDelay = computeCostOfDelay(escalation.daysUntilEscalation, preissue.preIssueType);\n  \n  return {\n    ...preissue,\n    escalation,\n    costOfDelay\n  };\n}\n\n/**\n * Detect goal miss pre-issue from trajectory\n */\nfunction detectGoalMissPreIssue(trajectory, company, now) {\n  if (trajectory.probabilityOfHit >= 0.6 || trajectory.probabilityOfHit === 0) return null;\n  if (trajectory.onTrack === true) return null;\n  if (trajectory.daysLeft === null || trajectory.daysLeft < 0) return null;\n  \n  const preissue = {\n    preIssueId: `preissue-goal-${company.id}-${trajectory.goalId}`,\n    preIssueType: PREISSUE_TYPES.GOAL_MISS,\n    entityRef: { type: 'company', id: company.id },\n    companyId: company.id,\n    companyName: company.name,\n    goalId: trajectory.goalId,\n    goalName: trajectory.goalName,\n    goalType: trajectory.goalType,\n    title: `Goal \"${trajectory.goalName}\" likely to miss target`,\n    description: `${(trajectory.probabilityOfHit * 100).toFixed(0)}% probability of hitting ${trajectory.target} by ${trajectory.due}. Currently at ${trajectory.current}.`,\n    likelihood: 1 - trajectory.probabilityOfHit,\n    timeToBreachDays: trajectory.daysLeft,\n    severity: trajectory.probabilityOfHit < 0.3 ? 'high' : 'medium',\n    explain: trajectory.explain,\n    preventativeActions: ['ACCELERATE_GOAL', 'REVISE_TARGET', 'ADD_RESOURCES']\n  };\n  \n  // PF2: Add escalation window and cost-of-delay\n  const escalation = computeEscalationWindow(preissue, now);\n  const costOfDelay = computeCostOfDelay(escalation.daysUntilEscalation, preissue.preIssueType);\n  \n  return {\n    ...preissue,\n    escalation,\n    costOfDelay\n  };\n}\n\n/**\n * Detect deal stall pre-issue\n */\nfunction detectDealStallPreIssues(company, now) {\n  const preissues = [];\n  \n  for (const deal of company.deals || []) {\n    if (!deal.asOf) continue;\n    \n    const lastUpdate = new Date(deal.asOf);\n    const daysSinceUpdate = (now - lastUpdate) / (1000 * 60 * 60 * 24);\n    \n    if (daysSinceUpdate > 14 && deal.status !== 'closed') {\n      const likelihood = Math.min(0.9, 0.3 + (daysSinceUpdate - 14) / 30);\n      \n      const preissue = {\n        preIssueId: `preissue-deal-${company.id}-${deal.id}`,\n        preIssueType: PREISSUE_TYPES.DEAL_STALL,\n        entityRef: { type: 'deal', id: deal.id },\n        companyId: company.id,\n        companyName: company.name,\n        dealId: deal.id,\n        investor: deal.investor,\n        title: `Deal with ${deal.investor} may be stalling`,\n        description: `No update in ${Math.floor(daysSinceUpdate)} days. Status: ${deal.status}. Amount: $${(deal.amount / 1000000).toFixed(1)}M`,\n        likelihood,\n        timeToBreachDays: 14,\n        severity: deal.amount > 2000000 ? 'high' : 'medium',\n        explain: [\n          `${Math.floor(daysSinceUpdate)} days since last update`,\n          `Current status: ${deal.status}`,\n          `Deal value: $${(deal.amount / 1000000).toFixed(1)}M`\n        ],\n        preventativeActions: ['FOLLOW_UP_INVESTOR', 'SCHEDULE_CHECK_IN', 'PREPARE_ALTERNATIVES']\n      };\n      \n      // PF2: Add escalation window and cost-of-delay\n      const escalation = computeEscalationWindow(preissue, now);\n      const costOfDelay = computeCostOfDelay(escalation.daysUntilEscalation, preissue.preIssueType);\n      \n      preissues.push({\n        ...preissue,\n        escalation,\n        costOfDelay\n      });\n    }\n  }\n  \n  return preissues;\n}\n\n// =============================================================================\n// MAIN DERIVATION\n// =============================================================================\n\n/**\n * Derive pre-issues for a company\n */\nexport function deriveCompanyPreIssues(company, goalTrajectories, runwayData, now) {\n  const preissues = [];\n  \n  const runwayPreIssue = detectRunwayBreachPreIssue(company, runwayData, now);\n  if (runwayPreIssue) preissues.push(runwayPreIssue);\n  \n  for (const traj of goalTrajectories) {\n    const goalPreIssue = detectGoalMissPreIssue(traj, company, now);\n    if (goalPreIssue) preissues.push(goalPreIssue);\n  }\n  \n  const dealPreIssues = detectDealStallPreIssues(company, now);\n  preissues.push(...dealPreIssues);\n  \n  return preissues;\n}\n\n/**\n * Derive pre-issues for portfolio\n */\nexport function derivePortfolioPreIssues(companies, goalTrajectoriesByCompany, runwayByCompany, now) {\n  const byCompany = {};\n  const all = [];\n  \n  for (const company of companies) {\n    const trajectories = goalTrajectoriesByCompany[company.id] || [];\n    const runway = runwayByCompany[company.id] || null;\n    const companyPreIssues = deriveCompanyPreIssues(company, trajectories, runway, now);\n    byCompany[company.id] = companyPreIssues;\n    all.push(...companyPreIssues);\n  }\n  \n  return { byCompany, all };\n}\n\n/**\n * PF2: Get imminent pre-issues that should become Actions\n * @param {Object[]} preissues\n * @returns {Object[]} Pre-issues where escalation is imminent\n */\nexport function getImminentPreIssues(preissues) {\n  return preissues.filter(p => p.escalation?.isImminent === true);\n}\n\n/**\n * PF2: Rank pre-issues by cost-of-delay urgency\n * Higher cost multiplier = higher priority\n * @param {Object[]} preissues\n * @returns {Object[]}\n */\nexport function rankPreIssuesByCostOfDelay(preissues) {\n  return [...preissues].sort((a, b) => {\n    const costA = a.costOfDelay?.costMultiplier || 1;\n    const costB = b.costOfDelay?.costMultiplier || 1;\n    return costB - costA;\n  });\n}\n\n/**\n * Validate pre-issue structure\n */\nexport function validatePreIssue(preissue) {\n  const errors = [];\n  \n  if (!preissue.preIssueId) errors.push('Missing preIssueId');\n  if (!preissue.preIssueType) errors.push('Missing preIssueType');\n  if (!preissue.entityRef) errors.push('Missing entityRef');\n  if (typeof preissue.likelihood !== 'number') errors.push('likelihood must be number');\n  if (preissue.likelihood < 0 || preissue.likelihood > 1) errors.push('likelihood must be 0-1');\n  if (typeof preissue.timeToBreachDays !== 'number') errors.push('timeToBreachDays must be number');\n  if (!Array.isArray(preissue.explain)) errors.push('explain must be array');\n  \n  // PF2 validations\n  if (!preissue.escalation) errors.push('Missing escalation window');\n  if (!preissue.costOfDelay) errors.push('Missing costOfDelay');\n  \n  return { valid: errors.length === 0, errors };\n}\n\nexport default {\n  PREISSUE_TYPES,\n  deriveCompanyPreIssues,\n  derivePortfolioPreIssues,\n  validatePreIssue,\n  getImminentPreIssues,\n  rankPreIssuesByCostOfDelay,\n  computeEscalationWindow,\n  computeCostOfDelay\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2388, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/predict/resolutions.js"],"sourcesContent":["/**\n * resolutions.js - Resolution Library (Phase F)\n * \n * F1: Map issue types to resolution templates.\n * F2: No free text - Priorities must reference resolutionId.\n * \n * Each resolution defines:\n * - resolutionId\n * - title\n * - defaultEffort (days)\n * - defaultImpact (0-1)\n * - actionSteps[]\n * \n * @module resolutions\n */\n\nimport { ISSUE_TYPES } from './issues.js';\n\n// =============================================================================\n// RESOLUTION DEFINITIONS\n// =============================================================================\n\nexport const RESOLUTIONS = {\n  // =========================================================================\n  // RUNWAY RESOLUTIONS\n  // =========================================================================\n  \n  RESOLVE_RUNWAY_CRITICAL: {\n    resolutionId: 'RESOLVE_RUNWAY_CRITICAL',\n    issueType: ISSUE_TYPES.RUNWAY_CRITICAL,\n    title: 'Emergency runway extension',\n    defaultEffort: 30,\n    defaultImpact: 1.0,\n    actionSteps: [\n      'Assess immediate cost reduction options',\n      'Identify bridge funding sources',\n      'Initiate emergency fundraise conversations',\n      'Prepare 30-60-90 day cash plan'\n    ]\n  },\n  \n  RESOLVE_RUNWAY_WARNING: {\n    resolutionId: 'RESOLVE_RUNWAY_WARNING',\n    issueType: ISSUE_TYPES.RUNWAY_WARNING,\n    title: 'Plan runway extension',\n    defaultEffort: 14,\n    defaultImpact: 0.7,\n    actionSteps: [\n      'Review burn rate optimization opportunities',\n      'Start fundraise planning if not already',\n      'Evaluate revenue acceleration options',\n      'Build 6-month financial projection'\n    ]\n  },\n  \n  // =========================================================================\n  // DATA RESOLUTIONS\n  // =========================================================================\n  \n  RESOLVE_DATA_MISSING: {\n    resolutionId: 'RESOLVE_DATA_MISSING',\n    issueType: ISSUE_TYPES.DATA_MISSING,\n    title: 'Gather missing data',\n    defaultEffort: 1,\n    defaultImpact: 0.4,\n    actionSteps: [\n      'Identify missing data fields',\n      'Request data from company',\n      'Update system with new data',\n      'Verify data completeness'\n    ]\n  },\n  \n  RESOLVE_DATA_STALE: {\n    resolutionId: 'RESOLVE_DATA_STALE',\n    issueType: ISSUE_TYPES.DATA_STALE,\n    title: 'Request data update',\n    defaultEffort: 0.5,\n    defaultImpact: 0.3,\n    actionSteps: [\n      'Request updated metrics from company',\n      'Update system timestamps',\n      'Flag any significant changes'\n    ]\n  },\n  \n  RESOLVE_DATA_NO_TIMESTAMP: {\n    resolutionId: 'RESOLVE_DATA_NO_TIMESTAMP',\n    issueType: ISSUE_TYPES.DATA_NO_TIMESTAMP,\n    title: 'Add data timestamps',\n    defaultEffort: 0.25,\n    defaultImpact: 0.3,\n    actionSteps: [\n      'Add asOf timestamp to data',\n      'Record provenance information'\n    ]\n  },\n  \n  // =========================================================================\n  // GOAL RESOLUTIONS\n  // =========================================================================\n  \n  RESOLVE_NO_GOALS: {\n    resolutionId: 'RESOLVE_NO_GOALS',\n    issueType: ISSUE_TYPES.NO_GOALS,\n    title: 'Define measurable goals',\n    defaultEffort: 2,\n    defaultImpact: 0.5,\n    actionSteps: [\n      'Schedule goal-setting session with founders',\n      'Define 2-3 key metrics with targets',\n      'Set deadlines for each goal',\n      'Enter goals into system'\n    ]\n  },\n  \n  RESOLVE_GOAL_BEHIND: {\n    resolutionId: 'RESOLVE_GOAL_BEHIND',\n    issueType: ISSUE_TYPES.GOAL_BEHIND,\n    title: 'Course correct goal trajectory',\n    defaultEffort: 3,\n    defaultImpact: 0.6,\n    actionSteps: [\n      'Analyze root cause of delay',\n      'Identify acceleration opportunities',\n      'Consider target or deadline adjustment',\n      'Implement corrective actions'\n    ]\n  },\n  \n  RESOLVE_GOAL_STALLED: {\n    resolutionId: 'RESOLVE_GOAL_STALLED',\n    issueType: ISSUE_TYPES.GOAL_STALLED,\n    title: 'Diagnose and restart stalled goal',\n    defaultEffort: 2,\n    defaultImpact: 0.7,\n    actionSteps: [\n      'Identify blockers causing stall',\n      'Reallocate resources if needed',\n      'Consider goal relevance',\n      'Establish new momentum'\n    ]\n  },\n  \n  RESOLVE_GOAL_MISSED: {\n    resolutionId: 'RESOLVE_GOAL_MISSED',\n    issueType: ISSUE_TYPES.GOAL_MISSED,\n    title: 'Post-mortem and reset goal',\n    defaultEffort: 1,\n    defaultImpact: 0.5,\n    actionSteps: [\n      'Conduct goal post-mortem',\n      'Document lessons learned',\n      'Decide: abandon, extend, or redefine',\n      'Update goal status in system'\n    ]\n  },\n  \n  RESOLVE_GOAL_NO_HISTORY: {\n    resolutionId: 'RESOLVE_GOAL_NO_HISTORY',\n    issueType: ISSUE_TYPES.GOAL_NO_HISTORY,\n    title: 'Add historical data points',\n    defaultEffort: 0.5,\n    defaultImpact: 0.2,\n    actionSteps: [\n      'Request historical progress data',\n      'Add past data points to goal history',\n      'Verify trajectory calculation works'\n    ]\n  },\n  \n  // =========================================================================\n  // PIPELINE RESOLUTIONS\n  // =========================================================================\n  \n  RESOLVE_NO_PIPELINE: {\n    resolutionId: 'RESOLVE_NO_PIPELINE',\n    issueType: ISSUE_TYPES.NO_PIPELINE,\n    title: 'Begin investor outreach',\n    defaultEffort: 7,\n    defaultImpact: 0.9,\n    actionSteps: [\n      'Build target investor list',\n      'Prepare outreach materials',\n      'Start initial outreach',\n      'Track responses and schedule meetings'\n    ]\n  },\n  \n  RESOLVE_PIPELINE_GAP: {\n    resolutionId: 'RESOLVE_PIPELINE_GAP',\n    issueType: ISSUE_TYPES.PIPELINE_GAP,\n    title: 'Expand investor pipeline',\n    defaultEffort: 5,\n    defaultImpact: 0.7,\n    actionSteps: [\n      'Identify additional target investors',\n      'Request warm introductions',\n      'Increase outreach velocity',\n      'Review and optimize materials'\n    ]\n  },\n  \n  RESOLVE_DEAL_STALE: {\n    resolutionId: 'RESOLVE_DEAL_STALE',\n    issueType: ISSUE_TYPES.DEAL_STALE,\n    title: 'Follow up with investor',\n    defaultEffort: 0.5,\n    defaultImpact: 0.5,\n    actionSteps: [\n      'Send follow-up email or message',\n      'Provide any requested updates',\n      'Confirm next steps',\n      'Update deal status'\n    ]\n  },\n  \n  RESOLVE_DEAL_AT_RISK: {\n    resolutionId: 'RESOLVE_DEAL_AT_RISK',\n    issueType: ISSUE_TYPES.DEAL_AT_RISK,\n    title: 'Address investor concerns',\n    defaultEffort: 2,\n    defaultImpact: 0.6,\n    actionSteps: [\n      'Schedule call with investor',\n      'Identify specific concerns',\n      'Prepare responses to objections',\n      'Provide additional materials if needed'\n    ]\n  }\n};\n\n// =============================================================================\n// LOOKUP FUNCTIONS\n// =============================================================================\n\n/**\n * Get resolution for an issue type\n * @param {string} issueType \n * @returns {Object|null}\n */\nexport function getResolution(issueType) {\n  for (const resolution of Object.values(RESOLUTIONS)) {\n    if (resolution.issueType === issueType) {\n      return resolution;\n    }\n  }\n  return null;\n}\n\n/**\n * Get resolution by ID\n * @param {string} resolutionId \n * @returns {Object|null}\n */\nexport function getResolutionById(resolutionId) {\n  return RESOLUTIONS[resolutionId] || null;\n}\n\n/**\n * Get all resolutions as array\n * @returns {Array<Object>}\n */\nexport function getAllResolutions() {\n  return Object.values(RESOLUTIONS);\n}\n\n/**\n * Validate that an issue type has a resolution\n * @param {string} issueType \n * @returns {boolean}\n */\nexport function hasResolution(issueType) {\n  return getResolution(issueType) !== null;\n}\n\nexport default {\n  RESOLUTIONS,\n  getResolution,\n  getResolutionById,\n  getAllResolutions,\n  hasResolution\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2644, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/predict/actionSchema.js"],"sourcesContent":["/**\n * actionSchema.js - Canonical Action Schema (Phase 4.0)\n * \n * LOCKED SCHEMA: No changes without version bump.\n * \n * Actions are the primary decisioning artifact.\n * Every Action must carry a complete, explainable impact model.\n * \n * Phase 4.0 (PF1): Added executionProbability to impact model\n * Combined probability = executionProbability * probabilityOfSuccess\n * \n * @module actionSchema\n */\n\nimport { createHash } from 'crypto';\n\n// =============================================================================\n// ENTITY TYPES\n// =============================================================================\n\nexport const ENTITY_TYPES = ['company', 'deal', 'person', 'portfolio', 'other'];\n\nexport const SOURCE_TYPES = ['ISSUE', 'PREISSUE', 'GOAL', 'MANUAL', 'INTRODUCTION'];\n\n// =============================================================================\n// IMPACT DIMENSION BOUNDS\n// =============================================================================\n\nexport const IMPACT_BOUNDS = {\n  upsideMagnitude: { min: 0, max: 100 },\n  probabilityOfSuccess: { min: 0, max: 1 },\n  executionProbability: { min: 0, max: 1 },  // PF1: Will founder actually do it?\n  downsideMagnitude: { min: 0, max: 100 },\n  timeToImpactDays: { min: 0, max: Infinity },\n  effortCost: { min: 0, max: 100 },\n  secondOrderLeverage: { min: 0, max: 100 }\n};\n\n// =============================================================================\n// SCHEMA VALIDATION\n// =============================================================================\n\n/**\n * Validate EntityRef\n * @param {any} ref \n * @returns {{ valid: boolean, errors: string[] }}\n */\nexport function validateEntityRef(ref) {\n  const errors = [];\n  \n  if (!ref || typeof ref !== 'object') {\n    return { valid: false, errors: ['entityRef must be an object'] };\n  }\n  \n  if (!ENTITY_TYPES.includes(ref.type)) {\n    errors.push(`entityRef.type must be one of: ${ENTITY_TYPES.join(', ')}`);\n  }\n  \n  if (typeof ref.id !== 'string' || !ref.id) {\n    errors.push('entityRef.id must be a non-empty string');\n  }\n  \n  return { valid: errors.length === 0, errors };\n}\n\n/**\n * Validate ActionSource\n * @param {any} source \n * @returns {{ valid: boolean, errors: string[] }}\n */\nexport function validateActionSource(source) {\n  const errors = [];\n  \n  if (!source || typeof source !== 'object') {\n    return { valid: false, errors: ['source must be an object'] };\n  }\n  \n  if (!SOURCE_TYPES.includes(source.sourceType)) {\n    errors.push(`sourceType must be one of: ${SOURCE_TYPES.join(', ')}`);\n  }\n  \n  switch (source.sourceType) {\n    case 'ISSUE':\n      if (!source.issueId) errors.push('ISSUE source requires issueId');\n      if (!source.issueType) errors.push('ISSUE source requires issueType');\n      break;\n    case 'PREISSUE':\n      if (!source.preIssueId) errors.push('PREISSUE source requires preIssueId');\n      if (!source.preIssueType) errors.push('PREISSUE source requires preIssueType');\n      break;\n    case 'GOAL':\n      if (!source.goalId) errors.push('GOAL source requires goalId');\n      if (!source.metricKey) errors.push('GOAL source requires metricKey');\n      break;\n    case 'MANUAL':\n      if (typeof source.note !== 'string') errors.push('MANUAL source requires note');\n      break;\n  }\n  \n  return { valid: errors.length === 0, errors };\n}\n\n/**\n * Validate ImpactModel\n * @param {any} impact \n * @returns {{ valid: boolean, errors: string[] }}\n */\nexport function validateImpactModel(impact) {\n  const errors = [];\n  \n  if (!impact || typeof impact !== 'object') {\n    return { valid: false, errors: ['impact must be an object'] };\n  }\n  \n  // Check all required dimensions\n  for (const [dim, bounds] of Object.entries(IMPACT_BOUNDS)) {\n    const val = impact[dim];\n    if (typeof val !== 'number' || isNaN(val)) {\n      errors.push(`impact.${dim} must be a number`);\n    } else if (val < bounds.min || val > bounds.max) {\n      errors.push(`impact.${dim} must be in [${bounds.min}, ${bounds.max}], got ${val}`);\n    }\n  }\n  \n  // Explain array required (PF1: FAIL if empty)\n  if (!Array.isArray(impact.explain) || impact.explain.length === 0) {\n    errors.push('impact.explain must be a non-empty array (PF1: zero explanation fails build)');\n  } else if (impact.explain.length > 6) {\n    errors.push('impact.explain must have at most 6 items');\n  } else if (impact.explain.some(e => typeof e !== 'string')) {\n    errors.push('impact.explain items must be strings');\n  }\n  \n  return { valid: errors.length === 0, errors };\n}\n\n/**\n * Validate complete Action object\n * @param {any} action \n * @returns {{ valid: boolean, errors: string[], missing: string[] }}\n */\nexport function validateAction(action) {\n  const errors = [];\n  const missing = [];\n  \n  if (!action || typeof action !== 'object') {\n    return { valid: false, errors: ['action must be an object'], missing: ['action'] };\n  }\n  \n  // Required fields\n  if (typeof action.actionId !== 'string' || !action.actionId) {\n    missing.push('actionId');\n  }\n  \n  if (typeof action.title !== 'string' || !action.title) {\n    missing.push('title');\n  }\n  \n  // EntityRef\n  const entityResult = validateEntityRef(action.entityRef);\n  if (!entityResult.valid) {\n    missing.push('entityRef');\n    errors.push(...entityResult.errors);\n  }\n  \n  // Sources\n  if (!Array.isArray(action.sources) || action.sources.length === 0) {\n    missing.push('sources');\n    errors.push('sources must be a non-empty array');\n  } else {\n    action.sources.forEach((src, i) => {\n      const srcResult = validateActionSource(src);\n      if (!srcResult.valid) {\n        errors.push(...srcResult.errors.map(e => `sources[${i}]: ${e}`));\n      }\n    });\n  }\n  \n  // Steps\n  if (!Array.isArray(action.steps)) {\n    missing.push('steps');\n    errors.push('steps must be an array');\n  }\n  \n  // Impact model\n  const impactResult = validateImpactModel(action.impact);\n  if (!impactResult.valid) {\n    missing.push('impact');\n    errors.push(...impactResult.errors);\n  }\n  \n  // createdAt\n  if (typeof action.createdAt !== 'string' || !action.createdAt) {\n    missing.push('createdAt');\n  }\n  \n  return { valid: errors.length === 0 && missing.length === 0, errors, missing };\n}\n\n// =============================================================================\n// DETERMINISTIC ACTION ID\n// =============================================================================\n\n/**\n * Generate deterministic actionId from stable inputs\n * @param {Object} params\n * @param {Object} params.entityRef \n * @param {string} [params.resolutionId]\n * @param {Object[]} params.sources\n * @returns {string}\n */\nexport function generateActionId({ entityRef, resolutionId, sources }) {\n  const parts = [\n    entityRef.type,\n    entityRef.id,\n    resolutionId || 'no-resolution',\n    ...sources.map(s => {\n      switch (s.sourceType) {\n        case 'ISSUE': return `issue:${s.issueId}`;\n        case 'PREISSUE': return `preissue:${s.preIssueId}`;\n        case 'GOAL': return `goal:${s.goalId}:${s.metricKey}`;\n        case 'MANUAL': return `manual:${s.note.slice(0, 20)}`;\n        default: return 'unknown';\n      }\n    }).sort()\n  ];\n  \n  const hash = createHash('sha256')\n    .update(parts.join('|'))\n    .digest('hex')\n    .slice(0, 12);\n  \n  return `action-${hash}`;\n}\n\n// =============================================================================\n// EXPECTED NET IMPACT COMPUTATION\n// =============================================================================\n\n/**\n * Time penalty function (explicit, monotonic)\n * Small penalty per week, capped at 30\n * @param {number} days \n * @returns {number}\n */\nexport function timePenalty(days) {\n  return Math.min(30, days / 7);\n}\n\n/**\n * Compute expected net impact (deterministic)\n * \n * Phase 4.0 (PF1) Formula:\n *   combinedProbability = executionProbability * probabilityOfSuccess\n *   (upsideMagnitude * combinedProbability)\n * + secondOrderLeverage\n * - (downsideMagnitude * (1 - combinedProbability))\n * - effortCost\n * - timePenalty(timeToImpactDays)\n * \n * @param {Object} impact - ImpactModel\n * @returns {number}\n */\nexport function computeExpectedNetImpact(impact) {\n  const {\n    upsideMagnitude,\n    probabilityOfSuccess,\n    executionProbability = 1, // Default to 1 for backward compatibility\n    downsideMagnitude,\n    timeToImpactDays,\n    effortCost,\n    secondOrderLeverage\n  } = impact;\n  \n  // PF1: Combined probability = will they do it? * will it work?\n  const combinedProbability = executionProbability * probabilityOfSuccess;\n  \n  const expectedUpside = upsideMagnitude * combinedProbability;\n  const expectedDownside = downsideMagnitude * (1 - combinedProbability);\n  const timePen = timePenalty(timeToImpactDays);\n  \n  return expectedUpside + secondOrderLeverage - expectedDownside - effortCost - timePen;\n}\n\n// =============================================================================\n// ACTION FACTORY\n// =============================================================================\n\n/**\n * Create a valid Action object\n * @param {Object} params\n * @returns {Object}\n */\nexport function createAction({\n  entityRef,\n  title,\n  sources,\n  resolutionId = null,\n  steps = [],\n  impact,\n  createdAt\n}) {\n  const actionId = generateActionId({ entityRef, resolutionId, sources });\n  \n  return {\n    actionId,\n    title,\n    entityRef,\n    sources,\n    resolutionId,\n    steps,\n    impact,\n    createdAt\n  };\n}\n\nexport default {\n  ENTITY_TYPES,\n  SOURCE_TYPES,\n  IMPACT_BOUNDS,\n  validateEntityRef,\n  validateActionSource,\n  validateImpactModel,\n  validateAction,\n  generateActionId,\n  timePenalty,\n  computeExpectedNetImpact,\n  createAction\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;CAYC,GAED;;AAMO,MAAM,eAAe;IAAC;IAAW;IAAQ;IAAU;IAAa;CAAQ;AAExE,MAAM,eAAe;IAAC;IAAS;IAAY;IAAQ;IAAU;CAAe;AAM5E,MAAM,gBAAgB;IAC3B,iBAAiB;QAAE,KAAK;QAAG,KAAK;IAAI;IACpC,sBAAsB;QAAE,KAAK;QAAG,KAAK;IAAE;IACvC,sBAAsB;QAAE,KAAK;QAAG,KAAK;IAAE;IACvC,mBAAmB;QAAE,KAAK;QAAG,KAAK;IAAI;IACtC,kBAAkB;QAAE,KAAK;QAAG,KAAK;IAAS;IAC1C,YAAY;QAAE,KAAK;QAAG,KAAK;IAAI;IAC/B,qBAAqB;QAAE,KAAK;QAAG,KAAK;IAAI;AAC1C;AAWO,SAAS,kBAAkB,GAAG;IACnC,MAAM,SAAS,EAAE;IAEjB,IAAI,CAAC,OAAO,OAAO,QAAQ,UAAU;QACnC,OAAO;YAAE,OAAO;YAAO,QAAQ;gBAAC;aAA8B;QAAC;IACjE;IAEA,IAAI,CAAC,aAAa,QAAQ,CAAC,IAAI,IAAI,GAAG;QACpC,OAAO,IAAI,CAAC,CAAC,+BAA+B,EAAE,aAAa,IAAI,CAAC,OAAO;IACzE;IAEA,IAAI,OAAO,IAAI,EAAE,KAAK,YAAY,CAAC,IAAI,EAAE,EAAE;QACzC,OAAO,IAAI,CAAC;IACd;IAEA,OAAO;QAAE,OAAO,OAAO,MAAM,KAAK;QAAG;IAAO;AAC9C;AAOO,SAAS,qBAAqB,MAAM;IACzC,MAAM,SAAS,EAAE;IAEjB,IAAI,CAAC,UAAU,OAAO,WAAW,UAAU;QACzC,OAAO;YAAE,OAAO;YAAO,QAAQ;gBAAC;aAA2B;QAAC;IAC9D;IAEA,IAAI,CAAC,aAAa,QAAQ,CAAC,OAAO,UAAU,GAAG;QAC7C,OAAO,IAAI,CAAC,CAAC,2BAA2B,EAAE,aAAa,IAAI,CAAC,OAAO;IACrE;IAEA,OAAQ,OAAO,UAAU;QACvB,KAAK;YACH,IAAI,CAAC,OAAO,OAAO,EAAE,OAAO,IAAI,CAAC;YACjC,IAAI,CAAC,OAAO,SAAS,EAAE,OAAO,IAAI,CAAC;YACnC;QACF,KAAK;YACH,IAAI,CAAC,OAAO,UAAU,EAAE,OAAO,IAAI,CAAC;YACpC,IAAI,CAAC,OAAO,YAAY,EAAE,OAAO,IAAI,CAAC;YACtC;QACF,KAAK;YACH,IAAI,CAAC,OAAO,MAAM,EAAE,OAAO,IAAI,CAAC;YAChC,IAAI,CAAC,OAAO,SAAS,EAAE,OAAO,IAAI,CAAC;YACnC;QACF,KAAK;YACH,IAAI,OAAO,OAAO,IAAI,KAAK,UAAU,OAAO,IAAI,CAAC;YACjD;IACJ;IAEA,OAAO;QAAE,OAAO,OAAO,MAAM,KAAK;QAAG;IAAO;AAC9C;AAOO,SAAS,oBAAoB,MAAM;IACxC,MAAM,SAAS,EAAE;IAEjB,IAAI,CAAC,UAAU,OAAO,WAAW,UAAU;QACzC,OAAO;YAAE,OAAO;YAAO,QAAQ;gBAAC;aAA2B;QAAC;IAC9D;IAEA,gCAAgC;IAChC,KAAK,MAAM,CAAC,KAAK,OAAO,IAAI,OAAO,OAAO,CAAC,eAAgB;QACzD,MAAM,MAAM,MAAM,CAAC,IAAI;QACvB,IAAI,OAAO,QAAQ,YAAY,MAAM,MAAM;YACzC,OAAO,IAAI,CAAC,CAAC,OAAO,EAAE,IAAI,iBAAiB,CAAC;QAC9C,OAAO,IAAI,MAAM,OAAO,GAAG,IAAI,MAAM,OAAO,GAAG,EAAE;YAC/C,OAAO,IAAI,CAAC,CAAC,OAAO,EAAE,IAAI,aAAa,EAAE,OAAO,GAAG,CAAC,EAAE,EAAE,OAAO,GAAG,CAAC,OAAO,EAAE,KAAK;QACnF;IACF;IAEA,8CAA8C;IAC9C,IAAI,CAAC,MAAM,OAAO,CAAC,OAAO,OAAO,KAAK,OAAO,OAAO,CAAC,MAAM,KAAK,GAAG;QACjE,OAAO,IAAI,CAAC;IACd,OAAO,IAAI,OAAO,OAAO,CAAC,MAAM,GAAG,GAAG;QACpC,OAAO,IAAI,CAAC;IACd,OAAO,IAAI,OAAO,OAAO,CAAC,IAAI,CAAC,CAAA,IAAK,OAAO,MAAM,WAAW;QAC1D,OAAO,IAAI,CAAC;IACd;IAEA,OAAO;QAAE,OAAO,OAAO,MAAM,KAAK;QAAG;IAAO;AAC9C;AAOO,SAAS,eAAe,MAAM;IACnC,MAAM,SAAS,EAAE;IACjB,MAAM,UAAU,EAAE;IAElB,IAAI,CAAC,UAAU,OAAO,WAAW,UAAU;QACzC,OAAO;YAAE,OAAO;YAAO,QAAQ;gBAAC;aAA2B;YAAE,SAAS;gBAAC;aAAS;QAAC;IACnF;IAEA,kBAAkB;IAClB,IAAI,OAAO,OAAO,QAAQ,KAAK,YAAY,CAAC,OAAO,QAAQ,EAAE;QAC3D,QAAQ,IAAI,CAAC;IACf;IAEA,IAAI,OAAO,OAAO,KAAK,KAAK,YAAY,CAAC,OAAO,KAAK,EAAE;QACrD,QAAQ,IAAI,CAAC;IACf;IAEA,YAAY;IACZ,MAAM,eAAe,kBAAkB,OAAO,SAAS;IACvD,IAAI,CAAC,aAAa,KAAK,EAAE;QACvB,QAAQ,IAAI,CAAC;QACb,OAAO,IAAI,IAAI,aAAa,MAAM;IACpC;IAEA,UAAU;IACV,IAAI,CAAC,MAAM,OAAO,CAAC,OAAO,OAAO,KAAK,OAAO,OAAO,CAAC,MAAM,KAAK,GAAG;QACjE,QAAQ,IAAI,CAAC;QACb,OAAO,IAAI,CAAC;IACd,OAAO;QACL,OAAO,OAAO,CAAC,OAAO,CAAC,CAAC,KAAK;YAC3B,MAAM,YAAY,qBAAqB;YACvC,IAAI,CAAC,UAAU,KAAK,EAAE;gBACpB,OAAO,IAAI,IAAI,UAAU,MAAM,CAAC,GAAG,CAAC,CAAA,IAAK,CAAC,QAAQ,EAAE,EAAE,GAAG,EAAE,GAAG;YAChE;QACF;IACF;IAEA,QAAQ;IACR,IAAI,CAAC,MAAM,OAAO,CAAC,OAAO,KAAK,GAAG;QAChC,QAAQ,IAAI,CAAC;QACb,OAAO,IAAI,CAAC;IACd;IAEA,eAAe;IACf,MAAM,eAAe,oBAAoB,OAAO,MAAM;IACtD,IAAI,CAAC,aAAa,KAAK,EAAE;QACvB,QAAQ,IAAI,CAAC;QACb,OAAO,IAAI,IAAI,aAAa,MAAM;IACpC;IAEA,YAAY;IACZ,IAAI,OAAO,OAAO,SAAS,KAAK,YAAY,CAAC,OAAO,SAAS,EAAE;QAC7D,QAAQ,IAAI,CAAC;IACf;IAEA,OAAO;QAAE,OAAO,OAAO,MAAM,KAAK,KAAK,QAAQ,MAAM,KAAK;QAAG;QAAQ;IAAQ;AAC/E;AAcO,SAAS,iBAAiB,EAAE,SAAS,EAAE,YAAY,EAAE,OAAO,EAAE;IACnE,MAAM,QAAQ;QACZ,UAAU,IAAI;QACd,UAAU,EAAE;QACZ,gBAAgB;WACb,QAAQ,GAAG,CAAC,CAAA;YACb,OAAQ,EAAE,UAAU;gBAClB,KAAK;oBAAS,OAAO,CAAC,MAAM,EAAE,EAAE,OAAO,EAAE;gBACzC,KAAK;oBAAY,OAAO,CAAC,SAAS,EAAE,EAAE,UAAU,EAAE;gBAClD,KAAK;oBAAQ,OAAO,CAAC,KAAK,EAAE,EAAE,MAAM,CAAC,CAAC,EAAE,EAAE,SAAS,EAAE;gBACrD,KAAK;oBAAU,OAAO,CAAC,OAAO,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,KAAK;gBACrD;oBAAS,OAAO;YAClB;QACF,GAAG,IAAI;KACR;IAED,MAAM,OAAO,IAAA,mHAAU,EAAC,UACrB,MAAM,CAAC,MAAM,IAAI,CAAC,MAClB,MAAM,CAAC,OACP,KAAK,CAAC,GAAG;IAEZ,OAAO,CAAC,OAAO,EAAE,MAAM;AACzB;AAYO,SAAS,YAAY,IAAI;IAC9B,OAAO,KAAK,GAAG,CAAC,IAAI,OAAO;AAC7B;AAgBO,SAAS,yBAAyB,MAAM;IAC7C,MAAM,EACJ,eAAe,EACf,oBAAoB,EACpB,uBAAuB,CAAC,EACxB,iBAAiB,EACjB,gBAAgB,EAChB,UAAU,EACV,mBAAmB,EACpB,GAAG;IAEJ,+DAA+D;IAC/D,MAAM,sBAAsB,uBAAuB;IAEnD,MAAM,iBAAiB,kBAAkB;IACzC,MAAM,mBAAmB,oBAAoB,CAAC,IAAI,mBAAmB;IACrE,MAAM,UAAU,YAAY;IAE5B,OAAO,iBAAiB,sBAAsB,mBAAmB,aAAa;AAChF;AAWO,SAAS,aAAa,EAC3B,SAAS,EACT,KAAK,EACL,OAAO,EACP,eAAe,IAAI,EACnB,QAAQ,EAAE,EACV,MAAM,EACN,SAAS,EACV;IACC,MAAM,WAAW,iBAAiB;QAAE;QAAW;QAAc;IAAQ;IAErE,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF;uCAEe;IACb;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;AACF"}},
    {"offset": {"line": 2945, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/predict/actionCandidates.js"],"sourcesContent":["/**\n * actionCandidates.js ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â Action Generation (Phase 3.2)\n * \n * Generates candidate actions from:\n * - Issues (reactive)\n * - Pre-Issues (preventative)\n * - Goals (offensive/value-creating)\n * \n * Actions are the primary decisioning object.\n * Derived output - never persisted.\n * \n * @module actionCandidates\n */\n\nimport { getResolution, getResolutionById, RESOLUTIONS } from './resolutions.js';\nimport { createAction } from './actionSchema.js';\n\n// =============================================================================\n// PREVENTATIVE RESOLUTION TEMPLATES (for pre-issues)\n// =============================================================================\n\nexport const PREVENTATIVE_RESOLUTIONS = {\n  REDUCE_BURN: {\n    resolutionId: 'REDUCE_BURN',\n    title: 'Reduce burn rate',\n    defaultEffort: 7,\n    defaultImpact: 0.7,\n    actionSteps: [\n      'Review all expense categories',\n      'Identify non-essential costs',\n      'Negotiate with vendors',\n      'Implement cost reductions'\n    ]\n  },\n  ACCELERATE_FUNDRAISE: {\n    resolutionId: 'ACCELERATE_FUNDRAISE',\n    title: 'Accelerate fundraising',\n    defaultEffort: 14,\n    defaultImpact: 0.8,\n    actionSteps: [\n      'Expand investor pipeline',\n      'Increase outreach velocity',\n      'Fast-track promising leads',\n      'Consider bridge financing'\n    ]\n  },\n  BRIDGE_ROUND: {\n    resolutionId: 'BRIDGE_ROUND',\n    title: 'Secure bridge round',\n    defaultEffort: 21,\n    defaultImpact: 0.9,\n    actionSteps: [\n      'Reach out to existing investors',\n      'Prepare bridge terms',\n      'Negotiate and close quickly',\n      'Update cap table'\n    ]\n  },\n  ACCELERATE_GOAL: {\n    resolutionId: 'ACCELERATE_GOAL',\n    title: 'Accelerate goal progress',\n    defaultEffort: 7,\n    defaultImpact: 0.6,\n    actionSteps: [\n      'Identify acceleration levers',\n      'Reallocate resources',\n      'Remove blockers',\n      'Track daily progress'\n    ]\n  },\n  REVISE_TARGET: {\n    resolutionId: 'REVISE_TARGET',\n    title: 'Revise goal target',\n    defaultEffort: 1,\n    defaultImpact: 0.4,\n    actionSteps: [\n      'Assess realistic attainment',\n      'Propose revised target',\n      'Document rationale',\n      'Update goal in system'\n    ]\n  },\n  ADD_RESOURCES: {\n    resolutionId: 'ADD_RESOURCES',\n    title: 'Add resources to goal',\n    defaultEffort: 14,\n    defaultImpact: 0.7,\n    actionSteps: [\n      'Identify resource gaps',\n      'Hire or reassign team members',\n      'Provide necessary tools/budget',\n      'Monitor progress lift'\n    ]\n  },\n  FOLLOW_UP_INVESTOR: {\n    resolutionId: 'FOLLOW_UP_INVESTOR',\n    title: 'Follow up with investor',\n    defaultEffort: 0.5,\n    defaultImpact: 0.5,\n    actionSteps: [\n      'Send check-in email',\n      'Provide recent updates',\n      'Ask about timeline',\n      'Confirm next steps'\n    ]\n  },\n  SCHEDULE_CHECK_IN: {\n    resolutionId: 'SCHEDULE_CHECK_IN',\n    title: 'Schedule investor check-in',\n    defaultEffort: 0.25,\n    defaultImpact: 0.4,\n    actionSteps: [\n      'Propose call time',\n      'Prepare talking points',\n      'Conduct call',\n      'Document outcomes'\n    ]\n  },\n  PREPARE_ALTERNATIVES: {\n    resolutionId: 'PREPARE_ALTERNATIVES',\n    title: 'Prepare alternative investors',\n    defaultEffort: 3,\n    defaultImpact: 0.6,\n    actionSteps: [\n      'Identify backup investors',\n      'Warm them up',\n      'Prepare to pivot if needed'\n    ]\n  }\n};\n\n// =============================================================================\n// GOAL ACTION TEMPLATES\n// =============================================================================\n\nexport const GOAL_RESOLUTIONS = {\n  REVENUE_PUSH: {\n    resolutionId: 'REVENUE_PUSH',\n    title: 'Push revenue acceleration',\n    defaultEffort: 14,\n    defaultImpact: 0.7,\n    actionSteps: [\n      'Review sales pipeline',\n      'Identify quick wins',\n      'Accelerate deal closing',\n      'Increase outreach'\n    ]\n  },\n  PRODUCT_SPRINT: {\n    resolutionId: 'PRODUCT_SPRINT',\n    title: 'Sprint to product milestone',\n    defaultEffort: 14,\n    defaultImpact: 0.6,\n    actionSteps: [\n      'Define sprint scope',\n      'Allocate engineering',\n      'Clear blockers daily',\n      'Track to milestone'\n    ]\n  },\n  HIRING_PUSH: {\n    resolutionId: 'HIRING_PUSH',\n    title: 'Accelerate hiring',\n    defaultEffort: 21,\n    defaultImpact: 0.5,\n    actionSteps: [\n      'Expand sourcing channels',\n      'Speed up interview process',\n      'Make competitive offers',\n      'Onboard quickly'\n    ]\n  },\n  PARTNERSHIP_OUTREACH: {\n    resolutionId: 'PARTNERSHIP_OUTREACH',\n    title: 'Expand partnership outreach',\n    defaultEffort: 14,\n    defaultImpact: 0.6,\n    actionSteps: [\n      'Identify target partners',\n      'Prepare partnership materials',\n      'Initiate conversations',\n      'Drive to commitment'\n    ]\n  },\n  FUNDRAISE_CLOSE: {\n    resolutionId: 'FUNDRAISE_CLOSE',\n    title: 'Drive to fundraise close',\n    defaultEffort: 30,\n    defaultImpact: 0.9,\n    actionSteps: [\n      'Finalize lead investor',\n      'Complete due diligence',\n      'Negotiate terms',\n      'Execute closing'\n    ]\n  }\n};\n\n// =============================================================================\n// ACTION GENERATION FROM ISSUES\n// =============================================================================\n\n/**\n * Generate action from an issue\n * @param {Object} issue \n * @param {string} companyId \n * @param {string} companyName \n * @param {string} createdAt \n * @returns {Object|null} Action candidate (without impact model)\n */\nfunction generateActionFromIssue(issue, companyId, companyName, createdAt) {\n  const resolution = getResolution(issue.issueType);\n  if (!resolution) return null;\n  \n  return createAction({\n    entityRef: { type: 'company', id: companyId },\n    title: `${companyName}: ${resolution.title}`,\n    sources: [{\n      sourceType: 'ISSUE',\n      issueId: issue.issueId,\n      issueType: issue.issueType\n    }],\n    resolutionId: resolution.resolutionId,\n    steps: resolution.actionSteps,\n    impact: null, // Will be attached by actionImpact.js\n    createdAt\n  });\n}\n\n// =============================================================================\n// ACTION GENERATION FROM PRE-ISSUES\n// =============================================================================\n\n/**\n * Generate actions from a pre-issue\n * @param {Object} preissue \n * @param {string} createdAt \n * @returns {Object[]} Action candidates\n */\nfunction generateActionsFromPreIssue(preissue, createdAt) {\n  const actions = [];\n  \n  for (const resolutionKey of preissue.preventativeActions || []) {\n    const resolution = PREVENTATIVE_RESOLUTIONS[resolutionKey];\n    if (!resolution) continue;\n    \n    actions.push(createAction({\n      entityRef: preissue.entityRef,\n      title: `${preissue.companyName}: ${resolution.title} (preventative)`,\n      sources: [{\n        sourceType: 'PREISSUE',\n        preIssueId: preissue.preIssueId,\n        preIssueType: preissue.preIssueType\n      }],\n      resolutionId: resolution.resolutionId,\n      steps: resolution.actionSteps,\n      impact: null,\n      createdAt\n    }));\n  }\n  \n  return actions;\n}\n\n// =============================================================================\n// ACTION GENERATION FROM GOALS\n// =============================================================================\n\n/**\n * Map goal type to resolution\n * @param {string} goalType \n * @returns {Object|null}\n */\nfunction getGoalResolution(goalType) {\n  const mapping = {\n    revenue: GOAL_RESOLUTIONS.REVENUE_PUSH,\n    product: GOAL_RESOLUTIONS.PRODUCT_SPRINT,\n    hiring: GOAL_RESOLUTIONS.HIRING_PUSH,\n    partnership: GOAL_RESOLUTIONS.PARTNERSHIP_OUTREACH,\n    fundraise: GOAL_RESOLUTIONS.FUNDRAISE_CLOSE\n  };\n  return mapping[goalType] || GOAL_RESOLUTIONS.REVENUE_PUSH;\n}\n\n/**\n * Generate action from goal trajectory\n * Only generates if goal is achievable but needs push\n * @param {Object} trajectory - GoalTrajectory\n * @param {string} createdAt \n * @returns {Object|null} Action candidate\n */\nfunction generateActionFromGoal(trajectory, createdAt) {\n  // Don't generate action if already on track or already achieved\n  if (trajectory.onTrack === true && trajectory.probabilityOfHit > 0.8) return null;\n  \n  // Don't generate if goal is missed (would be an issue)\n  if (trajectory.daysLeft !== null && trajectory.daysLeft < 0) return null;\n  \n  const resolution = getGoalResolution(trajectory.goalType);\n  \n  return createAction({\n    entityRef: { type: 'company', id: trajectory.companyId },\n    title: `${trajectory.companyName}: ${resolution.title} for ${trajectory.goalName}`,\n    sources: [{\n      sourceType: 'GOAL',\n      goalId: trajectory.goalId,\n      metricKey: trajectory.metricKey\n    }],\n    resolutionId: resolution.resolutionId,\n    steps: resolution.actionSteps,\n    impact: null,\n    createdAt\n  });\n}\n\n// =============================================================================\n// MAIN GENERATION\n// =============================================================================\n\n/**\n * Generate all action candidates for a company\n * @param {Object} params\n * @param {Object[]} params.issues - From issues.js\n * @param {Object[]} params.preissues - From preissues.js\n * @param {Object[]} params.goalTrajectories - From goalTrajectory.js\n * @param {string} params.companyId\n * @param {string} params.companyName\n * @param {string} params.createdAt\n * @returns {Object[]} Action candidates\n */\nexport function generateCompanyActionCandidates({\n  issues,\n  preissues,\n  goalTrajectories,\n  companyId,\n  companyName,\n  createdAt\n}) {\n  const candidates = [];\n  \n  // From issues\n  for (const issue of issues) {\n    const action = generateActionFromIssue(issue, companyId, companyName, createdAt);\n    if (action) candidates.push(action);\n  }\n  \n  // From pre-issues\n  for (const preissue of preissues) {\n    const actions = generateActionsFromPreIssue(preissue, createdAt);\n    candidates.push(...actions);\n  }\n  \n  // From goals\n  for (const trajectory of goalTrajectories) {\n    const action = generateActionFromGoal(trajectory, createdAt);\n    if (action) candidates.push(action);\n  }\n  \n  return candidates;\n}\n\n/**\n * Generate all action candidates for portfolio\n * @param {Object} params\n * @param {Object[]} params.companies\n * @param {Object} params.issuesByCompany\n * @param {Object} params.preissuesByCompany\n * @param {Object} params.goalTrajectoriesByCompany\n * @param {string} params.createdAt\n * @returns {{ byCompany: Object, all: Object[] }}\n */\nexport function generatePortfolioActionCandidates({\n  companies,\n  issuesByCompany,\n  preissuesByCompany,\n  goalTrajectoriesByCompany,\n  createdAt\n}) {\n  const byCompany = {};\n  const all = [];\n  \n  for (const company of companies) {\n    const candidates = generateCompanyActionCandidates({\n      issues: issuesByCompany[company.id] || [],\n      preissues: preissuesByCompany[company.id] || [],\n      goalTrajectories: goalTrajectoriesByCompany[company.id] || [],\n      companyId: company.id,\n      companyName: company.name,\n      createdAt\n    });\n    byCompany[company.id] = candidates;\n    all.push(...candidates);\n  }\n  \n  return { byCompany, all };\n}\n\n/**\n * Get resolution by ID (includes preventative and goal resolutions)\n * @param {string} resolutionId \n * @returns {Object|null}\n */\nexport function getAnyResolution(resolutionId) {\n  return RESOLUTIONS[resolutionId] || \n         PREVENTATIVE_RESOLUTIONS[resolutionId] || \n         GOAL_RESOLUTIONS[resolutionId] || \n         null;\n}\n\nexport default {\n  PREVENTATIVE_RESOLUTIONS,\n  GOAL_RESOLUTIONS,\n  generateCompanyActionCandidates,\n  generatePortfolioActionCandidates,\n  getAnyResolution\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;;;;;;;;;;;CAYC,GAED;AACA;;;AAMO,MAAM,2BAA2B;IACtC,aAAa;QACX,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;IACA,sBAAsB;QACpB,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;IACA,cAAc;QACZ,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;IACA,iBAAiB;QACf,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;IACA,eAAe;QACb,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;IACA,eAAe;QACb,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;IACA,oBAAoB;QAClB,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;IACA,mBAAmB;QACjB,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;IACA,sBAAsB;QACpB,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;SACD;IACH;AACF;AAMO,MAAM,mBAAmB;IAC9B,cAAc;QACZ,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;IACA,gBAAgB;QACd,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;IACA,aAAa;QACX,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;IACA,sBAAsB;QACpB,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;IACA,iBAAiB;QACf,cAAc;QACd,OAAO;QACP,eAAe;QACf,eAAe;QACf,aAAa;YACX;YACA;YACA;YACA;SACD;IACH;AACF;AAEA,gFAAgF;AAChF,gCAAgC;AAChC,gFAAgF;AAEhF;;;;;;;CAOC,GACD,SAAS,wBAAwB,KAAK,EAAE,SAAS,EAAE,WAAW,EAAE,SAAS;IACvE,MAAM,aAAa,IAAA,wJAAa,EAAC,MAAM,SAAS;IAChD,IAAI,CAAC,YAAY,OAAO;IAExB,OAAO,IAAA,wJAAY,EAAC;QAClB,WAAW;YAAE,MAAM;YAAW,IAAI;QAAU;QAC5C,OAAO,GAAG,YAAY,EAAE,EAAE,WAAW,KAAK,EAAE;QAC5C,SAAS;YAAC;gBACR,YAAY;gBACZ,SAAS,MAAM,OAAO;gBACtB,WAAW,MAAM,SAAS;YAC5B;SAAE;QACF,cAAc,WAAW,YAAY;QACrC,OAAO,WAAW,WAAW;QAC7B,QAAQ;QACR;IACF;AACF;AAEA,gFAAgF;AAChF,oCAAoC;AACpC,gFAAgF;AAEhF;;;;;CAKC,GACD,SAAS,4BAA4B,QAAQ,EAAE,SAAS;IACtD,MAAM,UAAU,EAAE;IAElB,KAAK,MAAM,iBAAiB,SAAS,mBAAmB,IAAI,EAAE,CAAE;QAC9D,MAAM,aAAa,wBAAwB,CAAC,cAAc;QAC1D,IAAI,CAAC,YAAY;QAEjB,QAAQ,IAAI,CAAC,IAAA,wJAAY,EAAC;YACxB,WAAW,SAAS,SAAS;YAC7B,OAAO,GAAG,SAAS,WAAW,CAAC,EAAE,EAAE,WAAW,KAAK,CAAC,eAAe,CAAC;YACpE,SAAS;gBAAC;oBACR,YAAY;oBACZ,YAAY,SAAS,UAAU;oBAC/B,cAAc,SAAS,YAAY;gBACrC;aAAE;YACF,cAAc,WAAW,YAAY;YACrC,OAAO,WAAW,WAAW;YAC7B,QAAQ;YACR;QACF;IACF;IAEA,OAAO;AACT;AAEA,gFAAgF;AAChF,+BAA+B;AAC/B,gFAAgF;AAEhF;;;;CAIC,GACD,SAAS,kBAAkB,QAAQ;IACjC,MAAM,UAAU;QACd,SAAS,iBAAiB,YAAY;QACtC,SAAS,iBAAiB,cAAc;QACxC,QAAQ,iBAAiB,WAAW;QACpC,aAAa,iBAAiB,oBAAoB;QAClD,WAAW,iBAAiB,eAAe;IAC7C;IACA,OAAO,OAAO,CAAC,SAAS,IAAI,iBAAiB,YAAY;AAC3D;AAEA;;;;;;CAMC,GACD,SAAS,uBAAuB,UAAU,EAAE,SAAS;IACnD,gEAAgE;IAChE,IAAI,WAAW,OAAO,KAAK,QAAQ,WAAW,gBAAgB,GAAG,KAAK,OAAO;IAE7E,uDAAuD;IACvD,IAAI,WAAW,QAAQ,KAAK,QAAQ,WAAW,QAAQ,GAAG,GAAG,OAAO;IAEpE,MAAM,aAAa,kBAAkB,WAAW,QAAQ;IAExD,OAAO,IAAA,wJAAY,EAAC;QAClB,WAAW;YAAE,MAAM;YAAW,IAAI,WAAW,SAAS;QAAC;QACvD,OAAO,GAAG,WAAW,WAAW,CAAC,EAAE,EAAE,WAAW,KAAK,CAAC,KAAK,EAAE,WAAW,QAAQ,EAAE;QAClF,SAAS;YAAC;gBACR,YAAY;gBACZ,QAAQ,WAAW,MAAM;gBACzB,WAAW,WAAW,SAAS;YACjC;SAAE;QACF,cAAc,WAAW,YAAY;QACrC,OAAO,WAAW,WAAW;QAC7B,QAAQ;QACR;IACF;AACF;AAiBO,SAAS,gCAAgC,EAC9C,MAAM,EACN,SAAS,EACT,gBAAgB,EAChB,SAAS,EACT,WAAW,EACX,SAAS,EACV;IACC,MAAM,aAAa,EAAE;IAErB,cAAc;IACd,KAAK,MAAM,SAAS,OAAQ;QAC1B,MAAM,SAAS,wBAAwB,OAAO,WAAW,aAAa;QACtE,IAAI,QAAQ,WAAW,IAAI,CAAC;IAC9B;IAEA,kBAAkB;IAClB,KAAK,MAAM,YAAY,UAAW;QAChC,MAAM,UAAU,4BAA4B,UAAU;QACtD,WAAW,IAAI,IAAI;IACrB;IAEA,aAAa;IACb,KAAK,MAAM,cAAc,iBAAkB;QACzC,MAAM,SAAS,uBAAuB,YAAY;QAClD,IAAI,QAAQ,WAAW,IAAI,CAAC;IAC9B;IAEA,OAAO;AACT;AAYO,SAAS,kCAAkC,EAChD,SAAS,EACT,eAAe,EACf,kBAAkB,EAClB,yBAAyB,EACzB,SAAS,EACV;IACC,MAAM,YAAY,CAAC;IACnB,MAAM,MAAM,EAAE;IAEd,KAAK,MAAM,WAAW,UAAW;QAC/B,MAAM,aAAa,gCAAgC;YACjD,QAAQ,eAAe,CAAC,QAAQ,EAAE,CAAC,IAAI,EAAE;YACzC,WAAW,kBAAkB,CAAC,QAAQ,EAAE,CAAC,IAAI,EAAE;YAC/C,kBAAkB,yBAAyB,CAAC,QAAQ,EAAE,CAAC,IAAI,EAAE;YAC7D,WAAW,QAAQ,EAAE;YACrB,aAAa,QAAQ,IAAI;YACzB;QACF;QACA,SAAS,CAAC,QAAQ,EAAE,CAAC,GAAG;QACxB,IAAI,IAAI,IAAI;IACd;IAEA,OAAO;QAAE;QAAW;IAAI;AAC1B;AAOO,SAAS,iBAAiB,YAAY;IAC3C,OAAO,sJAAW,CAAC,aAAa,IACzB,wBAAwB,CAAC,aAAa,IACtC,gBAAgB,CAAC,aAAa,IAC9B;AACT;uCAEe;IACb;IACA;IACA;IACA;IACA;AACF"}},
    {"offset": {"line": 3310, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/predict/actionImpact.js"],"sourcesContent":["/**\n * actionImpact.js - Impact Model Attachment (Phase 4.0)\n * \n * Attaches explainable impact model to each action.\n * \n * Impact dimensions (canonical):\n * - upsideMagnitude (0-100)\n * - probabilityOfSuccess (0-1) - Will it work if executed?\n * - executionProbability (0-1) - Will founder actually do it? (PF1)\n * - downsideMagnitude (0-100)\n * - timeToImpactDays (>=0)\n * - effortCost (0-100)\n * - secondOrderLeverage (0-100)\n * \n * PF4: INTRODUCTION actions use timing to adjust impact model\n * \n * @module actionImpact\n */\n\nimport { getAnyResolution } from './actionCandidates.js';\nimport { calculateIssueRipple } from './ripple.js';\n\n// PF4: Timing multipliers (conservative by design)\nconst TIMING_UPSIDE_MULTIPLIER = {\n  'NOW': 1.2,   // Boost upside for NOW\n  'SOON': 1.0,  // Neutral\n  'LATER': 0.7, // Penalize - we're uncertain\n  'NEVER': 0.0  // Should not reach here\n};\n\nconst TIMING_EXEC_PROBABILITY_ADJUST = {\n  'NOW': 0.1,   // Urgent = more likely to act\n  'SOON': 0.0,  // Neutral\n  'LATER': -0.15, // Lower urgency = less likely\n  'NEVER': -1.0\n};\n\n// =============================================================================\n// IMPACT DERIVATION RULES\n// =============================================================================\n\n/**\n * Derive upside magnitude from action source\n */\nfunction deriveUpsideMagnitude(action, context) {\n  const source = action.sources[0];\n  const resolution = getAnyResolution(action.resolutionId);\n  const baseImpact = resolution?.defaultImpact || 0.5;\n  \n  let value = baseImpact * 50;\n  let explain = '';\n  \n  switch (source.sourceType) {\n    case 'ISSUE': {\n      const issue = context.issues?.find(i => i.issueId === source.issueId);\n      if (issue?.severity === 'critical') {\n        value = Math.min(100, baseImpact * 80);\n        explain = `Critical issue resolution (${issue.issueType})`;\n      } else if (issue?.severity === 'high') {\n        value = Math.min(100, baseImpact * 65);\n        explain = `High-severity issue resolution`;\n      } else {\n        explain = `Issue resolution (${source.issueType})`;\n      }\n      break;\n    }\n    \n    case 'PREISSUE': {\n      const preissue = context.preissues?.find(p => p.preIssueId === source.preIssueId);\n      if (preissue) {\n        // PF2: Base value adjusted by likelihood\n        value = preissue.severity === 'high' ? 70 : 50;\n        value *= preissue.likelihood;\n        \n        // PF2: Cost-of-delay multiplier increases upside for imminent escalations\n        const costMultiplier = preissue.costOfDelay?.costMultiplier || 1;\n        if (costMultiplier > 1.5) {\n          value = Math.min(100, value * Math.min(1.5, costMultiplier / 2));\n        }\n        \n        const imminentTag = preissue.escalation?.isImminent ? ' [IMMINENT]' : '';\n        explain = `Prevention of ${preissue.preIssueType}${imminentTag} (${(preissue.likelihood * 100).toFixed(0)}% likely, cost: ${costMultiplier.toFixed(1)}x)`;\n      } else {\n        value = 40;\n        explain = 'Preventative action';\n      }\n      break;\n    }\n    \n    case 'GOAL': {\n      const traj = context.goalTrajectories?.find(t => t.goalId === source.goalId);\n      if (traj) {\n        const achievability = traj.probabilityOfHit;\n        const gap = 1 - achievability;\n        value = 50 + (gap * 40);\n        explain = `Goal advancement: ${traj.goalName} (${(achievability * 100).toFixed(0)}% current prob)`;\n      } else {\n        value = 50;\n        explain = 'Goal advancement';\n      }\n      break;\n    }\n    \n    case 'INTRODUCTION': {\n      // PF4: Intro actions use timing-adjusted upside\n      const timing = action.timing || 'LATER';\n      const multiplier = TIMING_UPSIDE_MULTIPLIER[timing] || 0.7;\n      const optionality = action.optionalityGain || 30;\n      const relevance = action.relevanceScore || 50;\n      \n      // Base upside from optionality and relevance\n      value = ((optionality * 0.6) + (relevance * 0.4)) * multiplier;\n      \n      // Timing affects explanation\n      if (timing === 'NOW') {\n        explain = `High-value intro (timing: NOW)`;\n      } else if (timing === 'SOON') {\n        explain = `Network opportunity (timing: SOON)`;\n      } else {\n        explain = `Potential intro (timing: ${timing} - wait for better signal)`;\n      }\n      break;\n    }\n    \n    default:\n      value = 30;\n      explain = 'Manual action';\n  }\n  \n  return { value: Math.round(value), explain };\n}\n\n/**\n * Derive probability of success (will action work IF executed?)\n */\nfunction deriveProbabilityOfSuccess(action, context) {\n  const resolution = getAnyResolution(action.resolutionId);\n  const source = action.sources[0];\n  \n  const effort = resolution?.defaultEffort || 7;\n  let baseProb = effort <= 1 ? 0.9 : effort <= 7 ? 0.7 : effort <= 14 ? 0.5 : 0.4;\n  let explain = '';\n  \n  switch (source.sourceType) {\n    case 'ISSUE': {\n      const issue = context.issues?.find(i => i.issueId === source.issueId);\n      if (issue?.issueType?.startsWith('DATA_')) {\n        baseProb = Math.min(1, baseProb + 0.2);\n        explain = 'Data fix - high success probability';\n      } else if (issue?.issueType?.includes('CRITICAL')) {\n        baseProb = Math.max(0.3, baseProb - 0.1);\n        explain = 'Critical issue - complex resolution';\n      } else {\n        explain = `Standard resolution (${effort}d effort)`;\n      }\n      break;\n    }\n    \n    case 'PREISSUE': {\n      const preissue = context.preissues?.find(p => p.preIssueId === source.preIssueId);\n      if (preissue && preissue.timeToBreachDays > 30) {\n        baseProb = Math.min(1, baseProb + 0.15);\n        explain = 'Early intervention - good odds';\n      } else {\n        explain = 'Preventative action';\n      }\n      break;\n    }\n    \n    case 'GOAL': {\n      const traj = context.goalTrajectories?.find(t => t.goalId === source.goalId);\n      if (traj) {\n        baseProb = 0.5 + (traj.confidence * 0.3);\n        explain = `Goal confidence: ${(traj.confidence * 100).toFixed(0)}%`;\n      } else {\n        explain = 'Goal action';\n      }\n      break;\n    }\n    \n    case 'INTRODUCTION': {\n      // PF4: Use intro's computed probability\n      baseProb = action.probability || 0.4;\n      const confidence = action.timingConfidence || 0.5;\n      explain = `Intro success: ${(baseProb * 100).toFixed(0)}% (confidence: ${(confidence * 100).toFixed(0)}%)`;\n      break;\n    }\n    \n    default:\n      explain = 'Standard probability';\n  }\n  \n  return { value: Math.round(baseProb * 100) / 100, explain };\n}\n\n/**\n * Derive execution probability (will founder actually do it?) - PF1\n */\nfunction deriveExecutionProbability(action, context) {\n  const company = context.company;\n  const resolution = getAnyResolution(action.resolutionId);\n  const source = action.sources[0];\n  \n  let baseExec = 0.7;\n  let explain = '';\n  const factors = [];\n  \n  // Factor 1: Goal velocity\n  const trajectories = context.goalTrajectories || [];\n  if (trajectories.length > 0) {\n    const avgProb = trajectories.reduce((sum, t) => sum + (t.probabilityOfHit || 0.5), 0) / trajectories.length;\n    if (avgProb >= 0.7) {\n      baseExec = Math.min(1, baseExec + 0.15);\n      factors.push('Strong execution history');\n    } else if (avgProb < 0.4) {\n      baseExec = Math.max(0.3, baseExec - 0.2);\n      factors.push('Weak execution history');\n    }\n  }\n  \n  // Factor 2: Action complexity\n  const steps = action.steps?.length || 0;\n  const effort = resolution?.defaultEffort || 7;\n  if (steps > 5 || effort > 14) {\n    baseExec = Math.max(0.3, baseExec - 0.15);\n    factors.push('High complexity');\n  } else if (steps <= 2 && effort <= 3) {\n    baseExec = Math.min(1, baseExec + 0.1);\n    factors.push('Low complexity');\n  }\n  \n  // Factor 3: Runway pressure\n  if (company) {\n    const runway = company.cash && company.burn ? company.cash / company.burn : null;\n    if (runway !== null && runway < 6) {\n      if (source.sourceType !== 'ISSUE' || !context.issues?.find(i => i.issueId === source.issueId)?.severity === 'critical') {\n        baseExec = Math.max(0.3, baseExec - 0.1);\n        factors.push('Bandwidth constrained (low runway)');\n      }\n    }\n  }\n  \n  // Factor 4: Source type affects execution\n  switch (source.sourceType) {\n    case 'ISSUE': {\n      const issue = context.issues?.find(i => i.issueId === source.issueId);\n      if (issue?.severity === 'critical') {\n        baseExec = Math.min(1, baseExec + 0.1);\n        factors.push('Critical - high urgency');\n      }\n      break;\n    }\n    case 'PREISSUE': {\n      // PF2: Imminent pre-issues have higher execution probability\n      const preissue = context.preissues?.find(p => p.preIssueId === source.preIssueId);\n      if (preissue?.escalation?.isImminent) {\n        baseExec = Math.min(1, baseExec + 0.1);\n        factors.push('Imminent escalation - urgent');\n      } else {\n        baseExec = Math.max(0.3, baseExec - 0.1);\n        factors.push('Preventative (low urgency)');\n      }\n      break;\n    }\n    case 'GOAL': {\n      const traj = context.goalTrajectories?.find(t => t.goalId === source.goalId);\n      if (traj?.goalType === 'fundraise' && company?.raising) {\n        baseExec = Math.min(1, baseExec + 0.1);\n        factors.push('Active fundraise focus');\n      }\n      break;\n    }\n    case 'INTRODUCTION': {\n      // PF4: Timing directly affects execution probability\n      const timing = action.timing || 'LATER';\n      const adjust = TIMING_EXEC_PROBABILITY_ADJUST[timing] || -0.15;\n      baseExec = Math.max(0.2, Math.min(1, baseExec + adjust));\n      \n      if (timing === 'NOW') {\n        factors.push('Timing: NOW - high urgency');\n      } else if (timing === 'SOON') {\n        factors.push('Timing: SOON');\n      } else {\n        factors.push(`Timing: ${timing} - lower urgency`);\n      }\n      break;\n    }\n  }\n  \n  if (factors.length > 0) {\n    explain = factors.slice(0, 2).join('; ');\n  } else {\n    explain = 'Standard execution probability';\n  }\n  \n  return { value: Math.round(baseExec * 100) / 100, explain };\n}\n\n/**\n * Derive downside magnitude (failure cost)\n */\nfunction deriveDownsideMagnitude(action, context) {\n  const source = action.sources[0];\n  let value = 10;\n  let explain = '';\n  \n  switch (source.sourceType) {\n    case 'ISSUE': {\n      const resolution = getAnyResolution(action.resolutionId);\n      const effort = resolution?.defaultEffort || 7;\n      value = Math.min(50, effort * 2);\n      explain = `Effort wasted if unsuccessful (${effort}d)`;\n      break;\n    }\n    \n    case 'PREISSUE': {\n      value = 15;\n      explain = 'Low downside - preventative action';\n      break;\n    }\n    \n    case 'GOAL': {\n      value = 20;\n      explain = 'Opportunity cost if goal push fails';\n      break;\n    }\n    \n    case 'INTRODUCTION': {\n      // PF4: Trust risk IS the downside for intros\n      const trustRiskScore = action.trustRisk?.trustRiskScore || 30;\n      value = Math.round(trustRiskScore * 0.5); // Convert to 0-50 scale\n      explain = `Trust risk: ${action.trustRisk?.trustRiskBand || 'moderate'}`;\n      break;\n    }\n    \n    default:\n      value = 10;\n      explain = 'Minimal downside';\n  }\n  \n  return { value: Math.round(value), explain };\n}\n\n/**\n * Derive time to impact\n */\nfunction deriveTimeToImpactDays(action, context) {\n  const source = action.sources[0];\n  \n  if (source.sourceType === 'INTRODUCTION') {\n    // PF4: Timing affects expected time to impact\n    const timing = action.timing || 'LATER';\n    const timingDays = {\n      'NOW': 14,\n      'SOON': 30,\n      'LATER': 60,\n      'NEVER': 180\n    };\n    const value = timingDays[timing] || 60;\n    return { value, explain: `Intro timing: ${timing}` };\n  }\n  \n  const resolution = getAnyResolution(action.resolutionId);\n  const effort = resolution?.defaultEffort || 7;\n  const value = Math.ceil(effort * 1.2);\n  return { value, explain: `Based on ${effort}d effort estimate` };\n}\n\n/**\n * Derive effort cost\n */\nfunction deriveEffortCost(action, context) {\n  const source = action.sources[0];\n  \n  if (source.sourceType === 'INTRODUCTION') {\n    // Intros are low effort (2-3 days typically)\n    return { value: 10, explain: '2-3 days effort for intro' };\n  }\n  \n  const resolution = getAnyResolution(action.resolutionId);\n  const effort = resolution?.defaultEffort || 7;\n  const value = Math.min(100, Math.round((effort / 30) * 100));\n  return { value, explain: `${effort} days of effort` };\n}\n\n/**\n * Derive second order leverage (ripple upside)\n */\nfunction deriveSecondOrderLeverage(action, context) {\n  const source = action.sources[0];\n  let value = 10;\n  let explain = '';\n  \n  const companyId = action.entityRef.id;\n  \n  switch (source.sourceType) {\n    case 'ISSUE': {\n      const issue = context.issues?.find(i => i.issueId === source.issueId);\n      if (issue) {\n        const issueRipple = calculateIssueRipple(issue);\n        value = Math.round(issueRipple.rippleScore * 80);\n        explain = issueRipple.rippleExplain[0] || 'Removes downstream risk';\n      }\n      break;\n    }\n    \n    case 'PREISSUE': {\n      const preissue = context.preissues?.find(p => p.preIssueId === source.preIssueId);\n      if (preissue) {\n        value = Math.round(preissue.likelihood * 60);\n        explain = `Prevents ${preissue.preIssueType} cascade`;\n      }\n      break;\n    }\n    \n    case 'GOAL': {\n      const traj = context.goalTrajectories?.find(t => t.goalId === source.goalId);\n      if (traj?.goalType === 'fundraise') {\n        value = 70;\n        explain = 'Fundraise success enables growth';\n      } else if (traj?.goalType === 'revenue') {\n        value = 50;\n        explain = 'Revenue growth compounds';\n      } else {\n        value = 30;\n        explain = 'Goal achievement builds momentum';\n      }\n      break;\n    }\n    \n    case 'INTRODUCTION': {\n      // PF4: Optionality IS leverage for intros\n      const optionality = action.optionalityGain || 20;\n      value = Math.round(optionality);\n      explain = `Network optionality: ${optionality}`;\n      break;\n    }\n    \n    default:\n      explain = 'Limited second-order effects';\n  }\n  \n  return { value: Math.round(value), explain };\n}\n\n// =============================================================================\n// IMPACT MODEL ASSEMBLY\n// =============================================================================\n\n/**\n * Attach impact model to an action\n */\nexport function attachImpactModel(action, context) {\n  const upside = deriveUpsideMagnitude(action, context);\n  const prob = deriveProbabilityOfSuccess(action, context);\n  const execProb = deriveExecutionProbability(action, context);\n  const downside = deriveDownsideMagnitude(action, context);\n  const time = deriveTimeToImpactDays(action, context);\n  const effort = deriveEffortCost(action, context);\n  const leverage = deriveSecondOrderLeverage(action, context);\n  \n  // Build explanation (2-6 items)\n  const explain = [\n    upside.explain,\n    prob.explain,\n    execProb.explain !== 'Standard execution probability' ? execProb.explain : null,\n    leverage.value > 30 ? leverage.explain : null,\n    downside.value > 30 ? downside.explain : null\n  ].filter(Boolean).slice(0, 6);\n  \n  if (explain.length < 2) {\n    explain.push(effort.explain);\n  }\n  \n  // PF4: For INTRODUCTION actions, include timing rationale in explain\n  if (action.type === 'INTRODUCTION' && action.timingRationale) {\n    // Insert timing rationale as first explanation\n    explain.unshift(`Timing: ${action.timing} - ${action.timingRationale[0]}`);\n  }\n  \n  const impact = {\n    upsideMagnitude: upside.value,\n    probabilityOfSuccess: prob.value,\n    executionProbability: execProb.value,\n    downsideMagnitude: downside.value,\n    timeToImpactDays: time.value,\n    effortCost: effort.value,\n    secondOrderLeverage: leverage.value,\n    explain: explain.slice(0, 6) // Max 6\n  };\n  \n  return { ...action, impact };\n}\n\n/**\n * Attach impact models to all actions for a company\n */\nexport function attachCompanyImpactModels(actions, context) {\n  return actions.map(action => attachImpactModel(action, context));\n}\n\n/**\n * Attach impact models to all actions in portfolio\n */\nexport function attachPortfolioImpactModels({\n  actionsByCompany,\n  issuesByCompany,\n  preissuesByCompany,\n  goalTrajectoriesByCompany,\n  rippleByCompany,\n  companies\n}) {\n  const byCompany = {};\n  const all = [];\n  \n  for (const company of companies) {\n    const context = {\n      issues: issuesByCompany[company.id] || [],\n      preissues: preissuesByCompany[company.id] || [],\n      goalTrajectories: goalTrajectoriesByCompany[company.id] || [],\n      rippleByCompany,\n      company\n    };\n    \n    const actions = actionsByCompany[company.id] || [];\n    const withImpact = attachCompanyImpactModels(actions, context);\n    byCompany[company.id] = withImpact;\n    all.push(...withImpact);\n  }\n  \n  return { byCompany, all };\n}\n\nexport default {\n  attachImpactModel,\n  attachCompanyImpactModels,\n  attachPortfolioImpactModels\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3823, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/predict/trustRisk.js"],"sourcesContent":["/**\n * trustRisk.js\n * Backbone V9 ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â Trust Risk Calculator\n * \n * Computes trustRisk for introduction opportunities.\n * Trust risk is a social-capital downside model, not a vibe.\n * \n * Inputs:\n * 1. Relationship strength (0-100)\n * 2. Recency (days since last touch)\n * 3. Capital spent (intros in last 30/90 days)\n * 4. Warmth of path (direct vs 2-hop vs 3-hop)\n * 5. Fit mismatch risk (goal alignment, sector match)\n * 6. Reputational asymmetry (who is introducing)\n * \n * Output:\n * - trustRiskScore (0-100)\n * - trustRiskBand: 'low' | 'medium' | 'high'\n * - trustRiskReason[] (2-4 explanations)\n */\n\n/**\n * Recency buckets and their penalty multipliers\n */\nconst RECENCY_BUCKETS = [\n  { maxDays: 7, penalty: 0, label: 'very-recent' },\n  { maxDays: 30, penalty: 10, label: 'recent' },\n  { maxDays: 90, penalty: 25, label: 'moderate' },\n  { maxDays: Infinity, penalty: 40, label: 'stale' }\n];\n\n/**\n * Path length penalties\n */\nconst PATH_PENALTIES = {\n  1: 0,    // direct\n  2: 15,   // 2-hop\n  3: 35,   // 3-hop\n  default: 50  // 4+ hops\n};\n\n/**\n * Intro frequency penalties (asks in last 90 days to same person)\n */\nconst INTRO_FREQUENCY_PENALTIES = [\n  { maxIntros: 0, penalty: 0 },\n  { maxIntros: 1, penalty: 5 },\n  { maxIntros: 2, penalty: 15 },\n  { maxIntros: 3, penalty: 30 },\n  { maxIntros: Infinity, penalty: 50 }\n];\n\n/**\n * Calculate days between two dates\n */\nfunction daysBetween(date1, date2) {\n  const d1 = new Date(date1);\n  const d2 = new Date(date2);\n  const diffMs = Math.abs(d2 - d1);\n  return Math.floor(diffMs / (1000 * 60 * 60 * 24));\n}\n\n/**\n * Get recency penalty based on days since last touch\n */\nfunction getRecencyPenalty(daysSinceTouch) {\n  for (const bucket of RECENCY_BUCKETS) {\n    if (daysSinceTouch <= bucket.maxDays) {\n      return { penalty: bucket.penalty, label: bucket.label };\n    }\n  }\n  return { penalty: 40, label: 'stale' };\n}\n\n/**\n * Get path penalty based on hop count\n */\nfunction getPathPenalty(hops) {\n  return PATH_PENALTIES[hops] ?? PATH_PENALTIES.default;\n}\n\n/**\n * Get intro frequency penalty\n */\nfunction getIntroFrequencyPenalty(introsLast90Days) {\n  for (const bucket of INTRO_FREQUENCY_PENALTIES) {\n    if (introsLast90Days <= bucket.maxIntros) {\n      return bucket.penalty;\n    }\n  }\n  return 50;\n}\n\n/**\n * Calculate fit mismatch penalty\n * @param {Object} params\n * @param {string[]} targetTags - tags of the target person\n * @param {string[]} goalTags - tags relevant to the goal\n * @param {string} targetSector - sector of target\n * @param {string} companySector - sector of company needing intro\n */\nfunction getFitMismatchPenalty({ targetTags = [], goalTags = [], targetSector, companySector }) {\n  let penalty = 0;\n  const reasons = [];\n\n  // Check tag overlap\n  const tagOverlap = targetTags.filter(t => goalTags.includes(t)).length;\n  if (tagOverlap === 0 && goalTags.length > 0) {\n    penalty += 20;\n    reasons.push('No expertise overlap with goal requirements');\n  } else if (tagOverlap === 1) {\n    penalty += 10;\n    reasons.push('Weak expertise overlap');\n  }\n\n  // Check sector match\n  if (targetSector && companySector && targetSector !== companySector) {\n    // Some sectors are adjacent\n    const adjacentSectors = {\n      'Payments': ['Fintech', 'Crypto', 'Financial Infrastructure'],\n      'Fintech': ['Payments', 'Enterprise Software', 'Crypto'],\n      'Enterprise Software': ['Developer Tools', 'AI', 'Fintech'],\n      'Developer Tools': ['Enterprise Software', 'AI'],\n      'Crypto': ['Fintech', 'Payments'],\n      'AI': ['Enterprise Software', 'Developer Tools']\n    };\n    \n    const isAdjacent = adjacentSectors[companySector]?.includes(targetSector);\n    if (!isAdjacent) {\n      penalty += 15;\n      reasons.push(`Sector mismatch: ${targetSector} vs ${companySector}`);\n    }\n  }\n\n  return { penalty, reasons };\n}\n\n/**\n * Calculate reputational asymmetry penalty\n * Higher penalty if the introducer has more to lose\n * @param {Object} params\n * @param {string} introducerRole - role of person making intro\n * @param {number} relationshipStrength - strength with target\n * @param {number} introSuccessRate - historical success rate\n */\nfunction getReputationalPenalty({ introducerRole, relationshipStrength, introSuccessRate }) {\n  let penalty = 0;\n  const reasons = [];\n\n  // Senior roles have more reputational risk\n  const seniorRoles = ['Managing Partner', 'Partner', 'CEO', 'CTO'];\n  const isSenior = seniorRoles.some(r => introducerRole?.includes(r));\n  \n  if (isSenior && relationshipStrength < 70) {\n    penalty += 15;\n    reasons.push('Senior introducer with moderate relationship strength');\n  }\n\n  // Poor historical success rate increases risk\n  if (introSuccessRate !== undefined && introSuccessRate < 0.5) {\n    penalty += 10;\n    reasons.push(`Below-average intro success rate (${Math.round(introSuccessRate * 100)}%)`);\n  }\n\n  return { penalty, reasons };\n}\n\n/**\n * Main trust risk calculation\n * @param {Object} params\n * @param {Object} relationship - the relationship edge being used\n * @param {number} pathLength - number of hops (1 = direct)\n * @param {number} introsLast90Days - number of intros to this person in last 90 days\n * @param {Object} targetPerson - the person being introduced to\n * @param {Object} goal - the goal this intro supports\n * @param {Object} company - the company needing the intro\n * @param {Object} introducer - the person making the intro\n * @param {Date|string} now - current date for recency calculation\n */\nexport function calculateTrustRisk({\n  relationship,\n  pathLength = 1,\n  introsLast90Days = 0,\n  targetPerson = {},\n  goal = {},\n  company = {},\n  introducer = {},\n  now = new Date()\n}) {\n  const reasons = [];\n  let totalPenalty = 0;\n\n  // 1. Base from relationship strength (invert: higher strength = lower risk)\n  const strengthPenalty = Math.max(0, 100 - (relationship?.strength ?? 50));\n  const strengthContribution = strengthPenalty * 0.3; // Weight: 30%\n  totalPenalty += strengthContribution;\n  \n  if (relationship?.strength < 50) {\n    reasons.push(`Weak relationship (strength: ${relationship?.strength ?? 'unknown'})`);\n  }\n\n  // 2. Recency penalty\n  const daysSinceTouch = relationship?.lastTouchAt \n    ? daysBetween(relationship.lastTouchAt, now)\n    : 180; // Default to stale if unknown\n  \n  const recency = getRecencyPenalty(daysSinceTouch);\n  totalPenalty += recency.penalty;\n  \n  if (recency.penalty > 10) {\n    reasons.push(`${recency.label} contact (${daysSinceTouch} days ago)`);\n  }\n\n  // 3. Capital spent / ask frequency\n  const frequencyPenalty = getIntroFrequencyPenalty(introsLast90Days);\n  totalPenalty += frequencyPenalty;\n  \n  if (frequencyPenalty > 10) {\n    reasons.push(`Recent intro requests (${introsLast90Days} in last 90 days)`);\n  }\n\n  // 4. Path warmth\n  const pathPenalty = getPathPenalty(pathLength);\n  totalPenalty += pathPenalty;\n  \n  if (pathLength > 1) {\n    reasons.push(`${pathLength}-hop path (not direct relationship)`);\n  }\n\n  // 5. Fit mismatch\n  const goalTags = getGoalTags(goal);\n  const fitResult = getFitMismatchPenalty({\n    targetTags: targetPerson?.tags ?? [],\n    goalTags,\n    targetSector: targetPerson?.orgType === 'investor' ? 'Investor' : null,\n    companySector: company?.sector\n  });\n  totalPenalty += fitResult.penalty;\n  reasons.push(...fitResult.reasons);\n\n  // 6. Reputational asymmetry\n  const introSuccessRate = relationship?.introCount > 0\n    ? (relationship.introSuccessCount ?? 0) / relationship.introCount\n    : undefined;\n  \n  const reputationalResult = getReputationalPenalty({\n    introducerRole: introducer?.role,\n    relationshipStrength: relationship?.strength,\n    introSuccessRate\n  });\n  totalPenalty += reputationalResult.penalty;\n  reasons.push(...reputationalResult.reasons);\n\n  // Clamp to 0-100\n  const trustRiskScore = Math.min(100, Math.max(0, Math.round(totalPenalty)));\n\n  // Determine band\n  let trustRiskBand;\n  if (trustRiskScore <= 30) {\n    trustRiskBand = 'low';\n  } else if (trustRiskScore <= 60) {\n    trustRiskBand = 'medium';\n  } else {\n    trustRiskBand = 'high';\n  }\n\n  // Limit reasons to 4 most significant\n  const topReasons = reasons.slice(0, 4);\n\n  return {\n    trustRiskScore,\n    trustRiskBand,\n    trustRiskReason: topReasons.length > 0 ? topReasons : ['Baseline risk assessment']\n  };\n}\n\n/**\n * Extract relevant tags from a goal for matching\n */\nfunction getGoalTags(goal) {\n  const tags = [];\n  \n  if (goal?.type === 'fundraise') {\n    tags.push('investor', 'fundraising', 'capital');\n    // Stage-specific tags\n    if (goal.name?.toLowerCase().includes('seed')) tags.push('seed', 'pre-seed');\n    if (goal.name?.toLowerCase().includes('series')) tags.push('series-a', 'growth');\n  }\n  \n  if (goal?.type === 'partnership') {\n    tags.push('partnerships', 'business-development');\n  }\n  \n  if (goal?.type === 'hiring') {\n    tags.push('hiring', 'recruiting', 'talent');\n  }\n  \n  if (goal?.type === 'revenue') {\n    tags.push('sales', 'customers', 'growth');\n  }\n\n  return tags;\n}\n\n/**\n * Check if trust risk should block amplification\n */\nexport function shouldBlockAmplification(trustRisk) {\n  return trustRisk.trustRiskBand === 'high';\n}\n\n/**\n * Get intro capital available for a relationship\n * (how many more intros can be made without excessive risk)\n */\nexport function getIntroCapitalRemaining(introsLast90Days) {\n  if (introsLast90Days >= 3) return 0;\n  if (introsLast90Days >= 2) return 1;\n  if (introsLast90Days >= 1) return 2;\n  return 3;\n}\n\nexport default {\n  calculateTrustRisk,\n  shouldBlockAmplification,\n  getIntroCapitalRemaining,\n  // Expose for testing\n  getRecencyPenalty,\n  getPathPenalty,\n  getIntroFrequencyPenalty\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4153, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/predict/introOpportunity.js"],"sourcesContent":["/**\n * introOpportunity.js\n * Backbone V9 Phase 4.0 - Introduction Opportunity Generator\n * \n * Generates IntroductionOpportunity objects by:\n * 1. Finding blocked/at-risk goals\n * 2. Traversing relationship graph for paths to helpful contacts\n * 3. Computing probability, trust risk, ripple map, and optionality\n * 4. PF4: Computing timing recommendation (NOW/SOON/LATER/NEVER)\n * \n * NO PERSISTENCE - all derived, ephemeral, deterministic.\n */\n\nimport { calculateTrustRisk, shouldBlockAmplification } from './trustRisk.js';\n\n/**\n * PF4: Timing states with explicit semantics\n * - NOW: Clear evidence action should be taken immediately (rare)\n * - SOON: Within 2-4 weeks, conditions favorable\n * - LATER: Default when uncertain, wait for better signal\n * - NEVER: Explicit block due to trust risk or poor fit\n */\nexport const TIMING_STATES = ['NOW', 'SOON', 'LATER', 'NEVER'];\n\n/**\n * Goal types that can benefit from introductions\n */\nconst INTRO_RELEVANT_GOAL_TYPES = ['fundraise', 'partnership', 'hiring'];\n\n/**\n * Person org types that can help with specific goal types\n */\nconst GOAL_TO_TARGET_ORG_TYPES = {\n  fundraise: ['investor', 'external'],\n  partnership: ['company', 'external'],\n  hiring: ['company', 'external']\n};\n\n/**\n * Build adjacency list from relationships array\n * Returns bidirectional map: personId -> [{ personId, relationship }]\n */\nfunction buildRelationshipGraph(relationships) {\n  const graph = new Map();\n  \n  for (const rel of relationships) {\n    // Forward edge\n    if (!graph.has(rel.fromPersonId)) {\n      graph.set(rel.fromPersonId, []);\n    }\n    graph.get(rel.fromPersonId).push({\n      personId: rel.toPersonId,\n      relationship: rel\n    });\n    \n    // Reverse edge (relationships are bidirectional for traversal)\n    if (!graph.has(rel.toPersonId)) {\n      graph.set(rel.toPersonId, []);\n    }\n    graph.get(rel.toPersonId).push({\n      personId: rel.fromPersonId,\n      relationship: { ...rel, _reversed: true }\n    });\n  }\n  \n  return graph;\n}\n\n/**\n * Find all paths from source to targets up to maxHops\n * Returns array of { path: [personId, ...], relationships: [rel, ...] }\n */\nfunction findPaths(graph, sourceIds, targetIds, maxHops = 2) {\n  const paths = [];\n  const targetSet = new Set(targetIds);\n  \n  for (const sourceId of sourceIds) {\n    // BFS with path tracking\n    const queue = [{ \n      personId: sourceId, \n      path: [sourceId], \n      relationships: [],\n      visited: new Set([sourceId])\n    }];\n    \n    while (queue.length > 0) {\n      const { personId, path, relationships, visited } = queue.shift();\n      \n      // Check if we reached a target\n      if (targetSet.has(personId) && path.length > 1) {\n        paths.push({ path, relationships });\n        continue; // Don't explore beyond target\n      }\n      \n      // Stop if we've reached max hops\n      if (path.length > maxHops) continue;\n      \n      // Explore neighbors\n      const neighbors = graph.get(personId) || [];\n      for (const { personId: nextId, relationship } of neighbors) {\n        if (!visited.has(nextId)) {\n          const newVisited = new Set(visited);\n          newVisited.add(nextId);\n          queue.push({\n            personId: nextId,\n            path: [...path, nextId],\n            relationships: [...relationships, relationship],\n            visited: newVisited\n          });\n        }\n      }\n    }\n  }\n  \n  return paths;\n}\n\n/**\n * Score a path based on relationship strengths\n */\nfunction scorePath(path, relationships) {\n  if (relationships.length === 0) return 0;\n  \n  // Geometric mean of relationship strengths, penalized by length\n  const strengths = relationships.map(r => r.strength / 100);\n  const product = strengths.reduce((a, b) => a * b, 1);\n  const geoMean = Math.pow(product, 1 / strengths.length);\n  \n  // Length penalty: each hop reduces score\n  const lengthPenalty = Math.pow(0.7, relationships.length - 1);\n  \n  return geoMean * lengthPenalty;\n}\n\n// =============================================================================\n// PF3: SECOND-ORDER INTRO MODELING\n// =============================================================================\n\n/**\n * PF3: Baseline conversion probability for direct intros (1-hop)\n */\nconst BASELINE_CONVERSION = 0.15;\n\n/**\n * PF3: Minimum conversion lift required for second-order paths\n * Second-order paths must exceed this multiple of baseline to be worth the complexity\n */\nconst SECOND_ORDER_MIN_LIFT = 1.2; // Must be 20% better than baseline\n\n/**\n * PF3: Hard cap on traversal depth - architecturally enforced\n */\nconst MAX_PATH_DEPTH = 2;\n\n/**\n * PF3: Compute expected conversion lift for a path\n * \n * Second-order paths are only valuable if:\n * 1. They're tied to a real Action (intro must serve a goal)\n * 2. Expected conversion exceeds baseline by MIN_LIFT\n * \n * Returns { conversionLift, expectedConversion, isSecondOrder, includeInRanking, explain }\n */\nfunction computeSecondOrderConversionLift(path, relationships, target, goal) {\n  const pathLength = relationships.length;\n  const isSecondOrder = pathLength > 1;\n  \n  // Direct paths always included\n  if (!isSecondOrder) {\n    return {\n      conversionLift: 1.0,\n      expectedConversion: BASELINE_CONVERSION,\n      isSecondOrder: false,\n      includeInRanking: true,\n      explain: 'Direct intro (1-hop)'\n    };\n  }\n  \n  // Second-order path analysis\n  // Compute expected conversion based on relationship chain\n  const chainStrength = relationships.reduce((prod, r) => prod * (r.strength / 100), 1);\n  \n  // Factor in relationship quality at each hop\n  const avgStrength = relationships.reduce((sum, r) => sum + (r.strength || 50), 0) / pathLength;\n  \n  // Second-order penalty: each hop reduces conversion by ~40%\n  const hopPenalty = Math.pow(0.6, pathLength - 1);\n  \n  // Expected conversion for second-order\n  const expectedConversion = BASELINE_CONVERSION * chainStrength * hopPenalty * (avgStrength / 50);\n  \n  // Compute lift relative to baseline\n  const conversionLift = expectedConversion / BASELINE_CONVERSION;\n  \n  // PF3 Rule: Only include if lift > minimum threshold\n  // This filters out noisy second-order paths\n  const includeInRanking = conversionLift >= SECOND_ORDER_MIN_LIFT;\n  \n  let explain;\n  if (includeInRanking) {\n    explain = `Second-order path (${pathLength} hops): ${(conversionLift * 100).toFixed(0)}% lift vs baseline`;\n  } else {\n    explain = `Second-order path filtered: ${(conversionLift * 100).toFixed(0)}% lift < ${SECOND_ORDER_MIN_LIFT * 100}% threshold`;\n  }\n  \n  return {\n    conversionLift: Math.round(conversionLift * 100) / 100,\n    expectedConversion: Math.round(expectedConversion * 1000) / 1000,\n    isSecondOrder,\n    includeInRanking,\n    explain\n  };\n}\n\n/**\n * PF3: Filter paths to only include valuable second-order connections\n * \n * @param {Object[]} paths - All found paths\n * @param {Object} target - Target person\n * @param {Object} goal - Associated goal (required - must be tied to real Action)\n * @returns {Object[]} Filtered paths with conversion data\n */\nfunction filterSecondOrderPaths(paths, target, goal) {\n  // PF3 Rule: Second-order paths must be tied to a real Action\n  if (!goal) {\n    // No goal = no Action = filter out all second-order\n    return paths.filter(p => p.relationships.length === 1).map(p => ({\n      ...p,\n      secondOrder: {\n        conversionLift: 1.0,\n        expectedConversion: BASELINE_CONVERSION,\n        isSecondOrder: false,\n        includeInRanking: true,\n        explain: 'Direct intro (1-hop)'\n      }\n    }));\n  }\n  \n  // Compute conversion lift for all paths\n  const pathsWithLift = paths.map(p => ({\n    ...p,\n    secondOrder: computeSecondOrderConversionLift(p.path, p.relationships, target, goal)\n  }));\n  \n  // Filter: only include paths that pass the lift threshold\n  const filteredPaths = pathsWithLift.filter(p => p.secondOrder.includeInRanking);\n  \n  // PF3 Rule: Kill feature if noise > signal\n  // If >80% of second-order paths are filtered, the feature is adding noise\n  const secondOrderPaths = pathsWithLift.filter(p => p.secondOrder.isSecondOrder);\n  const includedSecondOrder = filteredPaths.filter(p => p.secondOrder.isSecondOrder);\n  \n  if (secondOrderPaths.length > 0) {\n    const inclusionRate = includedSecondOrder.length / secondOrderPaths.length;\n    // If <20% of second-order paths pass, feature is noise - return only direct\n    if (inclusionRate < 0.2) {\n      return filteredPaths.filter(p => !p.secondOrder.isSecondOrder);\n    }\n  }\n  \n  return filteredPaths;\n}\n\n/**\n * Determine if a goal is blocked or at-risk\n */\nfunction isGoalBlocked(goal, company, now = new Date()) {\n  if (goal.status !== 'active') return false;\n  \n  const dueDate = new Date(goal.due);\n  const daysRemaining = Math.floor((dueDate - now) / (1000 * 60 * 60 * 24));\n  const progressPct = (goal.current / goal.target) * 100;\n  \n  // Fundraise-specific: check deal pipeline\n  if (goal.type === 'fundraise') {\n    const totalCommitted = (company.deals || [])\n      .filter(d => ['termsheet', 'dd'].includes(d.status))\n      .reduce((sum, d) => sum + (d.amount * d.probability / 100), 0);\n    \n    const gap = goal.target - goal.current - totalCommitted;\n    if (gap > 0 && daysRemaining < 60) return true;\n  }\n  \n  // Partnership-specific: low progress with deadline approaching\n  if (goal.type === 'partnership') {\n    if (progressPct < 50 && daysRemaining < 45) return true;\n  }\n  \n  // Hiring: slow progress\n  if (goal.type === 'hiring') {\n    const expectedProgress = Math.max(0, 100 - (daysRemaining / 90) * 100);\n    if (progressPct < expectedProgress * 0.7) return true;\n  }\n  \n  // General: behind trajectory\n  const daysTotal = 90; // Assume 90-day goal window\n  const expectedPct = Math.min(100, ((daysTotal - daysRemaining) / daysTotal) * 100);\n  return progressPct < expectedPct * 0.6;\n}\n\n/**\n * Find potential targets for a goal\n */\nfunction findPotentialTargets(goal, company, people, investors) {\n  const targets = [];\n  const targetOrgTypes = GOAL_TO_TARGET_ORG_TYPES[goal.type] || [];\n  \n  for (const person of people) {\n    if (!targetOrgTypes.includes(person.orgType)) continue;\n    \n    // Skip people already at this company\n    if (person.orgId === company.id) continue;\n    \n    // For fundraise, check if investor matches stage/sector\n    if (goal.type === 'fundraise' && person.orgType === 'investor') {\n      const investor = investors.find(i => i.personId === person.id || i.id === person.orgId);\n      if (investor) {\n        const stageMatch = investor.stageFocus?.toLowerCase().includes(company.stage?.toLowerCase());\n        const sectorMatch = investor.sectorFocus?.toLowerCase().includes(company.sector?.toLowerCase());\n        if (stageMatch || sectorMatch) {\n          targets.push({ person, relevanceScore: (stageMatch ? 50 : 0) + (sectorMatch ? 50 : 0) });\n        }\n      }\n    }\n    \n    // For partnerships, check sector alignment\n    if (goal.type === 'partnership') {\n      const sectorMatch = person.tags?.some(t => \n        company.sector?.toLowerCase().includes(t.toLowerCase())\n      );\n      if (sectorMatch || person.orgType === 'external') {\n        targets.push({ person, relevanceScore: sectorMatch ? 70 : 30 });\n      }\n    }\n    \n    // For hiring, check relevant expertise\n    if (goal.type === 'hiring') {\n      const relevantTags = ['hiring', 'recruiting', 'talent', 'engineering', 'sales'];\n      const tagMatch = person.tags?.some(t => relevantTags.includes(t.toLowerCase()));\n      if (tagMatch) {\n        targets.push({ person, relevanceScore: 50 });\n      }\n    }\n  }\n  \n  return targets;\n}\n\n/**\n * Calculate intro probability of success\n */\nfunction calculateIntroProbability(path, relationships, target, goal) {\n  // Base: path score\n  let probability = scorePath(path, relationships);\n  \n  // Adjust for target relevance\n  probability *= (target.relevanceScore / 100);\n  \n  // Clamp to reasonable range\n  return Math.min(0.8, Math.max(0.1, probability));\n}\n\n/**\n * Estimate optionality gain from an intro\n */\nfunction estimateOptionalityGain(target, goal, company) {\n  let gain = 0;\n  \n  // Investor intros create fundraising optionality\n  if (target.person.orgType === 'investor') {\n    gain += 30;\n    if (target.person.tags?.includes('founder-friendly')) gain += 10;\n  }\n  \n  // External contacts create partnership optionality\n  if (target.person.orgType === 'external') {\n    gain += 20;\n    if (['CEO', 'CTO', 'Partner'].some(r => target.person.role?.includes(r))) {\n      gain += 15;\n    }\n  }\n  \n  // Cross-portfolio intros create network effects\n  if (target.person.orgType === 'company') {\n    gain += 25;\n  }\n  \n  return Math.min(100, gain);\n}\n\n/**\n * PF4: Compute intro timing recommendation\n * \n * Inputs:\n * - Trajectory velocity (are they making progress?)\n * - Goal distance (how far from target?)\n * - Investor cycle timing (for fundraise goals)\n * - Trust risk level\n * \n * Default: LATER (conservative)\n * \n * @returns {{ timing: string, timingRationale: string[], confidence: number }}\n */\nfunction computeIntroTiming({\n  goal,\n  company,\n  trustRisk,\n  probability,\n  trajectory,\n  now = new Date()\n}) {\n  const rationale = [];\n  let score = 0; // Higher = more urgent timing\n  let confidence = 0.5; // How confident we are in the recommendation\n  \n  const dueDate = new Date(goal.due);\n  const daysRemaining = Math.floor((dueDate - now) / (1000 * 60 * 60 * 24));\n  const progressPct = (goal.current / goal.target) * 100;\n  const gap = 100 - progressPct;\n  \n  // === Factor 1: Goal distance (gap to target) ===\n  if (gap > 70) {\n    score += 2;\n    rationale.push(`Large gap to target (${gap.toFixed(0)}% remaining)`);\n    confidence += 0.1;\n  } else if (gap > 40) {\n    score += 1;\n    rationale.push(`Moderate gap to target (${gap.toFixed(0)}% remaining)`);\n  } else {\n    rationale.push(`Goal on track (${progressPct.toFixed(0)}% complete)`);\n    confidence += 0.15;\n  }\n  \n  // === Factor 2: Time pressure ===\n  if (daysRemaining < 21) {\n    score += 3;\n    rationale.push(`Critical: ${daysRemaining} days remaining`);\n    confidence += 0.15;\n  } else if (daysRemaining < 45) {\n    score += 2;\n    rationale.push(`Approaching deadline: ${daysRemaining} days`);\n    confidence += 0.1;\n  } else if (daysRemaining < 90) {\n    score += 1;\n    rationale.push(`Reasonable runway: ${daysRemaining} days`);\n  } else {\n    rationale.push(`Ample time: ${daysRemaining} days`);\n    confidence -= 0.1; // Less certain, more time to wait\n  }\n  \n  // === Factor 3: Trajectory velocity (if available) ===\n  if (trajectory) {\n    if (trajectory.velocity < 0) {\n      score += 2;\n      rationale.push('Negative velocity - losing ground');\n      confidence += 0.1;\n    } else if (trajectory.probabilityOfHit < 0.3) {\n      score += 2;\n      rationale.push(`Low probability of hit (${(trajectory.probabilityOfHit * 100).toFixed(0)}%)`);\n      confidence += 0.1;\n    } else if (trajectory.probabilityOfHit > 0.7) {\n      score -= 1;\n      rationale.push(`Good probability of hit (${(trajectory.probabilityOfHit * 100).toFixed(0)}%)`);\n      confidence += 0.1;\n    }\n  }\n  \n  // === Factor 4: Fundraise-specific investor cycle timing ===\n  if (goal.type === 'fundraise') {\n    const month = now.getMonth();\n    // Q1 and Q4 are better for fundraising (budget cycles)\n    if (month >= 0 && month <= 2) {\n      score += 1;\n      rationale.push('Q1 - favorable fundraising season');\n      confidence += 0.05;\n    } else if (month >= 8 && month <= 10) {\n      score += 1;\n      rationale.push('Q4 - favorable fundraising season');\n      confidence += 0.05;\n    } else if (month >= 6 && month <= 7) {\n      score -= 1;\n      rationale.push('Summer - slower investor activity');\n    }\n    \n    // Check existing deal pipeline\n    const activeDeals = (company.deals || []).filter(d => \n      ['meeting', 'dd', 'termsheet'].includes(d.status)\n    ).length;\n    \n    if (activeDeals === 0) {\n      score += 2;\n      rationale.push('No active deals - pipeline needs intros');\n      confidence += 0.1;\n    } else if (activeDeals >= 3) {\n      score -= 1;\n      rationale.push(`${activeDeals} active deals - pipeline healthy`);\n    }\n  }\n  \n  // === Factor 5: Trust risk penalty ===\n  if (trustRisk.trustRiskScore > 70) {\n    score -= 3;\n    rationale.push(`High trust risk (${trustRisk.trustRiskScore}) - delay recommended`);\n    confidence += 0.15; // More confident about NOT doing it\n  } else if (trustRisk.trustRiskScore > 50) {\n    score -= 1;\n    rationale.push(`Moderate trust risk (${trustRisk.trustRiskScore})`);\n  }\n  \n  // === Factor 6: Intro probability ===\n  if (probability < 0.3) {\n    score -= 1;\n    rationale.push(`Low success probability (${(probability * 100).toFixed(0)}%)`);\n  } else if (probability > 0.6) {\n    score += 1;\n    rationale.push(`Good success probability (${(probability * 100).toFixed(0)}%)`);\n    confidence += 0.1;\n  }\n  \n  // === Determine timing state ===\n  // Default to LATER on uncertainty (per PF4 spec)\n  let timing;\n  \n  if (trustRisk.trustRiskScore > 80) {\n    timing = 'NEVER';\n    rationale.unshift('BLOCKED: Trust risk too high');\n    confidence = 0.9;\n  } else if (score >= 6 && confidence > 0.6) {\n    timing = 'NOW';\n    rationale.unshift('Immediate action recommended');\n  } else if (score >= 3 && confidence > 0.5) {\n    timing = 'SOON';\n    rationale.unshift('Action recommended within 2-4 weeks');\n  } else {\n    timing = 'LATER';\n    rationale.unshift('Wait for better signal or conditions');\n    // If we're defaulting to LATER, note the uncertainty\n    if (confidence < 0.5) {\n      rationale.push('Insufficient confidence for earlier timing');\n    }\n  }\n  \n  return {\n    timing,\n    timingRationale: rationale,\n    timingConfidence: Math.min(1, Math.max(0, confidence)),\n    timingScore: score\n  };\n}\n\n/**\n * Build human-readable rationale for intro (PF4: force explicit rationale)\n */\nfunction buildRationale(goal, target, introducer, trustRisk, timing) {\n  const lines = [];\n  \n  // Required: Why this intro matters\n  lines.push(`Goal \"${goal.name}\" needs acceleration.`);\n  \n  // Required: Who and why they're relevant\n  lines.push(`${target.person.name} (${target.person.role || 'Contact'}) is a fit because: ${\n    target.relevanceScore >= 70 ? 'strong sector/stage match' :\n    target.relevanceScore >= 40 ? 'moderate relevance' :\n    'potential connection'\n  }.`);\n  \n  // Required: Path to intro\n  if (introducer) {\n    lines.push(`Path: ${introducer.name} can introduce.`);\n  }\n  \n  // Required: Risk acknowledgment\n  lines.push(`Trust risk: ${trustRisk.trustRiskBand} (${trustRisk.trustRiskScore}/100).`);\n  \n  // Required: Timing with reason\n  lines.push(`Timing: ${timing.timing} - ${timing.timingRationale[0]}`);\n  \n  return lines;\n}\n\n/**\n * Generate introduction opportunities for a company\n */\nexport function generateIntroOpportunities({\n  company,\n  goals,\n  people,\n  relationships,\n  investors,\n  team,\n  goalTrajectories = [],\n  now = new Date()\n}) {\n  const opportunities = [];\n  const graph = buildRelationshipGraph(relationships);\n  \n  // Get team person IDs (potential introducers)\n  const teamPersonIds = team.map(t => t.personId).filter(Boolean);\n  \n  // Also include founder person IDs as potential introducers\n  const founderPersonIds = company.founderPersonIds || [];\n  const introducerIds = [...new Set([...teamPersonIds, ...founderPersonIds])];\n  \n  // Find blocked goals that could benefit from intros\n  const relevantGoals = goals.filter(g => \n    INTRO_RELEVANT_GOAL_TYPES.includes(g.type) && \n    isGoalBlocked(g, company, now)\n  );\n  \n  for (const goal of relevantGoals) {\n    // Get trajectory for this goal if available\n    const trajectory = goalTrajectories.find(t => t.goalId === goal.id);\n    \n    // Find potential targets\n    const targets = findPotentialTargets(goal, company, people, investors);\n    \n    for (const target of targets) {\n      // Find paths from team to target\n      const rawPaths = findPaths(graph, introducerIds, [target.person.id], MAX_PATH_DEPTH);\n      \n      if (rawPaths.length === 0) continue;\n      \n      // PF3: Filter second-order paths by conversion lift\n      const filteredPaths = filterSecondOrderPaths(rawPaths, target, goal);\n      \n      if (filteredPaths.length === 0) continue;\n      \n      // Take best path (considering conversion lift for second-order)\n      const bestPath = filteredPaths.reduce((best, current) => {\n        // Score combines path strength and conversion lift\n        const currentScore = scorePath(current.path, current.relationships) * \n          (current.secondOrder?.conversionLift || 1);\n        const bestScore = scorePath(best.path, best.relationships) *\n          (best.secondOrder?.conversionLift || 1);\n        return currentScore > bestScore ? current : best;\n      });\n      \n      // Get introducer (first person in path who is on team)\n      const introducerId = bestPath.path[0];\n      const introducer = team.find(t => t.personId === introducerId) || \n                         people.find(p => p.id === introducerId);\n      \n      // Calculate trust risk\n      const primaryRelationship = bestPath.relationships[0];\n      const introsLast90Days = primaryRelationship?.introCount || 0;\n      \n      const trustRisk = calculateTrustRisk({\n        relationship: primaryRelationship,\n        pathLength: bestPath.path.length - 1,\n        introsLast90Days,\n        targetPerson: target.person,\n        goal,\n        company,\n        introducer,\n        now\n      });\n      \n      // Calculate probability\n      const probability = calculateIntroProbability(\n        bestPath.path, \n        bestPath.relationships, \n        target, \n        goal\n      );\n      \n      // PF4: Compute timing recommendation\n      const timing = computeIntroTiming({\n        goal,\n        company,\n        trustRisk,\n        probability,\n        trajectory,\n        now\n      });\n      \n      // Skip if timing is NEVER (explicit block)\n      if (timing.timing === 'NEVER') {\n        continue;\n      }\n      \n      // Also skip if trust risk too high AND timing didn't already block\n      if (shouldBlockAmplification(trustRisk) && timing.timing !== 'NEVER') {\n        continue;\n      }\n      \n      // Calculate optionality gain\n      const optionalityGain = estimateOptionalityGain(target, goal, company);\n      \n      // Build opportunity with PF4 timing and PF3 second-order data\n      const opportunity = {\n        id: `intro-${company.id}-${goal.id}-${target.person.id}`,\n        type: 'INTRODUCTION',\n        companyId: company.id,\n        goalId: goal.id,\n        \n        // Path details\n        introducerId,\n        introducerName: introducer?.name,\n        targetPersonId: target.person.id,\n        targetPersonName: target.person.name,\n        targetOrg: target.person.orgId,\n        path: bestPath.path,\n        pathLength: bestPath.path.length - 1,\n        \n        // Scores\n        probability,\n        trustRisk,\n        optionalityGain,\n        relevanceScore: target.relevanceScore,\n        \n        // PF3: Second-order conversion data\n        secondOrder: bestPath.secondOrder,\n        conversionLift: bestPath.secondOrder?.conversionLift || 1.0,\n        isSecondOrder: bestPath.secondOrder?.isSecondOrder || false,\n        \n        // PF4: Timing\n        timing: timing.timing,\n        timingRationale: timing.timingRationale,\n        timingConfidence: timing.timingConfidence,\n        \n        // Explanation (PF4: force explicit rationale)\n        rationale: buildRationale(goal, target, introducer, trustRisk, timing),\n        \n        // Metadata\n        generatedAt: now.toISOString(),\n        ephemeral: true\n      };\n      \n      opportunities.push(opportunity);\n    }\n  }\n  \n  // Sort by timing priority, then by probability adjusted for risk\n  const timingOrder = { 'NOW': 0, 'SOON': 1, 'LATER': 2, 'NEVER': 3 };\n  opportunities.sort((a, b) => {\n    // Primary: timing\n    const timingDiff = timingOrder[a.timing] - timingOrder[b.timing];\n    if (timingDiff !== 0) return timingDiff;\n    \n    // Secondary: probability * (100 - trustRiskScore)\n    const aScore = a.probability * (100 - a.trustRisk.trustRiskScore);\n    const bScore = b.probability * (100 - b.trustRisk.trustRiskScore);\n    return bScore - aScore;\n  });\n  \n  return opportunities;\n}\n\n/**\n * Generate intro opportunities for entire portfolio\n */\nexport function generatePortfolioIntroOpportunities({\n  companies,\n  people,\n  relationships,\n  investors,\n  team,\n  goalTrajectoriesByCompany = {},\n  now = new Date()\n}) {\n  const allOpportunities = [];\n  \n  for (const company of companies) {\n    const companyOpportunities = generateIntroOpportunities({\n      company,\n      goals: company.goals || [],\n      people,\n      relationships,\n      investors,\n      team,\n      goalTrajectories: goalTrajectoriesByCompany[company.id] || [],\n      now\n    });\n    \n    allOpportunities.push(...companyOpportunities);\n  }\n  \n  // Sort globally by timing then score\n  const timingOrder = { 'NOW': 0, 'SOON': 1, 'LATER': 2, 'NEVER': 3 };\n  allOpportunities.sort((a, b) => {\n    const timingDiff = timingOrder[a.timing] - timingOrder[b.timing];\n    if (timingDiff !== 0) return timingDiff;\n    \n    const aScore = a.probability * (100 - a.trustRisk.trustRiskScore) * (1 + a.optionalityGain / 100);\n    const bScore = b.probability * (100 - b.trustRisk.trustRiskScore) * (1 + b.optionalityGain / 100);\n    return bScore - aScore;\n  });\n  \n  return allOpportunities;\n}\n\nexport default {\n  generateIntroOpportunities,\n  generatePortfolioIntroOpportunities,\n  TIMING_STATES,\n  // Expose for testing\n  buildRelationshipGraph,\n  findPaths,\n  isGoalBlocked,\n  computeIntroTiming\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4855, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/decide/weights.js"],"sourcesContent":["/**\n * decide/weights.js Ã¢â‚¬â€ Centralized Ranking Weights (Phase 4.5)\n * \n * ALL ranking weights live here. No magic numbers elsewhere.\n * Changes require QA validation.\n * \n * @module decide/weights\n */\n\n// =============================================================================\n// RANKING FORMULA WEIGHTS\n// =============================================================================\n\n/**\n * rankScore = expectedNetImpact - trustPenalty - executionFrictionPenalty + timeCriticalityBoost\n * \n * Where:\n *   expectedNetImpact = impact * ripple * executionProbability * successProbability\n */\n\nexport const WEIGHTS = {\n  // Trust penalty: penalize high-risk intros\n  trustPenalty: {\n    // trustRisk is 0-1, multiply by this to get penalty\n    multiplier: 20,\n    // threshold above which penalty applies\n    threshold: 0.3\n  },\n  \n  // Execution friction: penalize complex actions\n  executionFriction: {\n    // base penalty per step\n    perStep: 0.5,\n    // max steps before cap\n    maxSteps: 10,\n    // complexity multiplier (if action has complexity field)\n    complexityMultiplier: 5\n  },\n  \n  // Time criticality: boost actions with approaching deadlines\n  timeCriticality: {\n    // days until deadline to start boosting\n    urgentThreshold: 7,\n    // maximum boost\n    maxBoost: 15,\n    // decay rate (boost = maxBoost * e^(-days/decayRate))\n    decayRate: 7\n  },\n  \n  // Impact model weights (from actionSchema)\n  impact: {\n    // Time penalty: days / weeksPerPenaltyPoint\n    timePenaltyWeeks: 7,\n    // Max time penalty cap\n    timePenaltyMax: 30\n  },\n  \n  // Ripple effect weights\n  ripple: {\n    // Base multiplier for ripple score\n    baseMultiplier: 1.0,\n    // Decay per hop\n    hopDecay: 0.5\n  },\n  \n  // Introduction-specific weights\n  intro: {\n    // Baseline conversion rate\n    baselineConversion: 0.15,\n    // Minimum lift for second-order to count\n    secondOrderMinLift: 1.2,\n    // Max path depth for intro chains\n    maxPathDepth: 2\n  },\n  \n  // Pre-issue escalation\n  preissue: {\n    // Days until escalation to consider \"imminent\"\n    imminentDays: 7,\n    // Cost of delay exponential base\n    costOfDelayBase: 1.1,\n    // Max cost multiplier\n    maxCostMultiplier: 3.0\n  }\n};\n\n// =============================================================================\n// DERIVED CONSTANTS (from weights, for convenience)\n// =============================================================================\n\nexport const BASELINE_CONVERSION = WEIGHTS.intro.baselineConversion;\nexport const SECOND_ORDER_MIN_LIFT = WEIGHTS.intro.secondOrderMinLift;\nexport const MAX_PATH_DEPTH = WEIGHTS.intro.maxPathDepth;\nexport const IMMINENT_DAYS = WEIGHTS.preissue.imminentDays;\n\n// =============================================================================\n// PENALTY FUNCTIONS\n// =============================================================================\n\n/**\n * Compute trust penalty\n * @param {number} trustRisk - 0-1 risk score\n * @returns {number} - penalty to subtract from rankScore\n */\nexport function computeTrustPenalty(trustRisk) {\n  if (trustRisk <= WEIGHTS.trustPenalty.threshold) return 0;\n  return (trustRisk - WEIGHTS.trustPenalty.threshold) * WEIGHTS.trustPenalty.multiplier;\n}\n\n/**\n * Compute execution friction penalty\n * @param {Object} action - Action with steps array\n * @returns {number} - penalty to subtract from rankScore\n */\nexport function computeExecutionFrictionPenalty(action) {\n  const stepCount = Math.min(action.steps?.length || 0, WEIGHTS.executionFriction.maxSteps);\n  let penalty = stepCount * WEIGHTS.executionFriction.perStep;\n  \n  if (action.complexity) {\n    penalty += action.complexity * WEIGHTS.executionFriction.complexityMultiplier;\n  }\n  \n  return penalty;\n}\n\n/**\n * Compute time criticality boost\n * @param {number} daysUntilDeadline - days until action's deadline\n * @returns {number} - boost to add to rankScore\n */\nexport function computeTimeCriticalityBoost(daysUntilDeadline) {\n  if (daysUntilDeadline == null || daysUntilDeadline <= 0) return 0;\n  if (daysUntilDeadline > WEIGHTS.timeCriticality.urgentThreshold * 4) return 0;\n  \n  const { maxBoost, decayRate } = WEIGHTS.timeCriticality;\n  return maxBoost * Math.exp(-daysUntilDeadline / decayRate);\n}\n\n/**\n * Compute time penalty (from impact model)\n * @param {number} days - timeToImpactDays\n * @returns {number}\n */\nexport function timePenalty(days) {\n  return Math.min(WEIGHTS.impact.timePenaltyMax, days / WEIGHTS.impact.timePenaltyWeeks);\n}\n\nexport default {\n  WEIGHTS,\n  BASELINE_CONVERSION,\n  SECOND_ORDER_MIN_LIFT,\n  MAX_PATH_DEPTH,\n  IMMINENT_DAYS,\n  computeTrustPenalty,\n  computeExecutionFrictionPenalty,\n  computeTimeCriticalityBoost,\n  timePenalty\n};\n"],"names":[],"mappings":"AAAA;;;;;;;CAOC,GAED,gFAAgF;AAChF,0BAA0B;AAC1B,gFAAgF;AAEhF;;;;;CAKC;;;;;;;;;;;;;;;;;;;;;;AAEM,MAAM,UAAU;IACrB,2CAA2C;IAC3C,cAAc;QACZ,oDAAoD;QACpD,YAAY;QACZ,wCAAwC;QACxC,WAAW;IACb;IAEA,+CAA+C;IAC/C,mBAAmB;QACjB,wBAAwB;QACxB,SAAS;QACT,uBAAuB;QACvB,UAAU;QACV,yDAAyD;QACzD,sBAAsB;IACxB;IAEA,6DAA6D;IAC7D,iBAAiB;QACf,wCAAwC;QACxC,iBAAiB;QACjB,gBAAgB;QAChB,UAAU;QACV,sDAAsD;QACtD,WAAW;IACb;IAEA,2CAA2C;IAC3C,QAAQ;QACN,4CAA4C;QAC5C,kBAAkB;QAClB,uBAAuB;QACvB,gBAAgB;IAClB;IAEA,wBAAwB;IACxB,QAAQ;QACN,mCAAmC;QACnC,gBAAgB;QAChB,gBAAgB;QAChB,UAAU;IACZ;IAEA,gCAAgC;IAChC,OAAO;QACL,2BAA2B;QAC3B,oBAAoB;QACpB,yCAAyC;QACzC,oBAAoB;QACpB,kCAAkC;QAClC,cAAc;IAChB;IAEA,uBAAuB;IACvB,UAAU;QACR,+CAA+C;QAC/C,cAAc;QACd,iCAAiC;QACjC,iBAAiB;QACjB,sBAAsB;QACtB,mBAAmB;IACrB;AACF;AAMO,MAAM,sBAAsB,QAAQ,KAAK,CAAC,kBAAkB;AAC5D,MAAM,wBAAwB,QAAQ,KAAK,CAAC,kBAAkB;AAC9D,MAAM,iBAAiB,QAAQ,KAAK,CAAC,YAAY;AACjD,MAAM,gBAAgB,QAAQ,QAAQ,CAAC,YAAY;AAWnD,SAAS,oBAAoB,SAAS;IAC3C,IAAI,aAAa,QAAQ,YAAY,CAAC,SAAS,EAAE,OAAO;IACxD,OAAO,CAAC,YAAY,QAAQ,YAAY,CAAC,SAAS,IAAI,QAAQ,YAAY,CAAC,UAAU;AACvF;AAOO,SAAS,gCAAgC,MAAM;IACpD,MAAM,YAAY,KAAK,GAAG,CAAC,OAAO,KAAK,EAAE,UAAU,GAAG,QAAQ,iBAAiB,CAAC,QAAQ;IACxF,IAAI,UAAU,YAAY,QAAQ,iBAAiB,CAAC,OAAO;IAE3D,IAAI,OAAO,UAAU,EAAE;QACrB,WAAW,OAAO,UAAU,GAAG,QAAQ,iBAAiB,CAAC,oBAAoB;IAC/E;IAEA,OAAO;AACT;AAOO,SAAS,4BAA4B,iBAAiB;IAC3D,IAAI,qBAAqB,QAAQ,qBAAqB,GAAG,OAAO;IAChE,IAAI,oBAAoB,QAAQ,eAAe,CAAC,eAAe,GAAG,GAAG,OAAO;IAE5E,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,GAAG,QAAQ,eAAe;IACvD,OAAO,WAAW,KAAK,GAAG,CAAC,CAAC,oBAAoB;AAClD;AAOO,SAAS,YAAY,IAAI;IAC9B,OAAO,KAAK,GAAG,CAAC,QAAQ,MAAM,CAAC,cAAc,EAAE,OAAO,QAAQ,MAAM,CAAC,gBAAgB;AACvF;uCAEe;IACb;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;AACF"}},
    {"offset": {"line": 4991, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/decide/ranking.js"],"sourcesContent":["/**\n * decide/ranking.js Ã¢â‚¬â€ Unified Action Ranking (Phase 4.5)\n * \n * SINGLE CANONICAL RANKING SURFACE\n * \n * All actions are ordered by exactly ONE scalar: rankScore\n * \n * Formula:\n *   rankScore = expectedNetImpact - trustPenalty - executionFrictionPenalty + timeCriticalityBoost\n * \n * Where:\n *   expectedNetImpact = (upside * combinedProb) + leverage - (downside * failProb) - effort - timePenalty\n *   combinedProb = executionProbability * probabilityOfSuccess\n * \n * No other number may reorder Actions.\n * \n * @module decide/ranking\n */\n\nimport {\n  WEIGHTS,\n  computeTrustPenalty,\n  computeExecutionFrictionPenalty,\n  computeTimeCriticalityBoost,\n  timePenalty\n} from './weights.js';\n\n// =============================================================================\n// EXPECTED NET IMPACT (base formula)\n// =============================================================================\n\n/**\n * Compute expected net impact from impact model\n * @param {Object} impact - ImpactModel\n * @returns {number}\n */\nexport function computeExpectedNetImpact(impact) {\n  const {\n    upsideMagnitude = 0,\n    probabilityOfSuccess = 0.5,\n    executionProbability = 1,\n    downsideMagnitude = 0,\n    timeToImpactDays = 14,\n    effortCost = 0,\n    secondOrderLeverage = 0\n  } = impact;\n  \n  const combinedProbability = executionProbability * probabilityOfSuccess;\n  const expectedUpside = upsideMagnitude * combinedProbability;\n  const expectedDownside = downsideMagnitude * (1 - combinedProbability);\n  const timePen = timePenalty(timeToImpactDays);\n  \n  return expectedUpside + secondOrderLeverage - expectedDownside - effortCost - timePen;\n}\n\n// =============================================================================\n// RANK SCORE COMPUTATION\n// =============================================================================\n\n/**\n * Compute canonical rankScore for an action\n * \n * @param {Object} action - Action with impact model\n * @param {Object} options - Additional context\n * @param {number} [options.trustRisk] - Trust risk score (0-1)\n * @param {number} [options.daysUntilDeadline] - Days until action deadline\n * @returns {{ rankScore: number, components: Object }}\n */\nexport function computeRankScore(action, options = {}) {\n  const { trustRisk = 0, daysUntilDeadline = null } = options;\n  \n  // Base expected net impact\n  const expectedNetImpact = computeExpectedNetImpact(action.impact);\n  \n  // Penalties\n  const trustPenalty = computeTrustPenalty(trustRisk);\n  const executionFrictionPenalty = computeExecutionFrictionPenalty(action);\n  \n  // Boost\n  const timeCriticalityBoost = computeTimeCriticalityBoost(daysUntilDeadline);\n  \n  // Final score\n  const rankScore = expectedNetImpact - trustPenalty - executionFrictionPenalty + timeCriticalityBoost;\n  \n  return {\n    rankScore,\n    components: {\n      expectedNetImpact,\n      trustPenalty,\n      executionFrictionPenalty,\n      timeCriticalityBoost\n    }\n  };\n}\n\n// =============================================================================\n// ACTION RANKING\n// =============================================================================\n\n/**\n * Rank all actions by rankScore (single surface)\n * \n * @param {Object[]} actions - Actions with impact models\n * @param {Object} context - Context for computing penalties/boosts\n * @param {Map<string, number>} [context.trustRiskByAction] - Trust risk per action\n * @param {Map<string, number>} [context.deadlinesByAction] - Days until deadline per action\n * @returns {Object[]} - Actions sorted by rankScore, with rank and components\n */\nexport function rankActions(actions, context = {}) {\n  if (!actions || actions.length === 0) return [];\n  \n  const { trustRiskByAction = new Map(), deadlinesByAction = new Map() } = context;\n  \n  // Compute rankScore for each action\n  const scored = actions.map(action => {\n    const options = {\n      trustRisk: trustRiskByAction.get(action.actionId) || action.trustRisk || 0,\n      daysUntilDeadline: deadlinesByAction.get(action.actionId) || action.daysUntilDeadline\n    };\n    \n    const { rankScore, components } = computeRankScore(action, options);\n    \n    return {\n      ...action,\n      rankScore,\n      rankComponents: components,\n      // Keep expectedNetImpact for backward compatibility\n      expectedNetImpact: components.expectedNetImpact\n    };\n  });\n  \n  // Sort by rankScore (descending)\n  // Break ties by actionId for determinism\n  scored.sort((a, b) => {\n    const diff = b.rankScore - a.rankScore;\n    if (Math.abs(diff) > 0.0001) return diff;\n    return a.actionId.localeCompare(b.actionId);\n  });\n  \n  // Assign ranks (1-indexed)\n  return scored.map((action, index) => ({\n    ...action,\n    rank: index + 1\n  }));\n}\n\n/**\n * Get top N actions\n * @param {Object[]} rankedActions \n * @param {number} n \n * @returns {Object[]}\n */\nexport function getTopActions(rankedActions, n = 5) {\n  return rankedActions.slice(0, n);\n}\n\n// =============================================================================\n// VALIDATION\n// =============================================================================\n\n/**\n * Validate that ranking uses only rankScore\n * @param {Object[]} rankedActions \n * @returns {{ valid: boolean, errors: string[] }}\n */\nexport function validateRanking(rankedActions) {\n  const errors = [];\n  \n  if (rankedActions.length === 0) return { valid: true, errors: [] };\n  \n  // Check all actions have rankScore\n  for (const action of rankedActions) {\n    if (typeof action.rankScore !== 'number' || isNaN(action.rankScore)) {\n      errors.push(`Action ${action.actionId}: missing or invalid rankScore`);\n    }\n    \n    if (typeof action.rank !== 'number' || action.rank < 1) {\n      errors.push(`Action ${action.actionId}: missing or invalid rank`);\n    }\n  }\n  \n  // Verify sorting is correct\n  for (let i = 1; i < rankedActions.length; i++) {\n    const prev = rankedActions[i - 1];\n    const curr = rankedActions[i];\n    \n    if (curr.rankScore > prev.rankScore + 0.0001) {\n      errors.push(`Actions not sorted by rankScore at position ${i}`);\n    }\n  }\n  \n  // Verify rank sequence\n  for (let i = 0; i < rankedActions.length; i++) {\n    if (rankedActions[i].rank !== i + 1) {\n      errors.push(`Rank sequence broken at position ${i}`);\n    }\n  }\n  \n  return { valid: errors.length === 0, errors };\n}\n\n/**\n * Verify determinism\n * @param {Object[]} actions \n * @param {Object} context \n * @returns {boolean}\n */\nexport function verifyDeterminism(actions, context = {}) {\n  const ranked1 = rankActions(actions, context);\n  const ranked2 = rankActions(actions, context);\n  \n  if (ranked1.length !== ranked2.length) return false;\n  \n  for (let i = 0; i < ranked1.length; i++) {\n    if (ranked1[i].actionId !== ranked2[i].actionId) return false;\n    if (Math.abs(ranked1[i].rankScore - ranked2[i].rankScore) > 0.0001) return false;\n  }\n  \n  return true;\n}\n\nexport default {\n  computeExpectedNetImpact,\n  computeRankScore,\n  rankActions,\n  getTopActions,\n  validateRanking,\n  verifyDeterminism\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5145, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/runtime/engine.js"],"sourcesContent":["/**\n * engine.js – DAG-Driven Computation Engine (Phase 4.5.2)\n * \n * Phase 4.5.2: Kill list compliance - removed shadow value surfaces\n * Execution order is enforced by explicit dependency graph.\n * \n * INVARIANT: No circular dependencies. Back-edge access throws.\n * \n * @module engine\n */\n\nimport { validateDataset } from './index.js';\nimport { GRAPH, topoSort, validateGraph } from './graph.js';\nimport { deriveHealth } from './health.js';\n\n// DERIVE layer (L1-L2)\nimport { deriveRunway } from '../derive/runway.js';\nimport { deriveTrajectory } from '../derive/trajectory.js';\nimport { deriveCompanyMetrics } from '../derive/metrics.js';\nimport { deriveCompanyGoalTrajectories } from '../derive/goalTrajectory.js';\n\n// PREDICT layer (L3-L4)\nimport { detectIssues } from '../predict/issues.js';\nimport { calculateCompanyRipple } from '../predict/ripple.js';\nimport { deriveCompanyPreIssues } from '../predict/preissues.js';\nimport { generateCompanyActionCandidates } from '../predict/actionCandidates.js';\nimport { attachCompanyImpactModels } from '../predict/actionImpact.js';\nimport { generateIntroOpportunities } from '../predict/introOpportunity.js';\n\n// DECIDE layer (L5)\nimport { rankActions } from '../decide/ranking.js';\n\n// QA layer\nimport { assertNoForbiddenFields } from '../qa/forbidden.js';\n\n// =============================================================================\n// NODE COMPUTE FUNCTIONS (Phase 4.5.2)\n// =============================================================================\n\nconst NODE_COMPUTE = {\n  runway: (ctx, company, now) => {\n    return deriveRunway(\n      company.cash,\n      company.burn,\n      company.asOf,\n      company.asOf,\n      now\n    );\n  },\n  \n  metrics: (ctx, company, now) => {\n    return deriveCompanyMetrics(company);\n  },\n  \n  trajectory: (ctx, company, now) => {\n    const trajectories = {};\n    for (const goal of company.goals || []) {\n      trajectories[goal.id] = deriveTrajectory(goal, now);\n    }\n    return trajectories;\n  },\n  \n  goalTrajectory: (ctx, company, now) => {\n    return deriveCompanyGoalTrajectories(company, now);\n  },\n  \n  health: (ctx, company, now) => {\n    return deriveHealth(company, now);\n  },\n  \n  issues: (ctx, company, now) => {\n    return detectIssues(company, now);\n  },\n  \n  preissues: (ctx, company, now) => {\n    const goalTrajectories = ctx.goalTrajectory || [];\n    const runway = ctx.runway || null;\n    return deriveCompanyPreIssues(company, goalTrajectories, runway, now);\n  },\n  \n  ripple: (ctx, company, now) => {\n    const issues = ctx.issues?.issues || [];\n    return calculateCompanyRipple(company, issues);\n  },\n  \n  introOpportunity: (ctx, company, now, globals) => {\n    // Intro opportunities need access to people, relationships, investors, team\n    // These are passed via globals\n    const { people, relationships, investors, team } = globals || {};\n    return generateIntroOpportunities({\n      company,\n      goals: company.goals || [],\n      people: people || [],\n      relationships: relationships || [],\n      investors: investors || [],\n      team: team || [],\n      now\n    });\n  },\n  \n  actionCandidates: (ctx, company, now) => {\n    // Combine standard candidates with intro opportunities\n    const standardCandidates = generateCompanyActionCandidates({\n      issues: ctx.issues?.issues || [],\n      preissues: ctx.preissues || [],\n      goalTrajectories: ctx.goalTrajectory || [],\n      companyId: company.id,\n      companyName: company.name,\n      createdAt: now.toISOString()\n    });\n    \n    // Convert intro opportunities to action candidates\n    const introCandidates = (ctx.introOpportunity || []).map(intro => ({\n      actionId: intro.id,\n      title: `${company.name}: Intro to ${intro.targetPersonName}`,\n      resolutionId: 'NETWORK_INTRO',\n      entityRef: { type: 'company', id: company.id, name: company.name },\n      sources: [{\n        sourceType: 'INTRODUCTION',\n        sourceId: intro.id,\n        goalId: intro.goalId\n      }],\n      steps: [\n        { step: 1, action: `Reach out to ${intro.introducerName} to request intro` },\n        { step: 2, action: `Brief ${intro.introducerName} on ${intro.targetPersonName}'s relevance` },\n        { step: 3, action: `Follow up within 48 hours of intro` }\n      ],\n      type: 'INTRODUCTION',\n      ...intro // Include all intro-specific fields\n    }));\n    \n    return [...standardCandidates, ...introCandidates];\n  },\n  \n  actionImpact: (ctx, company, now) => {\n    const candidates = ctx.actionCandidates || [];\n    return attachCompanyImpactModels(candidates, {\n      issues: ctx.issues?.issues || [],\n      preissues: ctx.preissues || [],\n      goalTrajectories: ctx.goalTrajectory || [],\n      rippleByCompany: { [company.id]: ctx.ripple },\n      company\n    });\n  },\n  \n  actionRanker: (ctx, company, now) => {\n    // PHASE 4.5.2: Direct ranking from actionImpact (no intermediate value surfaces)\n    const actionsWithImpact = ctx.actionImpact || [];\n    return rankActions(actionsWithImpact);\n  },\n  \n  priority: (ctx, company, now) => {\n    // Compatibility view: map ranked actions to priority-like records\n    const rankedActions = ctx.actionRanker || [];\n    return {\n      priorities: rankedActions.map(a => ({\n        companyId: company.id,\n        companyName: company.name,\n        resolutionId: a.resolutionId,\n        title: a.title,\n        priority: a.rankScore || a.expectedNetImpact,\n        rank: a.rank,\n        actionId: a.actionId,\n        sourceType: a.sources[0]?.sourceType || 'MANUAL'\n      })),\n      summary: {\n        companyId: company.id,\n        totalPriorities: rankedActions.length,\n        topAction: rankedActions[0]?.title || null\n      }\n    };\n  }\n};\n\n// =============================================================================\n// DAG ENGINE\n// =============================================================================\n\nfunction computeCompanyDAG(company, now, globals = {}) {\n  const order = topoSort(GRAPH);\n  const ctx = {};\n  \n  for (const node of order) {\n    const computeFn = NODE_COMPUTE[node];\n    if (!computeFn) {\n      throw new Error(`No compute function for node: ${node}`);\n    }\n    ctx[node] = computeFn(ctx, company, now, globals);\n  }\n  \n  return ctx;\n}\n\n/**\n * Run the full computation engine.\n * Phase 4.5.2: Returns ranked actions as primary artifact.\n */\nexport function compute(rawData, now = new Date()) {\n  const startTime = Date.now();\n  const errors = [];\n  const warnings = [];\n  \n  // Validate DAG\n  const graphValidation = validateGraph(GRAPH);\n  if (!graphValidation.valid) {\n    errors.push(...graphValidation.errors);\n  }\n  \n  // Validate input data\n  const dataValidation = validateDataset(rawData);\n  if (!dataValidation.valid) {\n    errors.push(...dataValidation.errors);\n  }\n  \n  // Forbidden field check\n  try {\n    assertNoForbiddenFields(rawData);\n  } catch (err) {\n    errors.push(err.message);\n  }\n  \n  const executionOrder = topoSort(GRAPH);\n  \n  // Globals for network modules (people, relationships, etc.)\n  const globals = {\n    people: rawData.people || [],\n    relationships: rawData.relationships || [],\n    investors: rawData.investors || [],\n    team: rawData.team || []\n  };\n  \n  // Compute for each company\n  const companies = (rawData.companies || []).map(company => {\n    const computed = computeCompanyDAG(company, now, globals);\n    \n    if (computed.runway?.confidence < 0.5) {\n      warnings.push(`[${company.id}] Low confidence runway`);\n    }\n    \n    return {\n      id: company.id,\n      name: company.name,\n      raw: company,\n      derived: {\n        runway: computed.runway,\n        health: computed.health,\n        metrics: computed.metrics,\n        trajectories: computed.trajectory,\n        goalTrajectories: computed.goalTrajectory,\n        issues: computed.issues,\n        preissues: computed.preissues,\n        ripple: computed.ripple,\n        introOpportunities: computed.introOpportunity,\n        actions: computed.actionRanker, // Phase 4.5.2: direct from ranker\n        priorities: computed.priority?.priorities || []\n      }\n    };\n  });\n  \n  // Aggregate all ranked actions across portfolio\n  let allActions = [];\n  for (const company of companies) {\n    allActions = allActions.concat(company.derived.actions || []);\n  }\n  \n  // Re-rank at portfolio level using single ranking surface\n  const portfolioRankedActions = rankActions(allActions);\n  \n  // Health counts\n  const healthCounts = {\n    GREEN: companies.filter(c => c.derived.health?.healthBand === 'GREEN').length,\n    YELLOW: companies.filter(c => c.derived.health?.healthBand === 'YELLOW').length,\n    RED: companies.filter(c => c.derived.health?.healthBand === 'RED').length\n  };\n  \n  // Action source counts\n  const actionSourceCounts = {\n    ISSUE: portfolioRankedActions.filter(a => a.sources[0]?.sourceType === 'ISSUE').length,\n    PREISSUE: portfolioRankedActions.filter(a => a.sources[0]?.sourceType === 'PREISSUE').length,\n    GOAL: portfolioRankedActions.filter(a => a.sources[0]?.sourceType === 'GOAL').length,\n    INTRODUCTION: portfolioRankedActions.filter(a => a.sources[0]?.sourceType === 'INTRODUCTION').length\n  };\n  \n  return {\n    companies,\n    team: rawData.team || [],\n    investors: rawData.investors || [],\n    \n    // Phase 4.5.2: Actions are primary artifact\n    actions: portfolioRankedActions,\n    todayActions: portfolioRankedActions.slice(0, 5),\n    \n    // Compatibility: priorities view\n    priorities: portfolioRankedActions.map(a => ({\n      companyId: a.entityRef.id,\n      companyName: a.title.split(':')[0],\n      resolutionId: a.resolutionId,\n      title: a.title,\n      priority: a.rankScore || a.expectedNetImpact,\n      rank: a.rank,\n      actionId: a.actionId\n    })),\n    \n    meta: {\n      computedAt: now.toISOString(),\n      durationMs: Date.now() - startTime,\n      version: '9.4.5.2', // Phase 4.5.2: Kill list compliance\n      inputVersion: rawData.version,\n      errors,\n      warnings,\n      healthCounts,\n      actionSourceCounts,\n      executionOrder,\n      layersExecuted: ['L0_RAW', ...executionOrder.map(n => n.toUpperCase())]\n    }\n  };\n}\n\nexport function computeCompany(company, now = new Date()) {\n  const computed = computeCompanyDAG(company, now);\n  \n  return {\n    id: company.id,\n    name: company.name,\n    raw: company,\n    derived: {\n      runway: computed.runway,\n      health: computed.health,\n      metrics: computed.metrics,\n      trajectories: computed.trajectory,\n      goalTrajectories: computed.goalTrajectory,\n      issues: computed.issues,\n      preissues: computed.preissues,\n      ripple: computed.ripple,\n      actions: computed.actionRanker,\n      priorities: computed.priority?.priorities || []\n    }\n  };\n}\n\nexport default { compute, computeCompany };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5482, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/backbone-v9/ui/raw/sample.json"],"sourcesContent":["{\"version\":\"9.1.0\",\"exportedAt\":\"2026-01-24T23:30:00Z\",\"companies\":[{\"id\":\"velocity\",\"name\":\"Velocity\",\"tagline\":\"Cross-border payments infrastructure\",\"stage\":\"Series A\",\"burn\":180000,\"cash\":2520000,\"employees\":28,\"hq\":\"New York\",\"sector\":\"Payments\",\"color\":\"from-blue-500 to-indigo-600\",\"raising\":true,\"roundTarget\":15000000,\"founderPersonIds\":[\"p-marcus-chen\",\"p-sarah-okonkwo\"],\"founders\":[{\"name\":\"Marcus Chen\",\"role\":\"CEO\",\"bio\":\"Previously led payments at Stripe. Stanford MBA.\"},{\"name\":\"Sarah Okonkwo\",\"role\":\"CTO\",\"bio\":\"Former engineering lead at TransferWise. MIT CS.\"}],\"goals\":[{\"id\":\"v1\",\"type\":\"revenue\",\"name\":\"Q1 Revenue Target\",\"current\":850000,\"target\":1000000,\"due\":\"2026-03-31\",\"status\":\"active\",\"asOf\":\"2026-01-15T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"v2\",\"type\":\"product\",\"name\":\"API V2 Launch\",\"current\":80,\"target\":100,\"due\":\"2026-02-15\",\"status\":\"active\",\"asOf\":\"2026-01-18T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"v3\",\"type\":\"fundraise\",\"name\":\"Series A Close\",\"current\":8000000,\"target\":15000000,\"due\":\"2026-04-30\",\"status\":\"active\",\"asOf\":\"2026-01-20T00:00:00Z\",\"provenance\":\"manual\"}],\"deals\":[{\"id\":\"d-vel-1\",\"investorId\":\"i1\",\"investor\":\"Horizon Ventures\",\"status\":\"dd\",\"probability\":70,\"amount\":5000000,\"asOf\":\"2026-01-18T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"d-vel-2\",\"investorId\":\"i2\",\"investor\":\"Atlas Capital\",\"status\":\"meeting\",\"probability\":40,\"amount\":3000000,\"asOf\":\"2026-01-15T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"d-vel-3\",\"investorId\":\"i3\",\"investor\":\"Pinnacle Partners\",\"status\":\"termsheet\",\"probability\":85,\"amount\":7000000,\"asOf\":\"2026-01-19T00:00:00Z\",\"provenance\":\"manual\"}],\"asOf\":\"2026-01-20T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"nexgen\",\"name\":\"NexGen\",\"tagline\":\"AI-powered ERP for modern enterprises\",\"stage\":\"Series A\",\"burn\":150000,\"cash\":3300000,\"employees\":35,\"hq\":\"San Francisco\",\"sector\":\"Enterprise Software\",\"color\":\"from-emerald-500 to-teal-600\",\"raising\":false,\"roundTarget\":0,\"founderPersonIds\":[\"p-james-rodriguez\",\"p-priya-sharma\"],\"founders\":[{\"name\":\"James Rodriguez\",\"role\":\"CEO\",\"bio\":\"Ex-SAP product lead. Harvard Business School.\"},{\"name\":\"Priya Sharma\",\"role\":\"CTO\",\"bio\":\"Founded 2 AI startups (1 exit). Berkeley PhD.\"}],\"goals\":[{\"id\":\"n1\",\"type\":\"revenue\",\"name\":\"ARR Target\",\"current\":2200000,\"target\":3000000,\"due\":\"2026-06-30\",\"status\":\"active\",\"asOf\":\"2026-01-15T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"n2\",\"type\":\"hiring\",\"name\":\"Engineering Team\",\"current\":18,\"target\":25,\"due\":\"2026-03-31\",\"status\":\"active\",\"asOf\":\"2026-01-10T00:00:00Z\",\"provenance\":\"manual\"}],\"deals\":[],\"asOf\":\"2026-01-15T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"aurelius\",\"name\":\"Aurelius\",\"tagline\":\"Automated asset valuation platform\",\"stage\":\"Seed\",\"burn\":95000,\"cash\":760000,\"employees\":12,\"hq\":\"London\",\"sector\":\"Fintech\",\"color\":\"from-amber-500 to-orange-600\",\"raising\":true,\"roundTarget\":2000000,\"founderPersonIds\":[\"p-elena-vasquez\",\"p-david-kim\"],\"founders\":[{\"name\":\"Elena Vasquez\",\"role\":\"CEO\",\"bio\":\"Former Goldman Sachs VP. Oxford economics.\"},{\"name\":\"David Kim\",\"role\":\"CTO\",\"bio\":\"Ex-Google ML engineer. Carnegie Mellon.\"}],\"goals\":[{\"id\":\"a1\",\"type\":\"fundraise\",\"name\":\"Seed Extension\",\"current\":800000,\"target\":2000000,\"due\":\"2026-02-28\",\"status\":\"active\",\"asOf\":\"2026-01-18T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"a2\",\"type\":\"partnership\",\"name\":\"Bank Partnerships\",\"current\":2,\"target\":5,\"due\":\"2026-03-31\",\"status\":\"active\",\"asOf\":\"2026-01-12T00:00:00Z\",\"provenance\":\"manual\"}],\"deals\":[{\"id\":\"d-aur-1\",\"investorId\":\"i4\",\"investor\":\"Sterling Ventures\",\"status\":\"dd\",\"probability\":60,\"amount\":1000000,\"asOf\":\"2026-01-17T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"d-aur-2\",\"investorId\":\"i5\",\"investor\":\"Evergreen Capital\",\"status\":\"meeting\",\"probability\":35,\"amount\":500000,\"asOf\":\"2026-01-14T00:00:00Z\",\"provenance\":\"manual\"}],\"asOf\":\"2026-01-18T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"stratum\",\"name\":\"Stratum\",\"tagline\":\"NAV financing for fund managers\",\"stage\":\"Seed\",\"burn\":85000,\"cash\":1530000,\"employees\":15,\"hq\":\"Boston\",\"sector\":\"Fintech\",\"color\":\"from-purple-500 to-pink-600\",\"raising\":false,\"roundTarget\":0,\"founderPersonIds\":[\"p-michael-foster\",\"p-jennifer-wu\"],\"founders\":[{\"name\":\"Michael Foster\",\"role\":\"CEO\",\"bio\":\"Former PE partner at Blackstone. Wharton MBA.\"},{\"name\":\"Jennifer Wu\",\"role\":\"COO\",\"bio\":\"Ex-McKinsey principal. Yale Law.\"}],\"goals\":[{\"id\":\"s1\",\"type\":\"revenue\",\"name\":\"AUM Under Management\",\"current\":85000000,\"target\":150000000,\"due\":\"2026-06-30\",\"status\":\"active\",\"asOf\":\"2026-01-14T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"s2\",\"type\":\"product\",\"name\":\"Platform 2.0\",\"current\":65,\"target\":100,\"due\":\"2026-04-15\",\"status\":\"active\",\"asOf\":\"2026-01-16T00:00:00Z\",\"provenance\":\"manual\"}],\"deals\":[],\"asOf\":\"2026-01-16T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"prism\",\"name\":\"Prism\",\"tagline\":\"Agentic OS for engineering teams\",\"stage\":\"Pre-Seed\",\"burn\":70000,\"cash\":420000,\"employees\":8,\"hq\":\"Austin\",\"sector\":\"Developer Tools\",\"color\":\"from-red-500 to-rose-600\",\"raising\":true,\"roundTarget\":3000000,\"founderPersonIds\":[\"p-alex-turner\",\"p-nina-patel\"],\"founders\":[{\"name\":\"Alex Turner\",\"role\":\"CEO\",\"bio\":\"Former Uber engineering manager. Stanford CS.\"},{\"name\":\"Nina Patel\",\"role\":\"CTO\",\"bio\":\"Ex-GitHub staff engineer. Open source contributor.\"}],\"goals\":[{\"id\":\"p1\",\"type\":\"fundraise\",\"name\":\"Seed Round\",\"current\":500000,\"target\":3000000,\"due\":\"2026-02-15\",\"status\":\"active\",\"asOf\":\"2026-01-19T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p2\",\"type\":\"product\",\"name\":\"Beta Launch\",\"current\":90,\"target\":100,\"due\":\"2026-01-31\",\"status\":\"active\",\"asOf\":\"2026-01-20T00:00:00Z\",\"provenance\":\"manual\"}],\"deals\":[{\"id\":\"d-pri-1\",\"investorId\":\"i6\",\"investor\":\"Catalyst Ventures\",\"status\":\"termsheet\",\"probability\":75,\"amount\":2000000,\"asOf\":\"2026-01-18T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"d-pri-2\",\"investorId\":\"i7\",\"investor\":\"Founder Collective\",\"status\":\"dd\",\"probability\":50,\"amount\":500000,\"asOf\":\"2026-01-15T00:00:00Z\",\"provenance\":\"manual\"}],\"asOf\":\"2026-01-20T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"cascade\",\"name\":\"Cascade\",\"tagline\":\"Institutional stablecoin infrastructure\",\"stage\":\"Seed\",\"burn\":110000,\"cash\":1760000,\"employees\":18,\"hq\":\"Singapore\",\"sector\":\"Crypto\",\"color\":\"from-cyan-500 to-blue-600\",\"raising\":false,\"roundTarget\":0,\"founderPersonIds\":[\"p-ryan-lee\",\"p-yuki-tanaka\"],\"founders\":[{\"name\":\"Ryan Lee\",\"role\":\"CEO\",\"bio\":\"Co-founded Circle Asia. Previously at JPMorgan.\"},{\"name\":\"Yuki Tanaka\",\"role\":\"CTO\",\"bio\":\"Former Coinbase security lead. Blockchain expert.\"}],\"goals\":[{\"id\":\"c1\",\"type\":\"revenue\",\"name\":\"Monthly Volume\",\"current\":45000000,\"target\":100000000,\"due\":\"2026-06-30\",\"status\":\"active\",\"asOf\":\"2026-01-15T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"c2\",\"type\":\"partnership\",\"name\":\"Exchange Integrations\",\"current\":8,\"target\":15,\"due\":\"2026-04-30\",\"status\":\"active\",\"asOf\":\"2026-01-18T00:00:00Z\",\"provenance\":\"manual\"}],\"deals\":[],\"asOf\":\"2026-01-18T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"meridian\",\"name\":\"Meridian\",\"tagline\":\"Merchant stablecoin payment rails\",\"stage\":\"Seed\",\"burn\":90000,\"cash\":990000,\"employees\":14,\"hq\":\"Miami\",\"sector\":\"Payments\",\"color\":\"from-violet-500 to-purple-600\",\"raising\":false,\"roundTarget\":0,\"founderPersonIds\":[\"p-carlos-mendez\",\"p-lisa-chang\"],\"founders\":[{\"name\":\"Carlos Mendez\",\"role\":\"CEO\",\"bio\":\"Founded PayLatam (acquired). Stanford GSB.\"},{\"name\":\"Lisa Chang\",\"role\":\"CTO\",\"bio\":\"Former Square engineering director. UCLA.\"}],\"goals\":[{\"id\":\"m1\",\"type\":\"revenue\",\"name\":\"Merchant GMV\",\"current\":12000000,\"target\":25000000,\"due\":\"2026-03-31\",\"status\":\"active\",\"asOf\":\"2026-01-14T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"m2\",\"type\":\"operational\",\"name\":\"LATAM Expansion\",\"current\":40,\"target\":100,\"due\":\"2026-04-30\",\"status\":\"active\",\"asOf\":\"2026-01-16T00:00:00Z\",\"provenance\":\"manual\"}],\"deals\":[],\"asOf\":\"2026-01-16T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"sentinel\",\"name\":\"Sentinel\",\"tagline\":\"Autonomous software maintenance\",\"stage\":\"Pre-Seed\",\"burn\":60000,\"cash\":600000,\"employees\":6,\"hq\":\"Seattle\",\"sector\":\"Developer Tools\",\"color\":\"from-slate-500 to-gray-600\",\"raising\":true,\"roundTarget\":2500000,\"founderPersonIds\":[\"p-jordan-hayes\",\"p-sam-wilson\"],\"founders\":[{\"name\":\"Jordan Hayes\",\"role\":\"CEO\",\"bio\":\"Ex-Microsoft Azure PM. Carnegie Mellon MBA.\"},{\"name\":\"Sam Wilson\",\"role\":\"CTO\",\"bio\":\"Former AWS engineer. MIT AI Lab researcher.\"}],\"goals\":[{\"id\":\"se1\",\"type\":\"fundraise\",\"name\":\"Seed Round\",\"current\":750000,\"target\":2500000,\"due\":\"2026-03-15\",\"status\":\"active\",\"asOf\":\"2026-01-17T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"se2\",\"type\":\"product\",\"name\":\"Enterprise Pilot\",\"current\":2,\"target\":5,\"due\":\"2026-02-28\",\"status\":\"active\",\"asOf\":\"2026-01-19T00:00:00Z\",\"provenance\":\"manual\"}],\"deals\":[{\"id\":\"d-sen-1\",\"investorId\":\"i8\",\"investor\":\"Techstars Ventures\",\"status\":\"dd\",\"probability\":55,\"amount\":1000000,\"asOf\":\"2026-01-16T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"d-sen-2\",\"investorId\":\"i9\",\"investor\":\"Amplify Partners\",\"status\":\"meeting\",\"probability\":30,\"amount\":750000,\"asOf\":\"2026-01-14T00:00:00Z\",\"provenance\":\"manual\"}],\"asOf\":\"2026-01-19T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"harmonic\",\"name\":\"Harmonic\",\"tagline\":\"Payment infrastructure orchestration\",\"stage\":\"Seed\",\"burn\":100000,\"cash\":1500000,\"employees\":16,\"hq\":\"Chicago\",\"sector\":\"Payments\",\"color\":\"from-indigo-500 to-blue-600\",\"raising\":false,\"roundTarget\":0,\"founderPersonIds\":[\"p-rachel-kim\",\"p-tom-anderson\"],\"founders\":[{\"name\":\"Rachel Kim\",\"role\":\"CEO\",\"bio\":\"Ex-Plaid product director. Northwestern MBA.\"},{\"name\":\"Tom Anderson\",\"role\":\"CTO\",\"bio\":\"Former Stripe infrastructure engineer. Berkeley.\"}],\"goals\":[{\"id\":\"h1\",\"type\":\"revenue\",\"name\":\"MRR Target\",\"current\":180000,\"target\":250000,\"due\":\"2026-03-31\",\"status\":\"active\",\"asOf\":\"2026-01-15T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"h2\",\"type\":\"hiring\",\"name\":\"Go-to-Market Team\",\"current\":4,\"target\":8,\"due\":\"2026-04-30\",\"status\":\"active\",\"asOf\":\"2026-01-18T00:00:00Z\",\"provenance\":\"manual\"}],\"deals\":[],\"asOf\":\"2026-01-18T00:00:00Z\",\"provenance\":\"manual\"}],\"team\":[{\"id\":\"t1\",\"personId\":\"p-alex-thompson\",\"name\":\"Alex Thompson\",\"role\":\"Managing Partner\",\"bio\":\"Former Goldman Sachs MD and fintech investor at Andreessen Horowitz.\",\"avatar\":\"AT\",\"color\":\"from-indigo-500 to-purple-600\",\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"t2\",\"personId\":\"p-jessica-liu\",\"name\":\"Jessica Liu\",\"role\":\"Partner\",\"bio\":\"Previously founder of PayPath (acquired by Visa). 15 years in payments.\",\"avatar\":\"JL\",\"color\":\"from-emerald-500 to-teal-600\",\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"t3\",\"personId\":\"p-daniel-okafor\",\"name\":\"Daniel Okafor\",\"role\":\"Principal\",\"bio\":\"Former McKinsey engagement manager. Harvard MBA.\",\"avatar\":\"DO\",\"color\":\"from-amber-500 to-orange-600\",\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"t4\",\"personId\":\"p-maria-santos\",\"name\":\"Maria Santos\",\"role\":\"VP Operations\",\"bio\":\"Previously COO at Series B fintech startup.\",\"avatar\":\"MS\",\"color\":\"from-pink-500 to-rose-600\",\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"t5\",\"personId\":\"p-kevin-park\",\"name\":\"Kevin Park\",\"role\":\"Associate\",\"bio\":\"Former product manager at Stripe. Stanford CS and MBA.\",\"avatar\":\"KP\",\"color\":\"from-cyan-500 to-blue-600\",\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"}],\"investors\":[{\"id\":\"i1\",\"personId\":\"p-inv-horizon\",\"name\":\"Horizon Ventures\",\"aum\":\"2.5B\",\"stageFocus\":\"Series A-B\",\"sectorFocus\":\"Fintech, Enterprise\",\"deals\":[\"velocity\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"i2\",\"personId\":\"p-inv-atlas\",\"name\":\"Atlas Capital\",\"aum\":\"800M\",\"stageFocus\":\"Seed-Series A\",\"sectorFocus\":\"B2B SaaS, Fintech\",\"deals\":[\"velocity\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"i3\",\"personId\":\"p-inv-pinnacle\",\"name\":\"Pinnacle Partners\",\"aum\":\"1.8B\",\"stageFocus\":\"Series A-C\",\"sectorFocus\":\"Financial Infrastructure\",\"deals\":[\"velocity\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"i4\",\"personId\":\"p-inv-sterling\",\"name\":\"Sterling Ventures\",\"aum\":\"500M\",\"stageFocus\":\"Seed\",\"sectorFocus\":\"Fintech, Insurtech\",\"deals\":[\"aurelius\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"i5\",\"personId\":\"p-inv-evergreen\",\"name\":\"Evergreen Capital\",\"aum\":\"350M\",\"stageFocus\":\"Pre-Seed-Seed\",\"sectorFocus\":\"Enterprise, Fintech\",\"deals\":[\"aurelius\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"i6\",\"personId\":\"p-inv-catalyst\",\"name\":\"Catalyst Ventures\",\"aum\":\"600M\",\"stageFocus\":\"Pre-Seed-Series A\",\"sectorFocus\":\"Developer Tools, AI\",\"deals\":[\"prism\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"i7\",\"personId\":\"p-inv-founder\",\"name\":\"Founder Collective\",\"aum\":\"400M\",\"stageFocus\":\"Pre-Seed-Seed\",\"sectorFocus\":\"Generalist\",\"deals\":[\"prism\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"i8\",\"personId\":\"p-inv-techstars\",\"name\":\"Techstars Ventures\",\"aum\":\"300M\",\"stageFocus\":\"Pre-Seed-Seed\",\"sectorFocus\":\"Developer Tools, B2B\",\"deals\":[\"sentinel\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"i9\",\"personId\":\"p-inv-amplify\",\"name\":\"Amplify Partners\",\"aum\":\"450M\",\"stageFocus\":\"Seed-Series A\",\"sectorFocus\":\"Enterprise Infrastructure\",\"deals\":[\"sentinel\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"}],\"people\":[{\"id\":\"p-alex-thompson\",\"name\":\"Alex Thompson\",\"orgId\":\"backbone\",\"orgType\":\"fund\",\"role\":\"Managing Partner\",\"tags\":[\"fintech\",\"payments\",\"enterprise\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-jessica-liu\",\"name\":\"Jessica Liu\",\"orgId\":\"backbone\",\"orgType\":\"fund\",\"role\":\"Partner\",\"tags\":[\"payments\",\"infrastructure\",\"founder\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-daniel-okafor\",\"name\":\"Daniel Okafor\",\"orgId\":\"backbone\",\"orgType\":\"fund\",\"role\":\"Principal\",\"tags\":[\"fintech\",\"consulting\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-maria-santos\",\"name\":\"Maria Santos\",\"orgId\":\"backbone\",\"orgType\":\"fund\",\"role\":\"VP Operations\",\"tags\":[\"operations\",\"portfolio-support\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-kevin-park\",\"name\":\"Kevin Park\",\"orgId\":\"backbone\",\"orgType\":\"fund\",\"role\":\"Associate\",\"tags\":[\"developer-tools\",\"infrastructure\",\"product\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-marcus-chen\",\"name\":\"Marcus Chen\",\"orgId\":\"velocity\",\"orgType\":\"company\",\"role\":\"CEO\",\"tags\":[\"payments\",\"stripe\",\"stanford\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-sarah-okonkwo\",\"name\":\"Sarah Okonkwo\",\"orgId\":\"velocity\",\"orgType\":\"company\",\"role\":\"CTO\",\"tags\":[\"engineering\",\"transferwise\",\"mit\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-james-rodriguez\",\"name\":\"James Rodriguez\",\"orgId\":\"nexgen\",\"orgType\":\"company\",\"role\":\"CEO\",\"tags\":[\"enterprise\",\"sap\",\"harvard\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-priya-sharma\",\"name\":\"Priya Sharma\",\"orgId\":\"nexgen\",\"orgType\":\"company\",\"role\":\"CTO\",\"tags\":[\"ai\",\"founder\",\"berkeley\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-elena-vasquez\",\"name\":\"Elena Vasquez\",\"orgId\":\"aurelius\",\"orgType\":\"company\",\"role\":\"CEO\",\"tags\":[\"fintech\",\"goldman\",\"oxford\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-david-kim\",\"name\":\"David Kim\",\"orgId\":\"aurelius\",\"orgType\":\"company\",\"role\":\"CTO\",\"tags\":[\"ml\",\"google\",\"cmu\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-michael-foster\",\"name\":\"Michael Foster\",\"orgId\":\"stratum\",\"orgType\":\"company\",\"role\":\"CEO\",\"tags\":[\"pe\",\"blackstone\",\"wharton\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-jennifer-wu\",\"name\":\"Jennifer Wu\",\"orgId\":\"stratum\",\"orgType\":\"company\",\"role\":\"COO\",\"tags\":[\"consulting\",\"mckinsey\",\"yale\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-alex-turner\",\"name\":\"Alex Turner\",\"orgId\":\"prism\",\"orgType\":\"company\",\"role\":\"CEO\",\"tags\":[\"developer-tools\",\"uber\",\"stanford\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-nina-patel\",\"name\":\"Nina Patel\",\"orgId\":\"prism\",\"orgType\":\"company\",\"role\":\"CTO\",\"tags\":[\"github\",\"open-source\",\"engineering\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-ryan-lee\",\"name\":\"Ryan Lee\",\"orgId\":\"cascade\",\"orgType\":\"company\",\"role\":\"CEO\",\"tags\":[\"crypto\",\"circle\",\"jpmorgan\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-yuki-tanaka\",\"name\":\"Yuki Tanaka\",\"orgId\":\"cascade\",\"orgType\":\"company\",\"role\":\"CTO\",\"tags\":[\"security\",\"coinbase\",\"blockchain\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-carlos-mendez\",\"name\":\"Carlos Mendez\",\"orgId\":\"meridian\",\"orgType\":\"company\",\"role\":\"CEO\",\"tags\":[\"payments\",\"latam\",\"founder\",\"stanford\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-lisa-chang\",\"name\":\"Lisa Chang\",\"orgId\":\"meridian\",\"orgType\":\"company\",\"role\":\"CTO\",\"tags\":[\"square\",\"engineering\",\"ucla\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-jordan-hayes\",\"name\":\"Jordan Hayes\",\"orgId\":\"sentinel\",\"orgType\":\"company\",\"role\":\"CEO\",\"tags\":[\"microsoft\",\"azure\",\"cmu\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-sam-wilson\",\"name\":\"Sam Wilson\",\"orgId\":\"sentinel\",\"orgType\":\"company\",\"role\":\"CTO\",\"tags\":[\"aws\",\"ai\",\"mit\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-rachel-kim\",\"name\":\"Rachel Kim\",\"orgId\":\"harmonic\",\"orgType\":\"company\",\"role\":\"CEO\",\"tags\":[\"plaid\",\"product\",\"northwestern\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-tom-anderson\",\"name\":\"Tom Anderson\",\"orgId\":\"harmonic\",\"orgType\":\"company\",\"role\":\"CTO\",\"tags\":[\"stripe\",\"infrastructure\",\"berkeley\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-inv-horizon\",\"name\":\"David Park (Horizon)\",\"orgId\":\"i1\",\"orgType\":\"investor\",\"role\":\"Partner\",\"tags\":[\"fintech\",\"series-a\",\"enterprise\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-inv-atlas\",\"name\":\"Michelle Wong (Atlas)\",\"orgId\":\"i2\",\"orgType\":\"investor\",\"role\":\"Partner\",\"tags\":[\"saas\",\"fintech\",\"seed\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-inv-pinnacle\",\"name\":\"Robert Chen (Pinnacle)\",\"orgId\":\"i3\",\"orgType\":\"investor\",\"role\":\"Managing Partner\",\"tags\":[\"infrastructure\",\"growth\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-inv-sterling\",\"name\":\"Amanda Foster (Sterling)\",\"orgId\":\"i4\",\"orgType\":\"investor\",\"role\":\"Partner\",\"tags\":[\"fintech\",\"insurtech\",\"seed\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-inv-evergreen\",\"name\":\"James Liu (Evergreen)\",\"orgId\":\"i5\",\"orgType\":\"investor\",\"role\":\"Partner\",\"tags\":[\"enterprise\",\"fintech\",\"pre-seed\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-inv-catalyst\",\"name\":\"Sarah Martinez (Catalyst)\",\"orgId\":\"i6\",\"orgType\":\"investor\",\"role\":\"Partner\",\"tags\":[\"developer-tools\",\"ai\",\"seed\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-inv-founder\",\"name\":\"Eric Kim (Founder Collective)\",\"orgId\":\"i7\",\"orgType\":\"investor\",\"role\":\"Partner\",\"tags\":[\"generalist\",\"pre-seed\",\"founder-friendly\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-inv-techstars\",\"name\":\"Lisa Park (Techstars)\",\"orgId\":\"i8\",\"orgType\":\"investor\",\"role\":\"Partner\",\"tags\":[\"developer-tools\",\"b2b\",\"accelerator\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-inv-amplify\",\"name\":\"Michael Chang (Amplify)\",\"orgId\":\"i9\",\"orgType\":\"investor\",\"role\":\"Partner\",\"tags\":[\"infrastructure\",\"enterprise\",\"seed\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-ext-stripe-cto\",\"name\":\"David Singleton\",\"orgId\":\"stripe\",\"orgType\":\"external\",\"role\":\"CTO\",\"tags\":[\"payments\",\"infrastructure\",\"engineering\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-ext-plaid-ceo\",\"name\":\"Zach Perret\",\"orgId\":\"plaid\",\"orgType\":\"external\",\"role\":\"CEO\",\"tags\":[\"fintech\",\"infrastructure\",\"founder\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"},{\"id\":\"p-ext-sequoia\",\"name\":\"Alfred Lin (Sequoia)\",\"orgId\":\"sequoia\",\"orgType\":\"external\",\"role\":\"Partner\",\"tags\":[\"growth\",\"enterprise\",\"series-b\"],\"asOf\":\"2026-01-01T00:00:00Z\",\"provenance\":\"manual\"}],\"relationships\":[{\"id\":\"r1\",\"fromPersonId\":\"p-alex-thompson\",\"toPersonId\":\"p-marcus-chen\",\"relationshipType\":\"board\",\"strength\":90,\"lastTouchAt\":\"2026-01-18T00:00:00Z\",\"channel\":\"in-person\",\"provenance\":\"manual\",\"introCount\":3,\"introSuccessCount\":2},{\"id\":\"r2\",\"fromPersonId\":\"p-alex-thompson\",\"toPersonId\":\"p-inv-horizon\",\"relationshipType\":\"professional\",\"strength\":85,\"lastTouchAt\":\"2026-01-10T00:00:00Z\",\"channel\":\"email\",\"provenance\":\"manual\",\"introCount\":5,\"introSuccessCount\":4},{\"id\":\"r3\",\"fromPersonId\":\"p-alex-thompson\",\"toPersonId\":\"p-inv-pinnacle\",\"relationshipType\":\"professional\",\"strength\":75,\"lastTouchAt\":\"2025-12-15T00:00:00Z\",\"channel\":\"phone\",\"provenance\":\"manual\",\"introCount\":2,\"introSuccessCount\":2},{\"id\":\"r4\",\"fromPersonId\":\"p-alex-thompson\",\"toPersonId\":\"p-ext-sequoia\",\"relationshipType\":\"professional\",\"strength\":70,\"lastTouchAt\":\"2025-11-20T00:00:00Z\",\"channel\":\"conference\",\"provenance\":\"manual\",\"introCount\":1,\"introSuccessCount\":1},{\"id\":\"r5\",\"fromPersonId\":\"p-jessica-liu\",\"toPersonId\":\"p-rachel-kim\",\"relationshipType\":\"board\",\"strength\":88,\"lastTouchAt\":\"2026-01-15T00:00:00Z\",\"channel\":\"in-person\",\"provenance\":\"manual\",\"introCount\":2,\"introSuccessCount\":2},{\"id\":\"r6\",\"fromPersonId\":\"p-jessica-liu\",\"toPersonId\":\"p-carlos-mendez\",\"relationshipType\":\"board\",\"strength\":85,\"lastTouchAt\":\"2026-01-12T00:00:00Z\",\"channel\":\"video\",\"provenance\":\"manual\",\"introCount\":1,\"introSuccessCount\":1},{\"id\":\"r7\",\"fromPersonId\":\"p-jessica-liu\",\"toPersonId\":\"p-ext-stripe-cto\",\"relationshipType\":\"professional\",\"strength\":80,\"lastTouchAt\":\"2025-12-20T00:00:00Z\",\"channel\":\"email\",\"provenance\":\"manual\",\"introCount\":4,\"introSuccessCount\":3},{\"id\":\"r8\",\"fromPersonId\":\"p-jessica-liu\",\"toPersonId\":\"p-ext-plaid-ceo\",\"relationshipType\":\"professional\",\"strength\":75,\"lastTouchAt\":\"2025-11-30T00:00:00Z\",\"channel\":\"conference\",\"provenance\":\"manual\",\"introCount\":2,\"introSuccessCount\":2},{\"id\":\"r9\",\"fromPersonId\":\"p-daniel-okafor\",\"toPersonId\":\"p-elena-vasquez\",\"relationshipType\":\"board\",\"strength\":82,\"lastTouchAt\":\"2026-01-17T00:00:00Z\",\"channel\":\"in-person\",\"provenance\":\"manual\",\"introCount\":1,\"introSuccessCount\":1},{\"id\":\"r10\",\"fromPersonId\":\"p-daniel-okafor\",\"toPersonId\":\"p-inv-sterling\",\"relationshipType\":\"professional\",\"strength\":65,\"lastTouchAt\":\"2026-01-05T00:00:00Z\",\"channel\":\"email\",\"provenance\":\"manual\",\"introCount\":0,\"introSuccessCount\":0},{\"id\":\"r11\",\"fromPersonId\":\"p-daniel-okafor\",\"toPersonId\":\"p-jennifer-wu\",\"relationshipType\":\"alumni\",\"strength\":70,\"lastTouchAt\":\"2025-10-15T00:00:00Z\",\"channel\":\"linkedin\",\"provenance\":\"manual\",\"notes\":\"McKinsey overlap\",\"introCount\":0,\"introSuccessCount\":0},{\"id\":\"r12\",\"fromPersonId\":\"p-kevin-park\",\"toPersonId\":\"p-alex-turner\",\"relationshipType\":\"board\",\"strength\":78,\"lastTouchAt\":\"2026-01-19T00:00:00Z\",\"channel\":\"video\",\"provenance\":\"manual\",\"introCount\":2,\"introSuccessCount\":1},{\"id\":\"r13\",\"fromPersonId\":\"p-kevin-park\",\"toPersonId\":\"p-jordan-hayes\",\"relationshipType\":\"board\",\"strength\":75,\"lastTouchAt\":\"2026-01-16T00:00:00Z\",\"channel\":\"video\",\"provenance\":\"manual\",\"introCount\":1,\"introSuccessCount\":0},{\"id\":\"r14\",\"fromPersonId\":\"p-kevin-park\",\"toPersonId\":\"p-inv-catalyst\",\"relationshipType\":\"professional\",\"strength\":72,\"lastTouchAt\":\"2026-01-08T00:00:00Z\",\"channel\":\"email\",\"provenance\":\"manual\",\"introCount\":1,\"introSuccessCount\":1},{\"id\":\"r15\",\"fromPersonId\":\"p-kevin-park\",\"toPersonId\":\"p-tom-anderson\",\"relationshipType\":\"alumni\",\"strength\":68,\"lastTouchAt\":\"2025-09-20T00:00:00Z\",\"channel\":\"linkedin\",\"provenance\":\"manual\",\"notes\":\"Stripe overlap\",\"introCount\":0,\"introSuccessCount\":0},{\"id\":\"r16\",\"fromPersonId\":\"p-marcus-chen\",\"toPersonId\":\"p-ext-stripe-cto\",\"relationshipType\":\"former-colleague\",\"strength\":85,\"lastTouchAt\":\"2026-01-05T00:00:00Z\",\"channel\":\"email\",\"provenance\":\"manual\",\"introCount\":0,\"introSuccessCount\":0},{\"id\":\"r17\",\"fromPersonId\":\"p-marcus-chen\",\"toPersonId\":\"p-tom-anderson\",\"relationshipType\":\"professional\",\"strength\":60,\"lastTouchAt\":\"2025-08-10T00:00:00Z\",\"channel\":\"conference\",\"provenance\":\"manual\",\"notes\":\"Met at Fintech Summit\",\"introCount\":0,\"introSuccessCount\":0},{\"id\":\"r18\",\"fromPersonId\":\"p-sarah-okonkwo\",\"toPersonId\":\"p-lisa-chang\",\"relationshipType\":\"professional\",\"strength\":55,\"lastTouchAt\":\"2025-07-15T00:00:00Z\",\"channel\":\"conference\",\"provenance\":\"manual\",\"notes\":\"Engineering meetup\",\"introCount\":0,\"introSuccessCount\":0},{\"id\":\"r19\",\"fromPersonId\":\"p-elena-vasquez\",\"toPersonId\":\"p-michael-foster\",\"relationshipType\":\"professional\",\"strength\":50,\"lastTouchAt\":\"2025-06-20T00:00:00Z\",\"channel\":\"linkedin\",\"provenance\":\"manual\",\"notes\":\"Both ex-finance\",\"introCount\":0,\"introSuccessCount\":0},{\"id\":\"r20\",\"fromPersonId\":\"p-priya-sharma\",\"toPersonId\":\"p-david-kim\",\"relationshipType\":\"alumni\",\"strength\":45,\"lastTouchAt\":\"2025-05-10T00:00:00Z\",\"channel\":\"email\",\"provenance\":\"manual\",\"notes\":\"AI conference connection\",\"introCount\":0,\"introSuccessCount\":0},{\"id\":\"r21\",\"fromPersonId\":\"p-ryan-lee\",\"toPersonId\":\"p-carlos-mendez\",\"relationshipType\":\"professional\",\"strength\":65,\"lastTouchAt\":\"2025-12-01T00:00:00Z\",\"channel\":\"video\",\"provenance\":\"manual\",\"notes\":\"Exploring partnership\",\"introCount\":0,\"introSuccessCount\":0},{\"id\":\"r22\",\"fromPersonId\":\"p-alex-thompson\",\"toPersonId\":\"p-ext-plaid-ceo\",\"relationshipType\":\"professional\",\"strength\":60,\"lastTouchAt\":\"2025-09-15T00:00:00Z\",\"channel\":\"email\",\"provenance\":\"manual\",\"introCount\":1,\"introSuccessCount\":0},{\"id\":\"r23\",\"fromPersonId\":\"p-inv-catalyst\",\"toPersonId\":\"p-inv-techstars\",\"relationshipType\":\"co-investor\",\"strength\":70,\"lastTouchAt\":\"2025-11-10T00:00:00Z\",\"channel\":\"email\",\"provenance\":\"manual\",\"notes\":\"Co-invested in 2 deals\",\"introCount\":0,\"introSuccessCount\":0},{\"id\":\"r24\",\"fromPersonId\":\"p-nina-patel\",\"toPersonId\":\"p-sam-wilson\",\"relationshipType\":\"professional\",\"strength\":55,\"lastTouchAt\":\"2025-10-05T00:00:00Z\",\"channel\":\"github\",\"provenance\":\"manual\",\"notes\":\"Open source collab\",\"introCount\":0,\"introSuccessCount\":0},{\"id\":\"r25\",\"fromPersonId\":\"p-maria-santos\",\"toPersonId\":\"p-james-rodriguez\",\"relationshipType\":\"board\",\"strength\":80,\"lastTouchAt\":\"2026-01-10T00:00:00Z\",\"channel\":\"in-person\",\"provenance\":\"manual\",\"introCount\":0,\"introSuccessCount\":0},{\"id\":\"r26\",\"fromPersonId\":\"p-maria-santos\",\"toPersonId\":\"p-ryan-lee\",\"relationshipType\":\"board\",\"strength\":78,\"lastTouchAt\":\"2026-01-14T00:00:00Z\",\"channel\":\"video\",\"provenance\":\"manual\",\"introCount\":1,\"introSuccessCount\":1},{\"id\":\"r27\",\"fromPersonId\":\"p-maria-santos\",\"toPersonId\":\"p-michael-foster\",\"relationshipType\":\"board\",\"strength\":76,\"lastTouchAt\":\"2026-01-08T00:00:00Z\",\"channel\":\"video\",\"provenance\":\"manual\",\"introCount\":0,\"introSuccessCount\":0}]}"],"names":[],"mappings":"AAAA"}},
    {"offset": {"line": 5482, "column": 31031}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5486, "column": 0}, "map": {"version":3,"sources":["file:///Users/elliotstorey/backbone-v9/ui/pages/api/actions/today.js"],"sourcesContent":["import { compute } from '../../../runtime/engine.js';\nimport portfolioData from '../../../raw/sample.json';\nimport actionEventsData from '../../../raw/actionEvents.json';\n\n// Parse date strings recursively throughout the entire object tree\nfunction parseDates(obj) {\n  if (!obj) return obj;\n  if (Array.isArray(obj)) return obj.map(parseDates);\n  if (typeof obj !== 'object') {\n    // Check if this string looks like an ISO date\n    if (typeof obj === 'string' && /^\\d{4}-\\d{2}-\\d{2}(T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?)?$/.test(obj)) {\n      return new Date(obj);\n    }\n    return obj;\n  }\n  \n  const parsed = {};\n  for (const [key, value] of Object.entries(obj)) {\n    parsed[key] = parseDates(value);\n  }\n  return parsed;\n}\n\nexport default async function handler(req, res) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const rawData = parseDates(portfolioData);\n    const now = new Date(); // Ensure now is always a Date object\n    const result = compute(rawData, now);\n    const today = result.todayActions || [];\n    \n    return res.status(200).json({\n      actions: today,\n      metadata: {\n        total: today.length,\n        timestamp: now.toISOString()\n      }\n    });\n  } catch (err) {\n    console.error('API Error:', err);\n    return res.status(500).json({ \n      error: 'Internal Server Error',\n      message: err.message,\n      stack: process.env.NODE_ENV === 'development' ? err.stack : undefined\n    });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;AAGA,mEAAmE;AACnE,SAAS,WAAW,GAAG;IACrB,IAAI,CAAC,KAAK,OAAO;IACjB,IAAI,MAAM,OAAO,CAAC,MAAM,OAAO,IAAI,GAAG,CAAC;IACvC,IAAI,OAAO,QAAQ,UAAU;QAC3B,8CAA8C;QAC9C,IAAI,OAAO,QAAQ,YAAY,uDAAuD,IAAI,CAAC,MAAM;YAC/F,OAAO,IAAI,KAAK;QAClB;QACA,OAAO;IACT;IAEA,MAAM,SAAS,CAAC;IAChB,KAAK,MAAM,CAAC,KAAK,MAAM,IAAI,OAAO,OAAO,CAAC,KAAM;QAC9C,MAAM,CAAC,IAAI,GAAG,WAAW;IAC3B;IACA,OAAO;AACT;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,IAAI;QACF,MAAM,UAAU,WAAW,wHAAa;QACxC,MAAM,MAAM,IAAI,QAAQ,qCAAqC;QAC7D,MAAM,SAAS,IAAA,6IAAO,EAAC,SAAS;QAChC,MAAM,QAAQ,OAAO,YAAY,IAAI,EAAE;QAEvC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAC1B,SAAS;YACT,UAAU;gBACR,OAAO,MAAM,MAAM;gBACnB,WAAW,IAAI,WAAW;YAC5B;QACF;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAC1B,OAAO;YACP,SAAS,IAAI,OAAO;YACpB,OAAO,uCAAyC,IAAI,KAAK,GAAG;QAC9D;IACF;AACF"}}]
}